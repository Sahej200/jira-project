{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13633061", "self": "https://issues.apache.org/jira/rest/api/2/issue/13633061", "key": "SPARK-54121", "fields": {"summary": "Automatic Snapshot Repair for State store", "description": "Today, the engine currently treats both the changelog and snapshot files with the same importance, so when a state store needs to be loaded it reads the latest snapshot and applies the subsequent changes on it. If the snapshot is bad or corrupted, then the query will fail and be completely down and blocked, needing manual intervention. This leads to user clearing their query checkpoint and having to do full recomputation.\r\n\r\nThis shouldn\u2019t be the case. The changelog should be treated as the \u201csource of truth\u201d and the snapshot is just a disposable materialization of the log.\r\n\r\nIntroducing Automatic snapshot repair, which will automatically repair the checkpoint by skipping bad snapshots and rebuilding the current state from the last good snapshot (works even if there\u2019s none) and applying the changelogs on it. This eliminates the need for manual intervention and unblocks the pipeline to keep it running.\r\n\r\nAlso emit metrics about number of state stores that were auto repaired in a given batch, so that you can build alert and dashboard for it.", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=michealok-db", "name": "michealok-db", "key": "JIRAUSER304347", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=39936", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=39936", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=39936", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=39936"}, "displayName": "B. Micheal Okutubo", "active": true, "timeZone": "America/Los_Angeles"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}