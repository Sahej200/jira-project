{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13630778", "self": "https://issues.apache.org/jira/rest/api/2/issue/13630778", "key": "KAFKA-19758", "fields": {"summary": "Weird behavior on Kafka Connect 4.1 class loading", "description": "I have the [DebeziumOpenLineageEmitter|https://github.com/debezium/debezium/blob/main/debezium-openlineage/debezium-openlineage-api/src/main/java/io/debezium/openlineage/DebeziumOpenLineageEmitter.java] class in the *debezium-openlineage-api* that internally has a static map to maintain the registered emitter, the key of this map is \"connectoLogicalName-taskid\"\r\nThen there is the [OpenLineage SMT|https://github.com/debezium/debezium/blob/main/debezium-core/src/main/java/io/debezium/transforms/openlineage/OpenLineage.java], which is part of the *debezium-core.* In this SMT, I simply pass the same context to instantiate the same emitter via the connector.\r\n\r\nNow I'm running the following image\r\n{code:java}\r\nFROM quay.io/debezium/connect:3.3.0.Final\r\nENV MAVEN_REPO=\"https://repo1.maven.org/maven2\"\r\nENV GROUP_ID=\"io/debezium\"\r\nENV DEBEZIUM_VERSION=\"3.3.0.Final\"\r\nENV ARTIFACT_ID=\"debezium-openlineage-core\"\r\nENV CLASSIFIER=\"-libs\"\r\nCOPY log4j.properties /kafka/config/log4j.properties\r\n\r\nAdd OpenLineage\r\nRUN mkdir -p /tmp/openlineage-libs && \\\r\n\u00a0 \u00a0 curl \"$MAVEN_REPO/$GROUP_ID/$ARTIFACT_ID/$DEBEZIUM_VERSION/$ARTIFACT_ID-${DEBEZIUM_VERSION}${CLASSIFIER}.tar.gz\" -o /tmp/debezium-openlineage-core-libs.tar.gz && \\\r\n\u00a0 \u00a0 tar -xzvf /tmp/debezium-openlineage-core-libs.tar.gz -C /tmp/openlineage-libs --strip-components=1\r\n\r\nRUN cp -r /tmp/openlineage-libs/* /kafka/connect/debezium-connector-postgres/\r\nRUN cp -r /tmp/openlineage-libs/* /kafka/connect/debezium-connector-mongodb/\r\nADD openlineage.yml /kafka/ {code}\r\nSo is practically debezium connect image with just openlineage jars copied into postgres and mongodb connector folders.\r\n\r\nWhen I register the PostgreSQL connector\r\n{code:java}\r\n{\r\n  \"name\": \"inventory-connector-postgres\",\r\n  \"config\": {\r\n    \"connector.class\": \"io.debezium.connector.postgresql.PostgresConnector\",\r\n    \"tasks.max\": \"1\",\r\n    \"database.hostname\": \"postgres\",\r\n    \"database.port\": \"5432\",\r\n    \"database.user\": \"postgres\",\r\n    \"database.password\": \"postgres\",\r\n    \"database.server.id\": \"184054\",\r\n    \"database.dbname\": \"postgres\",\r\n    \"topic.prefix\": \"inventory\",\r\n    \"snapshot.mode\": \"initial\",\r\n    \"schema.history.internal.kafka.bootstrap.servers\": \"kafka:9092\",\r\n    \"schema.history.internal.kafka.topic\": \"schema-changes.inventory\",\r\n    \"slot.name\": \"postgres\",\r\n    \"openlineage.integration.enabled\": \"true\",\r\n    \"openlineage.integration.config.file.path\": \"/kafka/openlineage.yml\",\r\n    \"openlineage.integration.job.description\": \"This connector does cdc for products\",\r\n    \"openlineage.integration.tags\": \"env=prod,team=cdc\",\r\n    \"openlineage.integration.owners\": \"Mario=maintainer,John Doe=Data scientist,IronMan=superero\",\r\n    \"transforms\": \"openlineage\",\r\n    \"transforms.openlineage.type\": \"io.debezium.transforms.openlineage.OpenLineage\"\r\n  }\r\n} {code}\r\n\u00a0\r\nI get the following error\r\n{code:java}\r\n2025-10-03T14:22:09,761 ERROR \u00a0|| \u00a0WorkerSourceTask{id=inventory-connector-postgres-0} Task threw an uncaught and unrecoverable exception. Task is being killed and will not recover until manually restarted \u00a0 [org.apache.kafka.connect.runtime.WorkerTask]\r\norg.apache.kafka.connect.errors.ConnectException: Tolerance exceeded in error handler\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.errors.RetryWithToleranceOperator.execAndHandleError(RetryWithToleranceOperator.java:260) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.errors.RetryWithToleranceOperator.execute(RetryWithToleranceOperator.java:180) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.TransformationChain.apply(TransformationChain.java:58) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.AbstractWorkerSourceTask.sendRecords(AbstractWorkerSourceTask.java:415) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.AbstractWorkerSourceTask.execute(AbstractWorkerSourceTask.java:376) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:243) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:298) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.AbstractWorkerSourceTask.run(AbstractWorkerSourceTask.java:83) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.isolation.Plugins.lambda$withClassLoader$1(Plugins.java:254) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572) ~[?:?]\r\n\u00a0 \u00a0 at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[?:?]\r\n\u00a0 \u00a0 at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]\r\n\u00a0 \u00a0 at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]\r\n\u00a0 \u00a0 at java.base/java.lang.Thread.run(Thread.java:1583) [?:?]\r\nCaused by: java.lang.IllegalStateException: DebeziumOpenLineageEmitter not initialized for connector ConnectorContext[connectorLogicalName=inventory, connectorName=postgresql, taskId=0, version=null, config=null]. Call init() first.\r\n\u00a0 \u00a0 at io.debezium.openlineage.DebeziumOpenLineageEmitter.getEmitter(DebeziumOpenLineageEmitter.java:176) ~[debezium-openlineage-api-3.3.0.Final.jar:3.3.0.Final]\r\n\u00a0 \u00a0 at io.debezium.openlineage.DebeziumOpenLineageEmitter.emit(DebeziumOpenLineageEmitter.java:153) ~[debezium-openlineage-api-3.3.0.Final.jar:3.3.0.Final]\r\n\u00a0 \u00a0 at io.debezium.transforms.openlineage.OpenLineage.apply(OpenLineage.java:74) ~[debezium-core-3.3.0.Final.jar:3.3.0.Final]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.TransformationStage.apply(TransformationStage.java:95) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.TransformationChain.lambda$apply$0(TransformationChain.java:58) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.errors.RetryWithToleranceOperator.execAndRetry(RetryWithToleranceOperator.java:208) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.errors.RetryWithToleranceOperator.execAndHandleError(RetryWithToleranceOperator.java:244) ~[connect-runtime-4.1.0.jar:?]\r\n\u00a0 \u00a0 ... 13 more {code}\r\nFull logs [^connect-service.log]\r\n\r\n\u00a0\r\n\r\nThis is evidence that the emitters map is not shared between the connector and the SMT.\r\n\r\nThe situation becomes weirder if I remove all connectors from the image except PostgreSQL and MongoDB.\r\nIn that case, the PostgreSQL connector works perfectly.\r\n\r\nThe plugins are in the folder */kafka/connect* (that is, the only `plugin.path` configured folder), each under a dedicated folder with their dependencies.\u00a0\r\n\r\nI then started to add more connectors, and it continued to work until I added the SQL Server\u00a0connector.\r\nTo summarize, the problem arises when I put one or all of [sqlserver, spanner,vitess].\r\n\u00a0\r\nThe commonality for these connectors seems to be that they support multi-task. The others don't.\u00a0\r\n\r\nAm I correct that Kafka Connect guarantees that each connector is loaded with an isolated class loader with its dependencies so that the static emitters should be shared between the Connector and the SMT?\r\n\r\nTo add more, if I run the image from 3.2.0.Final (so Kafka 4.0.0) with all connectors, it works fine.\r\n\r\nI did other tests, and things are more and more weird. All tests were done with *{{plugin.path=/kafka/connect}}*\u00a0and *KC 4.1*\r\n\r\nMy original tests were with this directory structure\r\n\r\n\u00a0\r\n{code:java}\r\n/kafka/connect\r\n|___ debezium-connector-postgres\r\n|___ debezium-connector-mongodb\r\n|___ debezium-connector-sqlserver{code}\r\n\u00a0\r\n\r\nIn this case, each connector should be isolated from each others (having a dedicated class loader). In that case, the sharing between the connector and SMT does not work for KC 4.0\r\n\r\nThen I tried with\r\n\r\n\u00a0\r\n{code:java}\r\n/kafka/connect\r\n|___ debezium-connectors\r\n     |___ debezium-connector-postgres\r\n     |___ debezium-connector-mongodb\r\n     |___ debezium-connector-sqlserver{code}\r\n\u00a0\r\n\r\nSo all connectors are not isolated and share the same class loader. In this case, no issue. And I'll say that this is expected.\r\n\r\nThen I tried with\r\n\r\n\u00a0\r\n{code:java}\r\n/kafka/connect\r\n|___ debezium-connectors\r\n|    |___ debezium-connector-postgres\r\n|    |___ debezium-connector-mongodb\r\n|___ debezium-connector-sqlserver{code}\r\n\u00a0\r\n\r\nwhere\u00a0*{{postgres}}*\u00a0and\u00a0*{{mongodb}}*\u00a0are not isolated (same classloader) and\u00a0*{{sqlserver}}* is isolated (different classloader), and in this case, it still works. I expected this to fail as with the first setup.\r\n\r\nThe SMT is in the *debezium-core* jar that and each connector has its own copy\r\nSo in each connector folder, there are:\r\n{code:java}\r\ndebezium-api-3.3.0.Final.jar\r\ndebezium-common-3.3.0.Final.jar\r\ndebezium-connector-[connectorName]-3.3.0.Final.jar\r\ndebezium-core-3.3.0.Final.jar\r\ndebezium-openlineage-api-3.3.0.Final.jar{code}", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028157", "id": "18028157", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "After some investigations, it looks like KIP-891 broke plugin isolation. For example if we have the same transformation under multiple directories, when Connect tries to execute it, it doesn't call apply with the classloader from the right connector.\r\n\r\nThe issue seems to be in DelegatingClassLoader.findPluginLoader() where it always loops through all directories to find the transformation (or predicate) and keeps the last instance. It then uses the classloader of that instance which may not be the same one as the connector.\r\n\r\nAdding custom tracing I see:\r\n\r\n{noformat}\r\nConnectorConfig.getTransformationOrPredicate connector=io.debezium.connector.postgresql.PostgresConnector connectorRange=null range=[3.4.0-SNAPSHOT,3.4.0-SNAPSHOT]\r\nConnectorConfig.getTransformationOrPredicate classloader=PluginClassLoader{pluginLocation=file:/tmp/plugins/debezium-connector-postgres/}\r\nOpenLineage instantiated io.debezium.transforms.openlineage.OpenLineage@2675b74a from /tmp/plugins/debezium-connector-sqlserver/debezium-core-3.4.0-SNAPSHOT.jar\r\nclassloader null PluginClassLoader{pluginLocation=file:/tmp/plugins/debezium-connector-sqlserver/}\r\n{noformat}\r\n\r\nThe connector is running from PluginClassLoader{pluginLocation=file:/tmp/plugins/debezium-connector-postgres/} and trying to run its transformation using PluginClassLoader{pluginLocation=file:/tmp/plugins/debezium-connector-sqlserver/}. The OpenLineage transformation exists in both directories but the DelegatingClassLoader.findPluginLoader() fails to find the appropriate one.\r\n\r\nWe should clarify the expected behavior when a plugins exists under multiple directories. Having multiple times the same connector with the same version should probably be rejected as from the connector configuration, where you have the name and version, you can't decide which one to run. On the other hands, the other connector plugins can exists in multiple copies as long as they are in different directories, thus isolated, as they are always associated with a connector so we can identify a preferred copy.\r\n\r\nAnother inconsistency found while looking at this is that we have default versions for transformations and predicates but the other plugins default to null. For example, the connector configuration submitted via the REST API does not include any version but the computed configuration injects 3.4.0-SNAPSHOT for the transformation.\r\n\r\n{noformat}\r\n        config.action.reload = restart\r\n\tconnector.class = io.debezium.connector.postgresql.PostgresConnector\r\n\tconnector.plugin.version = null\r\n\terrors.log.enable = false\r\n\terrors.log.include.messages = false\r\n\terrors.retry.delay.max.ms = 60000\r\n\terrors.retry.timeout = 0\r\n\terrors.tolerance = none\r\n\theader.converter = null\r\n\theader.converter.plugin.version = null\r\n\tkey.converter = null\r\n\tkey.converter.plugin.version = null\r\n\tname = inventory-connector-postgres\r\n\tpredicates = []\r\n\ttasks.max = 1\r\n\ttasks.max.enforce = true\r\n\ttransforms = [openlineage]\r\n\ttransforms.openlineage.negate = false\r\n\ttransforms.openlineage.plugin.version = 3.4.0-SNAPSHOT\r\n\ttransforms.openlineage.predicate = null\r\n\ttransforms.openlineage.type = class io.debezium.transforms.openlineage.OpenLineage\r\n\tvalue.converter = null\r\n\tvalue.converter.plugin.version = null\r\n{noformat}\r\n\r\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-07T17:00:46.783+0000", "updated": "2025-10-07T17:00:46.783+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028158", "id": "18028158", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "[~gharris] [~snehashisp] WDYT?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-07T17:02:29.198+0000", "updated": "2025-10-07T17:02:29.198+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028199", "id": "18028199", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "body": "I have not had a chance to inspect the code or reproduce this for myself, but my first impressions:\r\n # I don't think communication via static fields is good practice, and should be avoided if possible. I personally have been on the receiving end of bugs caused by static fields within a single plugin; I also think I personally would not like to debug static fields shared across plugins.\r\n # In deployments which make use of the plugin.version configs, changing the pinned version will necessarily change which instance of a static variable is used. So even if the isolation is bug-free, it is trivial for a user or automated tooling to foot-gun a plugin which uses static fields by changing the plugin.version\r\n # The concern about the backwards-compatibility when plugin.version is unset is valid. We made some attempts to use the connector's class loader or delegating class loader like in the old implementation, so perhaps the version being explicitly injected is not just a cosmetic problem.\r\n\r\nIMHO we should investigate the backwards-compatibility problem and try and make a minimal fix to preserve the old behavior when plugin.version is unset. And the affected plugins should eliminate their usage of static variables in order to be well behaved when the plugin.version is set.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-07T20:48:22.413+0000", "updated": "2025-10-07T20:48:22.413+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028298", "id": "18028298", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "body": "??I don't think communication via static fields is good practice, and should be avoided if possible. I personally have been on the receiving end of bugs caused by static fields within a single plugin; I also think I personally would not like to debug static fields shared across plugins.??\r\n\r\nI agree that this is not the best approach, but the problem here is to understand what is possible and what is not.\r\n\r\nAFAIK, until KC 4.0, this was possible due to plugin isolation, as the same classloader was used to load the connector and its dependencies.\u00a0\r\n\r\nEven I think that plugin versioning is compatible also with the isolation (and this seems to be the goal of [KIP-891|https://cwiki.apache.org/confluence/display/KAFKA/KIP-891%3A+Running+multiple+versions+of+Connector+plugins]), if this is something that is not true anymore, I would have expected it to be changed in a major release and not in a minor one.\r\n\r\n??In deployments which make use of the plugin.version configs, changing the pinned version will necessarily change which instance of a static variable is used. So even if the isolation is bug-free, it is trivial for a user or automated tooling to foot-gun a plugin which uses static fields by changing the plugin.version??\r\n\r\nCan you better clarify this point?\u00a0\r\n\r\n??IMHO we should investigate the backwards-compatibility problem and try and make a minimal fix to preserve the old behavior when plugin.version is unset??\r\n\r\nAnother thing to say here is that the `DelegatingClassLoader.findPluginLoader()` is not only used for transformations and predicates but also for loading the connectors themselves. So to me, this also seems to break the versioning of the connectors.\u00a0\r\n\r\n??And the affected plugins should eliminate their usage of static variables in order to be well behaved when the plugin.version is set??\r\n\r\nHonestly, I'm not getting the point here. I expect that even with a correct management of `plugin.version`, the isolation must be preserved. What happens in the following situation where `plugin.path=opt/plugins/`:\r\n{noformat}\r\nopt/\r\n  plugins/\r\n    blue/\r\n      foo-connector-1.8/\r\n        foo-connector-1.8.jar\r\n        foo-dependencies-1.0.jar\r\n      foo-connector-1.9/\r\n        foo-connector-1.9.jar\r\n        foo-dependencies-1.1.jar\r\n{noformat}\r\nAnd I register a connector `foo-connector` with version 1.8 and SMT (suppose it is in the foo-dependencies) with version 1.1? Is this possible? In the same way, this breaks the isolation. Isn't it?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T07:57:55.409+0000", "updated": "2025-10-08T08:01:44.446+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028299", "id": "18028299", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "1. I agree, I don't think it's a good pattern. But I think this is only a symptom that highlights the non-deterministic, and IMHO unsafe, way plugins are loaded as I try to explain in 2. / 3.\r\n\r\n2. / 3. When looking for a plugin that matches the requested name and version, I think we should prioritize the instance in the classloader of the current connector. If multiple copies of the same plugin exists, the current logic loads the instance from the last plugin path directory ordered alphabetically, which to me is pretty much a random one as it depends on which plugins (and their names) you have installed. If you have a class in your JAR file, you don't want that class to be loaded from another JAR file.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-08T07:58:34.694+0000", "updated": "2025-10-08T07:58:34.694+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028354", "id": "18028354", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "body": "We did/should continue to have a policy of choosing the co-located plugin when all else is equal, see KAFKA-8819. This has unintentionally regressed with KIP-891 and should be fixed.\r\n\r\nHowever my point was that this is a very brittle setup that will only work as long as a plugin and it's connector are not isolated from one another (in the same PluginClassLoader). As soon as they are isolated, or once someone uses plugin.version to select another instance, or perhaps once a newer version is installed, I would expect this to break again.\r\n\r\nMario, your example plugin path is an incorrect installation, because the plugins are all in the same class loader (corresponding to the blue directory). Only one version will be discovered, and it will be arbitrary based on filesystem order. It is very likely that the different versions of the classes collide and cause more serious problems, so Connect does not consider those cases (and it's also distinct from the bug being discussed here). That directly structure is meant to be used with `plugin.path=opt/plugins/blue/`.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T12:36:49.557+0000", "updated": "2025-10-08T12:36:49.557+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028357", "id": "18028357", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "body": "> That directly structure is meant to be used with `plugin.path=opt/plugins/blue/`.\r\n\r\nSorry, I wrongly typed the plugin.path. I intend to write `plugin.path=opt/plugins/blue/`\r\n\r\n> As soon as they are isolated, or once someone uses plugin.version to select another instance, or perhaps once a newer version is installed, I would expect this to break again.\r\n\r\nI still didn't get your point here. If a connector is isolated, then all other plugins that are listed in the same directly should be loaded with the same classloader. Isn't it?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T12:48:35.847+0000", "updated": "2025-10-08T12:51:28.187+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028366", "id": "18028366", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "body": "In your example, foo-connector-1.8 and foo-connector-1.9 are isolated from one another. They are each co-located/not-isolated from their dependencies and any contained SMTs.\r\n\r\nIf you dont specify plugin.version at all, you should get the 1.9 (latest) version of the connector, the co-located version of the dependencies (non-plugins), and the 1.1 (latest) version of the SMT. This is the good path, because the latest plugins are all present in the same location.\r\n\r\nBut there are several bad paths where static variables cannot be shared:\r\n * If you reference an SMT that is not co-located (installed in some other directory)\r\n * If you specify the 1.0 version of the SMT, the 1.9 version of the connector will be loaded because it's latest\r\n * If you specify version 1.8 of the connector, the 1.1 version of the SMT will be loaded because it's latest\r\n * Another plugin is installed with a later version (1.2) of the SMT", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T13:20:27.450+0000", "updated": "2025-10-08T13:20:27.450+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028371", "id": "18028371", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "body": "Now it's clear. Thanks for the detailed explanation.\u00a0\r\n\r\nI think this needs to be reported in the documentation since it's crucial.\r\n\r\nWell, in that case, I have to say that the new versioning feature introduced more flexibility, which is good, but at the same time, you can have the same \"strict\" level of isolation as before, if you configure your versions to maintain it. Previously the isolation was achieved with the directory structure on the file system.\u00a0\r\n\r\nIn my example, if I want the full isolation for both connector versions, I need to specify for\u00a0\r\n{noformat}\r\n1.8: connector verions = 1.8 and SMT version = 1.0\r\n19.: connector version = 1.9 and SMT version = 1.1\r\n{noformat}\r\nThat said. I dunno if this full flexibility will be used so often since it can lead to strange behavior, but maybe this is just my limited experience view.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T13:36:42.533+0000", "updated": "2025-10-08T13:40:53.789+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028384", "id": "18028384", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "body": "I don't think you and I are using the word \"isolation\" in the same way, and maybe that's the cause of some of the friction here. The boundaries of isolation are still specified at installation time in the same way as they were before, only now users can choose older versions for each plugin.\r\n\r\nIt feels strange (that 1.8+1.1 and 1.9+1.0 are broken) because static field sharing adds context that operators have to keep in mind when doing upgrades. Users are going to want to focus on data-flow/semantics when performing upgrades, not debugging static field aliasing.\r\n\r\nFWIW, static field sharing between plugins has never been in the mental model for Connect plugins, and the threading model/initialization order/lifecycle of plugins isn't well defined enough for static fields to be safe to use. That is why I want to push back strongly on this practice, while still admitting that we broke backwards compat and need to fix it.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T14:25:18.451+0000", "updated": "2025-10-08T14:25:18.451+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028391", "id": "18028391", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "body": "> I don't think you and I are using the word \"isolation\" in the same way, and maybe that's the cause of some of the friction here. The boundaries of isolation are still specified at installation time in the same way as they were before, only now users can choose older versions for each plugin.\r\n\r\nFor me, isolation means loading with the same classLoader.\u00a0\r\n\r\n> It feels strange (that 1.8+1.1 and 1.9+1.0 are broken) because static field sharing adds context that operators have to keep in mind when doing upgrades.\u00a0\r\n\r\nThis could happen not only for static field sharing but for any breaking change. For example, imagine a source connector that renames some field in a non-backward-compatible manner (in a major release) and and SMT should adapt to that change. An operator has to keep in mind this right?\r\n\r\n> FWIW, static field sharing between plugins has never been in the mental model for Connect plugins, and the threading model/initialization order/lifecycle of plugins isn't well defined enough for static fields to be safe to use. That is why I want to push back strongly on this practice,\r\n\r\nAs said previously, also before this issue, I had a bad feeling about this static field sharing, and now I have the proof that it was a design flaw. I'm currently looking for a different way to achieve it. That said, here the problem is another.\u00a0\r\n\r\nIf my understanding is correct, please correct me if I'm wrong, in KC version until 4.0 the isolation of the connector was done just with directory separation inside the `plugin.path` folder. Level 1 directories are isolated from each other. This is similar to what happens to war files in application servers, where each war is loaded with a different class loader.\u00a0\r\n\r\nWith KC 4.1 this is no more true, since all is guided by version and your level 1 directory has no more importance for class loader isolation since you could have a connector in a level 0 folder, let's say connector a, that could then use a plugin (SMT, Converter, etc) that is in another lavel 1 folder, so loaded with a different class loader, just because it is the one thath mathes the desidered version.\u00a0\r\n\r\nIf my understanding of the past and current status for me, this is a huge behavior change that shouldn't have happened in a minor release, and so we need to be as backward compatible as possible.\u00a0", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T15:02:37.977+0000", "updated": "2025-10-08T15:04:24.300+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028400", "id": "18028400", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "body": "For me, two plugins are \"isolated\" when they have different classloaders. This allows them to pull in other dependencies completely independently.\r\n\r\nYou're right that this generalizes to any binary compatibility between classes. If you have classes in the same class loader, they need to be binary compatible and loadable together. Because this is difficult to manage, plugin isolation was implemented to permit plugins to be distributed independently from one another.\r\n\r\nNo your understanding of isolation is not correct, as the directory structure has not changed. A plugin path (config) is made up of plugin path elements (level 0). Each plugin path element contains multiple plugin locations (level 1). Each plugin location may contain multiple jars (level 2+). PluginClassLoaders are instantiated at level 1, and different jar files at level 2+ are included together in the same loader.\r\n\r\nWhat has changed in a backwards-incompatible way is that when plugin.version is not specified, the copy in the connector is preferred. Now an arbitrary copy of the latest version is preferred. This should go back to how it was before.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gharris1727", "name": "gharris1727", "key": "gharris1727", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg Harris", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-08T15:58:21.044+0000", "updated": "2025-10-08T15:58:21.044+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028404", "id": "18028404", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "I think we now all agree on the issue. It's clear there's a regression in 4.1.0. We found it via some questionable logic used in Debezium but this is clearly a change in behavior that is not correct.\r\n\r\nI've started working on a fix, unfortunately so far I've not found a quick/small fix. I hope to have something ready to review later this week.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-08T16:11:03.881+0000", "updated": "2025-10-08T16:11:03.881+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028579", "id": "18028579", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "body": "> PluginClassLoaders are instantiated at level 1, and different jar files at level 2+ are included together in the same loader.\r\n\r\n[~gharris1727] This matches my understanding. But now, apart from when `plugin.version` is not specified, this will no more true.\u00a0\r\n\r\nIf you have this situation where the `plugin.path` is `opt/ plugins/ blue/`:\r\n{noformat}\r\nopt/\r\n  plugins/\r\n    blue/\r\n      foo-connector-1.8/\r\n        foo-connector-1.8.jar\r\n        foo-dependencies-1.0.jar\r\n      foo-connector-1.9/\r\n        foo-connector-1.9.jar\r\n        foo-dependencies-1.1.jar{noformat}\r\nAnd based on what you said, in KC 4.0, I'll have a classloader for :\r\n * foo-connector-1.8 that loads the foo-connector-1.8.jar and foo-dependencies-1.0.jar\r\n * foo-connector-1.9 that loads the foo-connector-1.9.jar foo-dependencies-1.1.jar\r\n\r\nWith KC 4.1, if I do not specify any version, the expected behavior will be to have foo-connector-1.9.jar and foo-dependencies-1.1.jar used, and by coincidence, they are in the same level 1 folder. But I can set the version in a way that I could use foo-connector-1.8.jar and foo-dependencies-1.1.jar( suppose here there are SMT or any other plugin), leading to having a plugin loaded from a different class loader. Isn't it?\u00a0", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-09T07:51:55.466+0000", "updated": "2025-10-09T07:52:39.151+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18028580", "id": "18028580", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "body": "[~mimaison] Thanks for working on it.\u00a0", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mfvitale", "name": "mfvitale", "key": "JIRAUSER303467", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mario Fiore Vitale", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-09T07:52:28.614+0000", "updated": "2025-10-09T07:52:28.614+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18029031", "id": "18029031", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=snehashisp", "name": "snehashisp", "key": "snehashisp", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "Snehashis Pal", "active": true, "timeZone": "Etc/UTC"}, "body": "Pointing out some more details here. While classloading transformations or predicates we did make a conscious effort to ensure that, in the absence of any provided version, we try to load them using the classloader of the connector it is associated with. This happens [here|https://github.com/apache/kafka/blob/59f51fb3cac66d8096e647eb90be6c5e4ba9f485/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/ConnectorConfig.java#L418] where we pass in the plugin loader for the connector class to the [newPlugin|https://github.com/apache/kafka/blob/59f51fb3cac66d8096e647eb90be6c5e4ba9f485/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/Plugins.java#L376] method, which should load the transformation using the PluginClassLoader of the connector. If the connector and transformation is colocated in the same path this should have ensured the same isolation behaviour as the previous connect version. ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=snehashisp", "name": "snehashisp", "key": "snehashisp", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "Snehashis Pal", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-10T14:08:15.133+0000", "updated": "2025-10-10T14:08:49.088+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18029038", "id": "18029038", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "Yes we have all the data in getTransformationOrPredicate() but it's not used correctly in newPlugin(). From this path, range is never null, even if it's not set in the configuration because Connect always injects a default version for transformations and predicates in EnrichablePlugin.enrich(). So newPlugin() ends up not using the classloader passed from getTransformationOrPredicate().", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-10T14:15:38.054+0000", "updated": "2025-10-10T14:15:38.054+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18029039", "id": "18029039", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "[~snehashisp] It would be great if you could take a look at https://github.com/apache/kafka/pull/20675. Thanks", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-10T14:28:36.991+0000", "updated": "2025-10-10T14:28:36.991+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18030104", "id": "18030104", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lianetm", "name": "lianetm", "key": "JIRAUSER300183", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER300183&avatarId=52523", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER300183&avatarId=52523", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER300183&avatarId=52523", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER300183&avatarId=52523"}, "displayName": "Lianet Magrans", "active": true, "timeZone": "America/Toronto"}, "body": "Hey [~mimaison] , just touching base regarding the 4.1.1 cut. Do we have an idea of how far are we with the PR/fix? Thanks!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lianetm", "name": "lianetm", "key": "JIRAUSER300183", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER300183&avatarId=52523", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER300183&avatarId=52523", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER300183&avatarId=52523", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER300183&avatarId=52523"}, "displayName": "Lianet Magrans", "active": true, "timeZone": "America/Toronto"}, "created": "2025-10-15T14:26:01.776+0000", "updated": "2025-10-15T14:26:01.776+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18030113", "id": "18030113", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "[~lianetm] I put a PR out (https://github.com/apache/kafka/pull/20675) last week. Now we're waiting for reviews. ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-15T15:00:24.464+0000", "updated": "2025-10-15T15:00:24.464+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18031228", "id": "18031228", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "body": "[~lianetm] Sorry for the delay. The fix is merged on trunk and I backported it to 4.1 too.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mimaison", "name": "mimaison", "key": "mimaison", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mickael Maison", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-20T17:56:08.610+0000", "updated": "2025-10-20T17:56:08.610+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13630778/comment/18031275", "id": "18031275", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lianetm", "name": "lianetm", "key": "JIRAUSER300183", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER300183&avatarId=52523", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER300183&avatarId=52523", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER300183&avatarId=52523", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER300183&avatarId=52523"}, "displayName": "Lianet Magrans", "active": true, "timeZone": "America/Toronto"}, "body": "Great, thanks!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lianetm", "name": "lianetm", "key": "JIRAUSER300183", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER300183&avatarId=52523", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER300183&avatarId=52523", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER300183&avatarId=52523", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER300183&avatarId=52523"}, "displayName": "Lianet Magrans", "active": true, "timeZone": "America/Toronto"}, "created": "2025-10-20T23:32:27.531+0000", "updated": "2025-10-20T23:32:27.531+0000"}], "maxResults": 22, "total": 22, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/1", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg", "name": "Blocker", "id": "1"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}}}