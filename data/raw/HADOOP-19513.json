{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13612955", "self": "https://issues.apache.org/jira/rest/api/2/issue/13612955", "key": "HADOOP-19513", "fields": {"summary": "S3A: ITestS3AEndpointRegion fails when using with access points", "description": "failures are of the form:\r\n\r\n\r\n{{software.amazon.awssdk.core.exception.SdkClientException: Invalid configuration: region from ARN `us-east-1` does not match client region `us-east-2` and UseArnRegion is `false`}}\r\n{{\u00a0}}\r\n{{at software.amazon.awssdk.core.exception.SdkClientException$BuilderImpl.build(SdkClientException.java:111)}}\r\n\r\n{{\u00a0}}\r\n{{happens because when making the head request in the tests, we do\u00a0}}\r\n{{HeadBucketRequest.builder().bucket(getFileSystem().getBucket()).build();}}\r\n{{\u00a0}}\r\n{{when using access points, bucket is \"arn:aws:s3:us-east-1:xxxx:accesspoint/test-bucket\", so client gets the region from the ARN which does not match the configured region.\u00a0}}", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=ahmar", "name": "ahmar", "key": "JIRAUSER283484", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "Ahmar Suhail", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13612955/comment/17937998", "id": "17937998", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=ahmar", "name": "ahmar", "key": "JIRAUSER283484", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "Ahmar Suhail", "active": true, "timeZone": "Etc/UTC"}, "body": "a lot of these tests fail for an S3 Express bucket too, as getBucketLocation() is not allowed..\r\n\r\n\u00a0\r\norg.apache.hadoop.fs.s3a.AWSUnsupportedFeatureException: getBucketLocation() on ahmar-sdk-upgrade-cse-kms--use1-az4--x-s3: software.amazon.awssdk.services.s3.model.S3Exception: The specified method is not allowed against this resource. (BgwjiHiSxWSjcmp2qn):MethodNotAllowed: The specified method is not allowed against this resource. (Service: S3, Status Code: 405, Request ID: 0128520F4A010195C9C4CF2005004583203BAAA2, Extended Request ID: BgwjiHiSxWSjcmp2qn)\r\n\u00a0\r\nat org.apache.hadoop.fs.s3a.S3AUtils.translateException(S3AUtils.java:305)\r\nat org.apache.hadoop.fs.s3a.Invoker.once(Invoker.java:124)\r\nat org.apache.hadoop.fs.s3a.Invoker.lambda$retry$4(Invoker.java:376)\r\nat org.apache.hadoop.fs.s3a.Invoker.retryUntranslated(Invoker.java:468)\r\nat org.apache.hadoop.fs.s3a.Invoker.retry(Invoker.java:372)\r\nat org.apache.hadoop.fs.s3a.Invoker.retry(Invoker.java:347)\r\n\u00a0", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=ahmar", "name": "ahmar", "key": "JIRAUSER283484", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "Ahmar Suhail", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-03-24T20:08:49.361+0000", "updated": "2025-03-24T20:09:51.884+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612955/comment/17938175", "id": "17938175", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org", "name": "stevel@apache.org", "key": "stevel@apache.org", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"}, "displayName": "Steve Loughran", "active": true, "timeZone": "Europe/London"}, "body": "Can happen with third party stores too, i think there I just ignore them\r\noptions \r\n* add another test.fs.s3a. switch and allow for all location tests to be skipped. \r\n* add a flag which declares they'll be rejected, and then expect failures (best?)\r\n\r\nLooking at the tests, many seem to consider various exception types as valid outcomes. Maybe AWSUnsupportedFeatureException should be added to the list, so 3express is automatically handled", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org", "name": "stevel@apache.org", "key": "stevel@apache.org", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"}, "displayName": "Steve Loughran", "active": true, "timeZone": "Europe/London"}, "created": "2025-03-25T10:58:53.346+0000", "updated": "2025-03-25T10:58:53.346+0000"}], "maxResults": 2, "total": 2, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}