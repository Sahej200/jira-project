{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13631240", "self": "https://issues.apache.org/jira/rest/api/2/issue/13631240", "key": "KAFKA-19781", "fields": {"summary": "Consumer NoOffsetForPartitionException for partitions being revoked", "description": "Currently, the consumer attempts to update positions for all partitions it owns that don't have a position, even when the partition may be already being revoked. This could lead to NoOffsetForPartitionException for such partitions (if there is no reset strategy defined). There are 2 main issues around this:\r\n * is probably unneeded work to fetch offsets and update positions for partitions being revoked. At that point we're actually not allowing fetching from there anymore\r\n * throwing NoOffsetForPartitionException may lead applications to take action to set positions themselves, which will most probably fail (the partition will most probably not owned by the consumer anymore since it was already being revoked when the NoOffsetForPartitionException was generated). We've seen this on Kafka Streams, that handled NoOffsetForPartitionException by calling seek to set positions.\u00a0 \u00a0\r\n\r\nThis task is to review if there are no other implications I may be missing? Then fix to ensure we don't update positions for partitions being revoked (aligned with how we don't allow fetching from them)\r\n\r\n\u00a0", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lianetm", "name": "lianetm", "key": "JIRAUSER300183", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER300183&avatarId=52523", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER300183&avatarId=52523", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER300183&avatarId=52523", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER300183&avatarId=52523"}, "displayName": "Lianet Magrans", "active": true, "timeZone": "America/Toronto"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13631240/comment/18029322", "id": "18029322", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=goyarpit", "name": "goyarpit", "key": "JIRAUSER301926", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Arpit Goyal", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi [~lianetm]\u00a0 can i pick this up ?\r\n\r\n\u00a0", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=goyarpit", "name": "goyarpit", "key": "JIRAUSER301926", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Arpit Goyal", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-12T16:52:11.384+0000", "updated": "2025-10-12T16:52:11.384+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631240/comment/18029325", "id": "18029325", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=goyarpit", "name": "goyarpit", "key": "JIRAUSER301926", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Arpit Goyal", "active": true, "timeZone": "Etc/UTC"}, "body": "This is what i understand , can can try reproducing it through test also\r\n\r\n.\u00a0 1. Partitions marked for revocation (pendingRevocation = true) are excluded from fetching but NOT from position updates\r\n\u00a0 2. shouldInitialize() only checks if state is INITIALIZING, ignoring pendingRevocation\r\n\u00a0 3. hasValidPosition() only checks fetch state, ignoring pendingRevocation\r\n\u00a0 4. This causes updateFetchPositions() to attempt fetching offsets for partitions being revoked", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=goyarpit", "name": "goyarpit", "key": "JIRAUSER301926", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Arpit Goyal", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-12T16:57:30.715+0000", "updated": "2025-10-12T16:57:30.715+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631240/comment/18029820", "id": "18029820", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lianetm", "name": "lianetm", "key": "JIRAUSER300183", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER300183&avatarId=52523", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER300183&avatarId=52523", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER300183&avatarId=52523", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER300183&avatarId=52523"}, "displayName": "Lianet Magrans", "active": true, "timeZone": "America/Toronto"}, "body": "Hi [~goyarpit], I was already doing some work on this one. I will ping you when ready and would be great if you help with reviews (or follow-ups if I find). Will keep you in the loop. Thanks!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lianetm", "name": "lianetm", "key": "JIRAUSER300183", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER300183&avatarId=52523", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER300183&avatarId=52523", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER300183&avatarId=52523", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER300183&avatarId=52523"}, "displayName": "Lianet Magrans", "active": true, "timeZone": "America/Toronto"}, "created": "2025-10-14T16:20:59.687+0000", "updated": "2025-10-14T16:20:59.687+0000"}], "maxResults": 3, "total": 3, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}