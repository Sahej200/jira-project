{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13632141", "self": "https://issues.apache.org/jira/rest/api/2/issue/13632141", "key": "HADOOP-19732", "fields": {"summary": "Namenode Crash Due to Delegation Renewer Runtime Exit (NoMatchingRule)", "description": "The delegation token renewer enters runtime exit when a _NoMatchingRule_ error, which caused the entire namenode to crash. I think returning an error to the client should be fine but bringing down the namenode is not acceptable to anyone.\r\n\r\nAfter the AD change, the new realm was updated, but some jobs are still using the old realm as users are updating them gradually. This migration process will take time, and during this period, other jobs are still catching up with the new realm configuration. However, the namenode down disrupts all of them.\r\n\r\n\u00a0\r\n{code:java}\r\nERROR org.apache.hadoop.security.token.delegation.AbstractDelegationTokenSecretManager: ExpiredTokenRemover thread received unexpected exception\r\njava.lang.IllegalArgumentException: Illegal principal name hive/xxxxx@yyyy.COM\r\norg.apache.hadoop.security.authentication.util.KerberosName$NoMatchingRule: No rules applied to hive/xxxxx@yyyy.COM \u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.User.<init>(User.java:51)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.User.<init>(User.java:43)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.UserGroupInformation.createRemoteUser(UserGroupInformation.java:1417)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.UserGroupInformation.createRemoteUser(UserGroupInformation.java:1401)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.token.delegation.AbstractDelegationTokenIdentifier.getUser(AbstractDelegationTokenIdentifier.java:80)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.hdfs.security.token.delegation.DelegationTokenIdentifier.getUser(DelegationTokenIdentifier.java:81)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.hdfs.security.token.delegation.DelegationTokenIdentifier.toString(DelegationTokenIdentifier.java:91)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at java.lang.String.valueOf(String.java:2994)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at java.lang.StringBuilder.append(StringBuilder.java:137)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.token.delegation.AbstractDelegationTokenSecretManager.formatTokenId(AbstractDelegationTokenSecretManager.java:58)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.token.delegation.AbstractDelegationTokenSecretManager.logExpireTokens(AbstractDelegationTokenSecretManager.java:642)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.token.delegation.AbstractDelegationTokenSecretManager.removeExpiredToken(AbstractDelegationTokenSecretManager.java:635)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.token.delegation.AbstractDelegationTokenSecretManager.access$400(AbstractDelegationTokenSecretManager.java:51)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.token.delegation.AbstractDelegationTokenSecretManager$ExpiredTokenRemover.run(AbstractDelegationTokenSecretManager.java:694)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at java.lang.Thread.run(Thread.java:750)\r\nCaused by: org.apache.hadoop.security.authentication.util.KerberosName$NoMatchingRule: No rules applied to hive/xxxxx@yyyy.COM\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.authentication.util.KerberosName.getShortName(KerberosName.java:429)\r\n\u00a0 \u00a0 \u00a0 \u00a0 at org.apache.hadoop.security.User.<init>(User.java:48)\r\n\u00a0 \u00a0 \u00a0 \u00a0 ... 14 more {code}\r\n\u00a0", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kpalanisamy", "name": "kpalanisamy", "key": "kpalanisamy", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kpalanisamy&avatarId=43784", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kpalanisamy&avatarId=43784", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kpalanisamy&avatarId=43784", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kpalanisamy&avatarId=43784"}, "displayName": "Karthik Palanisamy", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13632141/comment/18032471", "id": "18032471", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org", "name": "stevel@apache.org", "key": "stevel@apache.org", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"}, "displayName": "Steve Loughran", "active": true, "timeZone": "Europe/London"}, "body": "looks a duplicate of HDFS-17138.\r\n\r\n[~kpalanisamy] please set the hadoop version you saw it with. If it is a version without HDFS-17138 -please upgrade.\r\n\r\nclosing as a duplicate. If it surfaces on branches with HDFS-17138, re-open", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stevel%40apache.org", "name": "stevel@apache.org", "key": "stevel@apache.org", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stevel%40apache.org&avatarId=16513", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stevel%40apache.org&avatarId=16513", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stevel%40apache.org&avatarId=16513", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stevel%40apache.org&avatarId=16513"}, "displayName": "Steve Loughran", "active": true, "timeZone": "Europe/London"}, "created": "2025-10-23T12:41:51.201+0000", "updated": "2025-10-23T12:41:51.201+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13632141/comment/18032558", "id": "18032558", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kpalanisamy", "name": "kpalanisamy", "key": "kpalanisamy", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kpalanisamy&avatarId=43784", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kpalanisamy&avatarId=43784", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kpalanisamy&avatarId=43784", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kpalanisamy&avatarId=43784"}, "displayName": "Karthik Palanisamy", "active": true, "timeZone": "Etc/UTC"}, "body": "You\u2019re right [~stevel@apache.org].\u00a0My user version is 3.1.1, so it is missing this HDFS-17138 fix, which clearly addresses my user scenarios. Thanks for checking so quickly. I should have checked it, but unfortunately I taken your time :)\u00a0", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kpalanisamy", "name": "kpalanisamy", "key": "kpalanisamy", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kpalanisamy&avatarId=43784", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kpalanisamy&avatarId=43784", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kpalanisamy&avatarId=43784", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kpalanisamy&avatarId=43784"}, "displayName": "Karthik Palanisamy", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-23T17:47:42.603+0000", "updated": "2025-10-23T17:47:42.603+0000"}], "maxResults": 2, "total": 2, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}}}