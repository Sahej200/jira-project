{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13632131", "self": "https://issues.apache.org/jira/rest/api/2/issue/13632131", "key": "SPARK-53972", "fields": {"summary": "Streaming Query RecentProgress performance regression in Classic Pyspark", "description": "We have identified a significant performance regression in Apache Spark's streaming recentProgress method in python notebook starting from version 4.0.0. The time required to fetch recentProgress increases substantially as the number of progress records grows, creating a linear or worse scaling issue. We only observe this behavior in classic pyspark.\r\n\r\nWith the following code, it output charts for time it takes to get recentProgress before and after changes in [this commit|https://github.com/apache/spark/commit/22eb6c4b0a82b9fcf84fc9952b1f6c41dde9bd8d#diff-4d4ed29d139877b160de444add7ee63cfa7a7577d849ab2686f1aa2d5b4aae64]\r\n\r\n```\r\n%python\r\nfrom datetime import datetime\r\nimport time\r\n\r\ndf = spark.readStream.format(\"rate\").option(\"rowsPerSecond\", 10).load()\r\nq = df.writeStream.format(\"noop\").start()\r\nprint(\"begin waiting for progress\")\r\n\r\nprogress_list = []\r\ntime_diff_list = []\r\n\r\nnumProgress = len(q.recentProgress)\r\nwhile numProgress < 70 and q.exception() is None:\r\ntime.sleep(1)\r\nbeforeTime = datetime.now()\r\nprint(beforeTime.strftime(\"%Y-%m-%d %H:%M:%S\") +\": before we got those progress: \"+str(numProgress))\r\nrep = q.recentProgress\r\nnumProgress = len(rep)\r\nafterTime = datetime.now()\r\nprint(afterTime.strftime(\"%Y-%m-%d %H:%M:%S\") +\": after we got those progress: \"+str(numProgress))\r\ntime_diff = (afterTime - beforeTime).total_seconds()\r\nprint(\"Total Time: \"+str(time_diff) +\" seconds\")\r\nprogress_list.append(numProgress)\r\ntime_diff_list.append(time_diff)\r\n\r\nq.stop()\r\nq.awaitTermination()\r\nassert(q.exception() is None)\r\n\r\nimport pandas as pd\r\n\r\nplot_df = pd.DataFrame(\\{'numProgress': progress_list, 'time_diff': time_diff_list})\r\ndisplay(spark.createDataFrame(plot_df).orderBy(\"numProgress\").toPandas().plot.line(x=\"numProgress\", y=\"time_diff\"))\r\n```\r\nSee attachment for the generated graph. Attachment 1 is regression shown in current version. Attachment 2 is regression shown in previous version", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zifeif2", "name": "zifeif2", "key": "JIRAUSER311108", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"}, "displayName": "Zifei Feng", "active": true, "timeZone": "America/Los_Angeles"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13632131/comment/18032224", "id": "18032224", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=anishshri-db", "name": "anishshri-db", "key": "JIRAUSER287599", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "Anish Shrigondekar", "active": true, "timeZone": "Etc/UTC"}, "body": "Issue resolved by pull request 52688\n[https://github.com/apache/spark/pull/52688]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=anishshri-db", "name": "anishshri-db", "key": "JIRAUSER287599", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "Anish Shrigondekar", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-22T19:01:07.861+0000", "updated": "2025-10-22T19:01:07.861+0000"}], "maxResults": 1, "total": 1, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}}}