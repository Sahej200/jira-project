{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13626255", "self": "https://issues.apache.org/jira/rest/api/2/issue/13626255", "key": "KAFKA-19603", "fields": {"summary": " Change log.segment.bytes configuration type from int to long to support segments larger than 2GB", "description": "h2. Description\r\nh3. Summary\r\n\r\nChange the data type of *{{log.segment.bytes}}* configuration from *{{int}}* to *{{long}}* to allow segment sizes beyond the current 2GB limit imposed by the integer maximum value.\r\nh3. Current Limitation\r\n\r\nThe {{*log.segment.bytes*}} configuration currently uses an *{{int}}* data type, which limits the maximum segment size to ~2GB (2,147,483,647 bytes). This constraint becomes problematic for modern high-capacity storage deployments.\r\nh3. Background: Kafka Log Segment Structure\r\n\r\nEach Kafka topic partition consists of multiple log segments stored as separate files on disk. For each segment, Kafka maintains three core files:\r\n * {*}{{.log}} files{*}: Contain the actual message data\r\n * {*}{{.index}} files{*}: Store mappings between message offsets and their physical positions within the log file, allowing Kafka to quickly locate messages by their offset without scanning the entire log file\r\n * {*}{{.timeindex}} files{*}: Store mappings between message timestamps and their corresponding offsets, enabling efficient time-based retrieval of messages\r\n\r\nh3. Motivation\r\n # {*}Modern Hardware Capabilities{*}: Current deployments often use high-capacity storage (e.g., EPYC servers with 4\u00d715TB drives) where 2GB segments are inefficiently small\r\n # {*}File Handle Optimization{*}: Large Kafka deployments with many topics can have 50-100k open files across all segment types (.log, .index, .timeindex files). Each segment requires open file handles, and larger segments would reduce the total number of files and improve caching efficiency\r\n # {*}Performance Benefits{*}: Fewer segment rotations in high-traffic scenarios would reduce I/O overhead and improve overall performance. Sequential disk operations are much faster than random access patterns\r\n # {*}Storage Efficiency{*}: Reducing segment file proliferation improves filesystem metadata performance and reduces inode usage on high-volume deployments\r\n # {*}Community Interest{*}: Similar requests have been raised in community forums (see [Confluent forum discussion|https://forum.confluent.io/t/what-happens-if-i-increase-log-segment-bytes/5845])\r\n\r\nh3. Proposed Solution\r\n\r\nChange *{{log.segment.bytes}}* from *{{int}}* to *{{long}}* data type, allowing segment sizes of 3-4GB or larger to better align with modern storage capabilities.\r\nh3. Technical Considerations (Raised by Community)\r\n\r\nBased on dev mailing list discussion:\r\n # {*}Index File Format Limitation{*}: Current index files use 4 bytes to represent file positions within segments, assuming 2GB cap (Jun Rao). This means:\r\n ** {{.index}} files store offset-to-position mappings using 4-byte integers for file positions\r\n ** If segments exceed 2GB, position values would overflow the 4-byte limit\r\n ** Index format may need to be updated to support 8-byte positions\r\n # {*}RemoteLogSegmentMetadata Interface{*}: Public interface currently uses {{int}} for {{segmentSizeInBytes}} and may need updates (Jun Rao)\r\n # {*}Segment File Ecosystem Impact{*}: Need to evaluate impact on all three file types (.log, .index, .timeindex) and their interdependencies\r\n # {*}Impact Assessment{*}: Need to evaluate all components that assume 2GB segment limit\r\n\r\nh3. Questions for Discussion\r\n # What would be a reasonable maximum segment size limit?\r\n # Should this change be backward compatible or require a protocol/format version bump?\r\n # Are there any other components beyond index files and RemoteLogSegmentMetadata that need updates?\r\n\r\nh3. Expected Benefits\r\n * Reduced number of segment files for high-volume topics\r\n * Improved file handle utilization and caching efficiency\r\n * Better alignment with modern storage hardware capabilities\r\n * Reduced segment rotation overhead in high-traffic scenarios\r\n\r\nh3. Acceptance Criteria\r\n * {{log.segment.bytes}} accepts long values > 2GB\r\n * Index file format supports larger segments (if needed)\r\n * RemoteLogSegmentMetadata interface updated (if needed)\r\n * Backward compatibility maintained\r\n * Documentation updated\r\n * Unit and integration tests added\r\n\r\n*Disclaimer*\r\n\r\nI'm relatively new to Kafka internals and the JIRA contribution process. The original idea and motivation came from my experience with large-scale deployments, but I used Claude AI to help make this ticket more detailed and technically structured. There may be technical inaccuracies or missing implementation details that I haven't considered.\r\nThis ticket is open for community discussion and feedback before implementation. \r\n*Expert review and guidance would be greatly appreciated.*", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=proggga", "name": "proggga", "key": "JIRAUSER310671", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Mikhail Fesenko", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13626255/comment/18013645", "id": "18013645", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=aheev", "name": "aheev", "key": "JIRAUSER310228", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34048", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34048", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34048", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34048"}, "displayName": "ally heev", "active": true, "timeZone": "Asia/Kolkata"}, "body": "[~proggga] you might want to create a KIP and add details there. Then, you can trigger disc on mailing list. Guidelines here: https://cwiki.apache.org/confluence/display/KAFKA/Kafka+Improvement+Proposals", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=aheev", "name": "aheev", "key": "JIRAUSER310228", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34048", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34048", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34048", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34048"}, "displayName": "ally heev", "active": true, "timeZone": "Asia/Kolkata"}, "created": "2025-08-13T10:00:54.984+0000", "updated": "2025-08-13T10:00:54.984+0000"}], "maxResults": 1, "total": 1, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}