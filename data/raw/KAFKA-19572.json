{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13625284", "self": "https://issues.apache.org/jira/rest/api/2/issue/13625284", "key": "KAFKA-19572", "fields": {"summary": "Fix NPE messages in ConsoleShareConsumer.", "description": "If there is any failure in construction of KafkaShareConsumer, then it logs a few NPEs while closing.\r\n{code:java}\r\n[2025-07-31 21:45:46,484] ERROR [ShareConsumer clientId=console-share-consumer, groupId=test_1] Failed to release assignment before closing consumer (org.apache.kafka.clients.consumer.internals.ShareConsumerImpl) java.lang.NullPointerException: Cannot invoke \"org.apache.kafka.clients.consumer.internals.events.ApplicationEventHandler.add(org.apache.kafka.clients.consumer.internals.events.ApplicationEvent)\" because \"this.applicationEventHandler\" is null at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.sendAcknowledgementsAndLeaveGroup(ShareConsumerImpl.java:936) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.lambda$close$4(ShareConsumerImpl.java:882) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.common.utils.Utils.swallow(Utils.java:1042) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.close(ShareConsumerImpl.java:881) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:335) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:209) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerDelegateCreator.create(ShareConsumerDelegateCreator.java:49) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:383) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:376) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:357) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.tools.consumer.ConsoleShareConsumer.run(ConsoleShareConsumer.java:75) [kafka-tools-4.1.0.jar:?] at org.apache.kafka.tools.consumer.ConsoleShareConsumer.main(ConsoleShareConsumer.java:57) [kafka-tools-4.1.0.jar:?] [2025-07-31 21:45:46,487] ERROR [ShareConsumer clientId=console-share-consumer, groupId=test_1] Failed to stop finding coordinator (org.apache.kafka.clients.consumer.internals.ShareConsumerImpl) java.lang.NullPointerException: Cannot invoke \"org.apache.kafka.clients.consumer.internals.events.ApplicationEventHandler.add(org.apache.kafka.clients.consumer.internals.events.ApplicationEvent)\" because \"this.applicationEventHandler\" is null at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.stopFindCoordinatorOnClose(ShareConsumerImpl.java:915) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.common.utils.Utils.swallow(Utils.java:1042) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.close(ShareConsumerImpl.java:883) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:335) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:209) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerDelegateCreator.create(ShareConsumerDelegateCreator.java:49) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:383) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:376) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:357) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.tools.consumer.ConsoleShareConsumer.run(ConsoleShareConsumer.java:75) [kafka-tools-4.1.0.jar:?] at org.apache.kafka.tools.consumer.ConsoleShareConsumer.main(ConsoleShareConsumer.java:57) [kafka-tools-4.1.0.jar:?] [2025-07-31 21:45:46,488] ERROR [ShareConsumer clientId=console-share-consumer, groupId=test_1] Failed invoking acknowledgement commit callback (org.apache.kafka.clients.consumer.internals.ShareConsumerImpl) java.lang.NullPointerException: Cannot invoke \"org.apache.kafka.clients.consumer.internals.events.CompletableEventReaper.reap(long)\" because \"this.backgroundEventReaper\" is null at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.processBackgroundEvents(ShareConsumerImpl.java:1107) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.processBackgroundEvents(ShareConsumerImpl.java:1074) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.handleCompletedAcknowledgements(ShareConsumerImpl.java:1023) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.lambda$close$5(ShareConsumerImpl.java:886) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.common.utils.Utils.swallow(Utils.java:1042) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.close(ShareConsumerImpl.java:885) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:335) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:209) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerDelegateCreator.create(ShareConsumerDelegateCreator.java:49) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:383) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:376) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:357) [kafka-clients-4.1.0.jar:?] at org.apache.kafka.tools.consumer.ConsoleShareConsumer.run(ConsoleShareConsumer.java:75) [kafka-tools-4.1.0.jar:?] at org.apache.kafka.tools.consumer.ConsoleShareConsumer.main(ConsoleShareConsumer.java:57) [kafka-tools-4.1.0.jar:?] [2025-07-31 21:45:46,490] ERROR Unknown error when running consumer: (org.apache.kafka.tools.consumer.ConsoleShareConsumer) org.apache.kafka.common.KafkaException: Failed to construct Kafka share consumer at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:338) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerImpl.<init>(ShareConsumerImpl.java:209) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.internals.ShareConsumerDelegateCreator.create(ShareConsumerDelegateCreator.java:49) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:383) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:376) ~[kafka-clients-4.1.0.jar:?] at org.apache.kafka.clients.consumer.KafkaShareConsumer.<init>(KafkaShareConsumer.java:357) ~[kafka-clients-4.1.0.jar:?]{code}\r\nThis is because we are trying to close some resources which were not initialized in the constructor.\r\n\r\nWe need to ensure we check if the resources are null before closing them.", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=shivsundar", "name": "shivsundar", "key": "JIRAUSER303745", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Shivsundar R", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}}}