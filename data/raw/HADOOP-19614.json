{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13623094", "self": "https://issues.apache.org/jira/rest/api/2/issue/13623094", "key": "HADOOP-19614", "fields": {"summary": "Publish Hadoop Docker Image to DockerHub for amd64 and arm64 ", "description": "Update GitHub Actions workflow to publish the apache/hadoop Docker image to DockerHub for multiple arch's: amd64 and arm64.\r\n\r\n", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=abhi_2110", "name": "abhi_2110", "key": "abhi_2110", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=abhi_2110&avatarId=43455", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=abhi_2110&avatarId=43455", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=abhi_2110&avatarId=43455", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=abhi_2110&avatarId=43455"}, "displayName": "Abhishek Kumar", "active": true, "timeZone": "America/New_York"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13623094/comment/18004571", "id": "18004571", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "kumaab opened a new pull request, #7795:\nURL: https://github.com/apache/hadoop/pull/7795\n\n   ### Description of PR\r\n   Update GitHub Actions workflow to publish the `apache/hadoop` Docker image to GitHub Container Registry and DockerHub for multiple architectures: `amd64` and `arm64`.\r\n   \r\n   Image is tagged based on branch name, e.g. docker-hadoop-X.Y is tagged as X.Y.\r\n   \r\n   Pull request only triggers build (for CI), but image is not published.\r\n   \r\n   https://issues.apache.org/jira/browse/HADOOP-19614\r\n   \r\n   ### How was this patch tested?\r\n   \r\n   Pending, waiting on INFRA-27002\r\n   \r\n   ### For code changes:\r\n   \r\n   - [ ] Does the title or this PR starts with the corresponding JIRA issue id (e.g. 'HADOOP-17799. Your PR title ...')?\r\n   - [ ] Object storage: have the integration tests been executed and the endpoint declared according to the connector-specific documentation?\r\n   - [ ] If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under [ASF 2.0](http://www.apache.org/legal/resolved.html#category-a)?\r\n   - [ ] If applicable, have you updated the `LICENSE`, `LICENSE-binary`, `NOTICE-binary` files?\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-11T00:31:12.229+0000", "updated": "2025-07-11T00:31:12.229+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13623094/comment/18008160", "id": "18008160", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "smengcl commented on PR #7795:\nURL: https://github.com/apache/hadoop/pull/7795#issuecomment-3090703143\n\n   > tag step is untested\r\n   \r\n   Is it possible to test it on your own fork and Docker Hub (registry), just to verify if it works?\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-18T20:56:45.326+0000", "updated": "2025-07-18T20:56:45.326+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13623094/comment/18008175", "id": "18008175", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "Copilot commented on code in PR #7795:\nURL: https://github.com/apache/hadoop/pull/7795#discussion_r2217013279\n\n\n##########\n.github/workflows/build-and-tag-hadoop-image.yaml:\n##########\n@@ -0,0 +1,138 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: build-and-tag-hadoop-image\n+\n+# This workflow builds the Hadoop docker image.\n+# For non-PR runs, it also pushes the image to the registry, tagging it based on the branch name.\n+\n+on:\n+  pull_request:\n+    types: [opened, synchronize]\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+  push:\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+\n+permissions:\n+  contents: read\n+  packages: write\n+\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Generate image ID\n+        id: meta\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ghcr.io/${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-hadoop-(.*),value={{branch}},group=1\n+          flavor: |\n+            latest=false\n+\n+      - name: Check if image exists\n+        id: pull\n+        run: |\n+          success=false\n+          if docker pull \"$DOCKER_METADATA_OUTPUT_TAGS\"; then\n+            success=true\n+          fi\n+\n+          echo \"success=$success\" >> $GITHUB_OUTPUT\n+\n+      - name: Set up QEMU\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-qemu-action@49b3bc8e6bdd4a60e6116a5414239cba5943d3cf\n+\n+      - name: Set up Docker Buildx\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-buildx-action@c47758b77c9736f4b2ef4073d4d51994fabfe349\n+\n+      - name: Login to GitHub Container Registry\n+        id: login\n+        if: ${{ github.event_name != 'pull_request' && steps.pull.outputs.success == 'false' }}\n+        uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567\n+        with:\n+          registry: ghcr.io\n+          username: ${{ github.repository_owner }}\n+          password: ${{ secrets.GITHUB_TOKEN }}\n+\n+      - name: Build and push image\n+        id: build\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/build-push-action@4f58ea79222b3b9dc2c8bbdd6debcef730109a75\n+        with:\n+          platforms: linux/amd64,linux/arm64\n+          push: ${{ github.event_name != 'pull_request' }}\n+          tags: ${{ steps.meta.outputs.tags }}\n+          labels: ${{ steps.meta.outputs.labels }}\n+\n+  tag:\n+    needs: build\n+    if: ${{ github.ref_type == 'tag' }}\n+    runs-on: ubuntu-latest\n+    env:\n+      DOCKERHUB_USER: ${{ secrets.DOCKERHUB_USER }}\n+      IMAGE_ID: ${{ needs.build.outputs.image-id }}\n+      REGISTRIES: ghcr.io # docker.io is appended dynamically\n+    steps:\n+      - name: Generate tags\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ${{ github.repository_owner }}/hadoop\n\nReview Comment:\n   This image reference is missing the registry prefix. For DockerHub, it should be `docker.io/${{ github.repository_owner }}/hadoop` or just `apache/hadoop` if targeting the official apache organization.\n   ```suggestion\n               docker.io/${{ github.repository_owner }}/hadoop\n   ```\n\n\n\n##########\n.github/workflows/build-and-tag-hadoop-image.yaml:\n##########\n@@ -0,0 +1,138 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: build-and-tag-hadoop-image\n+\n+# This workflow builds the Hadoop docker image.\n+# For non-PR runs, it also pushes the image to the registry, tagging it based on the branch name.\n+\n+on:\n+  pull_request:\n+    types: [opened, synchronize]\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+  push:\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+\n+permissions:\n+  contents: read\n+  packages: write\n+\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Generate image ID\n+        id: meta\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ghcr.io/${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-hadoop-(.*),value={{branch}},group=1\n+          flavor: |\n+            latest=false\n+\n+      - name: Check if image exists\n+        id: pull\n+        run: |\n+          success=false\n+          if docker pull \"$DOCKER_METADATA_OUTPUT_TAGS\"; then\n+            success=true\n+          fi\n+\n+          echo \"success=$success\" >> $GITHUB_OUTPUT\n+\n+      - name: Set up QEMU\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-qemu-action@49b3bc8e6bdd4a60e6116a5414239cba5943d3cf\n+\n+      - name: Set up Docker Buildx\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-buildx-action@c47758b77c9736f4b2ef4073d4d51994fabfe349\n+\n+      - name: Login to GitHub Container Registry\n+        id: login\n+        if: ${{ github.event_name != 'pull_request' && steps.pull.outputs.success == 'false' }}\n+        uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567\n+        with:\n+          registry: ghcr.io\n+          username: ${{ github.repository_owner }}\n+          password: ${{ secrets.GITHUB_TOKEN }}\n+\n+      - name: Build and push image\n+        id: build\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/build-push-action@4f58ea79222b3b9dc2c8bbdd6debcef730109a75\n+        with:\n+          platforms: linux/amd64,linux/arm64\n+          push: ${{ github.event_name != 'pull_request' }}\n+          tags: ${{ steps.meta.outputs.tags }}\n+          labels: ${{ steps.meta.outputs.labels }}\n+\n+  tag:\n+    needs: build\n+    if: ${{ github.ref_type == 'tag' }}\n+    runs-on: ubuntu-latest\n+    env:\n+      DOCKERHUB_USER: ${{ secrets.DOCKERHUB_USER }}\n+      IMAGE_ID: ${{ needs.build.outputs.image-id }}\n\nReview Comment:\n   The build job does not define any outputs, but the tag job is trying to reference `needs.build.outputs.image-id`. This will result in an empty IMAGE_ID variable and cause the tag job to fail.\n\n\n\n##########\n.github/workflows/build-and-tag-hadoop-image.yaml:\n##########\n@@ -0,0 +1,138 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: build-and-tag-hadoop-image\n+\n+# This workflow builds the Hadoop docker image.\n+# For non-PR runs, it also pushes the image to the registry, tagging it based on the branch name.\n+\n+on:\n+  pull_request:\n+    types: [opened, synchronize]\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+  push:\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+\n+permissions:\n+  contents: read\n+  packages: write\n+\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Generate image ID\n+        id: meta\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ghcr.io/${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-hadoop-(.*),value={{branch}},group=1\n+          flavor: |\n+            latest=false\n+\n+      - name: Check if image exists\n+        id: pull\n+        run: |\n+          success=false\n+          if docker pull \"$DOCKER_METADATA_OUTPUT_TAGS\"; then\n+            success=true\n+          fi\n+\n+          echo \"success=$success\" >> $GITHUB_OUTPUT\n+\n+      - name: Set up QEMU\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-qemu-action@49b3bc8e6bdd4a60e6116a5414239cba5943d3cf\n+\n+      - name: Set up Docker Buildx\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-buildx-action@c47758b77c9736f4b2ef4073d4d51994fabfe349\n+\n+      - name: Login to GitHub Container Registry\n+        id: login\n+        if: ${{ github.event_name != 'pull_request' && steps.pull.outputs.success == 'false' }}\n+        uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567\n+        with:\n+          registry: ghcr.io\n+          username: ${{ github.repository_owner }}\n+          password: ${{ secrets.GITHUB_TOKEN }}\n+\n+      - name: Build and push image\n+        id: build\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/build-push-action@4f58ea79222b3b9dc2c8bbdd6debcef730109a75\n+        with:\n+          platforms: linux/amd64,linux/arm64\n+          push: ${{ github.event_name != 'pull_request' }}\n+          tags: ${{ steps.meta.outputs.tags }}\n+          labels: ${{ steps.meta.outputs.labels }}\n+\n+  tag:\n+    needs: build\n+    if: ${{ github.ref_type == 'tag' }}\n+    runs-on: ubuntu-latest\n+    env:\n+      DOCKERHUB_USER: ${{ secrets.DOCKERHUB_USER }}\n+      IMAGE_ID: ${{ needs.build.outputs.image-id }}\n+      REGISTRIES: ghcr.io # docker.io is appended dynamically\n+    steps:\n+      - name: Generate tags\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-image-(.*),value={{ ref_name }},group=1\n+          flavor: |\n+            latest=false\n+\n+      - name: Add Docker Hub to targets\n+        if: ${{ env.DOCKERHUB_USER }}\n+        run: |\n+          echo \"REGISTRIES=${{ env.REGISTRIES }} docker.io\" >> $GITHUB_ENV\n+\n+      - name: Pull image\n+        run: |\n+          docker pull \"$IMAGE_ID\"\n+\n+      - name: Login to GitHub Container Registry\n+        uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567\n+        with:\n+          registry: ghcr.io\n+          username: ${{ github.repository_owner }}\n+          password: ${{ secrets.GITHUB_TOKEN }}\n+\n+      - name: Login to Docker Hub\n+        if: ${{ env.DOCKERHUB_USER }}\n+        uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567\n+        with:\n+          username: ${{ env.DOCKERHUB_USER }}\n+          password: ${{ secrets.DOCKERHUB_TOKEN }}\n+\n+      - name: Apply tags to existing image\n+        run: |\n+          set -x\n+          for registry in $REGISTRIES; do\n+            opts=\"$(echo \"$DOCKER_METADATA_OUTPUT_TAGS\" | sed \"s@^@--tag $registry/@g\" | xargs echo)\"\n\nReview Comment:\n   The sed command will incorrectly prepend the registry to already-qualified tag names, potentially creating malformed tags like `docker.io/apache/hadoop:3.4.1` becoming `--tag docker.io/docker.io/apache/hadoop:3.4.1`.\n   ```suggestion\n               opts=\"$(echo \"$DOCKER_METADATA_OUTPUT_TAGS\" | sed -E \"s@^[^/]+:[^:]+$@--tag $registry/&@g\" | xargs echo)\"\n   ```\n\n\n\n##########\n.github/workflows/build-and-tag-hadoop-image.yaml:\n##########\n@@ -0,0 +1,138 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: build-and-tag-hadoop-image\n+\n+# This workflow builds the Hadoop docker image.\n+# For non-PR runs, it also pushes the image to the registry, tagging it based on the branch name.\n+\n+on:\n+  pull_request:\n+    types: [opened, synchronize]\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+  push:\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+\n+permissions:\n+  contents: read\n+  packages: write\n+\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Generate image ID\n+        id: meta\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ghcr.io/${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-hadoop-(.*),value={{branch}},group=1\n+          flavor: |\n+            latest=false\n+\n+      - name: Check if image exists\n+        id: pull\n+        run: |\n+          success=false\n+          if docker pull \"$DOCKER_METADATA_OUTPUT_TAGS\"; then\n+            success=true\n+          fi\n+\n+          echo \"success=$success\" >> $GITHUB_OUTPUT\n+\n+      - name: Set up QEMU\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-qemu-action@49b3bc8e6bdd4a60e6116a5414239cba5943d3cf\n+\n+      - name: Set up Docker Buildx\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-buildx-action@c47758b77c9736f4b2ef4073d4d51994fabfe349\n+\n+      - name: Login to GitHub Container Registry\n+        id: login\n+        if: ${{ github.event_name != 'pull_request' && steps.pull.outputs.success == 'false' }}\n+        uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567\n+        with:\n+          registry: ghcr.io\n+          username: ${{ github.repository_owner }}\n+          password: ${{ secrets.GITHUB_TOKEN }}\n+\n+      - name: Build and push image\n+        id: build\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/build-push-action@4f58ea79222b3b9dc2c8bbdd6debcef730109a75\n+        with:\n+          platforms: linux/amd64,linux/arm64\n+          push: ${{ github.event_name != 'pull_request' }}\n+          tags: ${{ steps.meta.outputs.tags }}\n+          labels: ${{ steps.meta.outputs.labels }}\n+\n+  tag:\n+    needs: build\n+    if: ${{ github.ref_type == 'tag' }}\n+    runs-on: ubuntu-latest\n+    env:\n+      DOCKERHUB_USER: ${{ secrets.DOCKERHUB_USER }}\n+      IMAGE_ID: ${{ needs.build.outputs.image-id }}\n+      REGISTRIES: ghcr.io # docker.io is appended dynamically\n+    steps:\n+      - name: Generate tags\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-image-(.*),value={{ ref_name }},group=1\n\nReview Comment:\n   The syntax `{{ ref_name }}` is incorrect for GitHub Actions. It should be `${{ github.ref_name }}` to properly reference the tag name.\n   ```suggestion\n               type=match,pattern=docker-image-(.*),value=${{ github.ref_name }},group=1\n   ```\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-18T22:52:21.030+0000", "updated": "2025-07-18T22:52:21.030+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13623094/comment/18008733", "id": "18008733", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "kumaab commented on PR #7795:\nURL: https://github.com/apache/hadoop/pull/7795#issuecomment-3097053536\n\n   > > tag step is untested\r\n   > \r\n   > Is it possible to test it on your own fork and Docker Hub (registry), just to verify if it works?\r\n   \r\n   Thanks @smengcl for the suggestion, I tried running in my fork - it runs indeed after committing changes to trunk in my fork. However, I'm running into issues in getting the `tag` job to run, `tag` job is currently skipped and a successful `tag` push via `git push origin <tag_name>` doesn't seem to trigger the job, investigating the cause currently, thanks. \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-21T14:37:05.496+0000", "updated": "2025-07-21T14:37:05.496+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13623094/comment/18014973", "id": "18014973", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "jesusch commented on PR #7795:\nURL: https://github.com/apache/hadoop/pull/7795#issuecomment-3201572870\n\n   Hi,\r\n   \r\n   I am a bit confused - with hadoop-3.4.1 there seem to be no more aarch64 binaries on the apache servers?\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-19T17:20:50.625+0000", "updated": "2025-08-19T17:20:50.625+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13623094/comment/18019520", "id": "18019520", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "adoroszlai commented on code in PR #7795:\nURL: https://github.com/apache/hadoop/pull/7795#discussion_r2338927296\n\n\n##########\n.github/workflows/build-and-tag-hadoop-image.yaml:\n##########\n@@ -0,0 +1,138 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: build-and-tag-hadoop-image\n+\n+# This workflow builds the Hadoop docker image.\n+# For non-PR runs, it also pushes the image to the registry, tagging it based on the branch name.\n+\n+on:\n+  pull_request:\n+    types: [opened, synchronize]\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+  push:\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+\n+permissions:\n+  contents: read\n+  packages: write\n+\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Generate image ID\n+        id: meta\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ghcr.io/${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-hadoop-(.*),value={{branch}},group=1\n+          flavor: |\n+            latest=false\n+\n+      - name: Check if image exists\n+        id: pull\n+        run: |\n+          success=false\n+          if docker pull \"$DOCKER_METADATA_OUTPUT_TAGS\"; then\n+            success=true\n+          fi\n+\n+          echo \"success=$success\" >> $GITHUB_OUTPUT\n+\n+      - name: Set up QEMU\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-qemu-action@49b3bc8e6bdd4a60e6116a5414239cba5943d3cf\n+\n+      - name: Set up Docker Buildx\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/setup-buildx-action@c47758b77c9736f4b2ef4073d4d51994fabfe349\n+\n+      - name: Login to GitHub Container Registry\n+        id: login\n+        if: ${{ github.event_name != 'pull_request' && steps.pull.outputs.success == 'false' }}\n+        uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567\n+        with:\n+          registry: ghcr.io\n+          username: ${{ github.repository_owner }}\n+          password: ${{ secrets.GITHUB_TOKEN }}\n+\n+      - name: Build and push image\n+        id: build\n+        if: ${{ steps.pull.outputs.success == 'false' }}\n+        uses: docker/build-push-action@4f58ea79222b3b9dc2c8bbdd6debcef730109a75\n+        with:\n+          platforms: linux/amd64,linux/arm64\n+          push: ${{ github.event_name != 'pull_request' }}\n+          tags: ${{ steps.meta.outputs.tags }}\n+          labels: ${{ steps.meta.outputs.labels }}\n+\n+  tag:\n+    needs: build\n+    if: ${{ github.ref_type == 'tag' }}\n\nReview Comment:\n   Hadoop images are tagged based on branch name, not by explicit Git tags.  Images built for the branch `docker-hadoop-3.4.1` get published with Docker tag `3.4.1`.  Thus the condition `ref_type == 'tag'` should be removed.\n\n\n\n##########\n.github/workflows/build-and-tag-hadoop-image.yaml:\n##########\n@@ -0,0 +1,138 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+name: build-and-tag-hadoop-image\n+\n+# This workflow builds the Hadoop docker image.\n+# For non-PR runs, it also pushes the image to the registry, tagging it based on the branch name.\n+\n+on:\n+  pull_request:\n+    types: [opened, synchronize]\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+  push:\n+    branches:\n+      - 'docker-hadoop-**'\n+      - '!docker-hadoop-runner-**'\n+\n+permissions:\n+  contents: read\n+  packages: write\n+\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Generate image ID\n+        id: meta\n+        uses: docker/metadata-action@8e5442c4ef9f78752691e2d8f8d19755c6f78e81\n+        with:\n+          images: |\n+            ghcr.io/${{ github.repository_owner }}/hadoop\n+          tags: |\n+            type=match,pattern=docker-hadoop-(.*),value={{branch}},group=1\n\nReview Comment:\n   This image ID (which will be checked for existence) should be generated based on commit SHA, not branch name.  Otherwise it will not be possible to build new image for the same branch when changes are needed.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-11T07:41:03.937+0000", "updated": "2025-09-11T07:41:03.937+0000"}], "maxResults": 6, "total": 6, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/3", "description": "This issue is being actively worked on at the moment by the assignee.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/inprogress.png", "name": "In Progress", "id": "3", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4", "id": 4, "key": "indeterminate", "colorName": "yellow", "name": "In Progress"}}}}