{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13631714", "self": "https://issues.apache.org/jira/rest/api/2/issue/13631714", "key": "SPARK-53937", "fields": {"summary": "SparkSQL partition overwrite is not an atomic operation.", "description": "I found that SparkSQL partition overwrite is not an atomic operation. When SparkSQL application rewrites existing table partition, [delete the matching partition]([https://github.com/apache/spark/blob/24a6abf34d253162055c8b9bd0030bf9a2ca75b1/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/InsertIntoHadoopFsRelationCommand.scala#L136]), then run the job.\r\n\r\nDuring task execution, the Hive partition is not deleted, but the data in the filesystem is deleted. If you read data while the job is running, you will read empty data. If the job is interrupted, the data will be lost.\r\n\r\nNote: Only for spark.sql.hive.convertMetastoreOrc or spark.sql.hive.convertMetastoreParquet is true. It is not problem for hive serde.", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhengchenyu", "name": "zhengchenyu", "key": "zhengchenyu", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chenyu Zheng", "active": true, "timeZone": "Asia/Shanghai"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}