{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13625706", "self": "https://issues.apache.org/jira/rest/api/2/issue/13625706", "key": "KAFKA-19584", "fields": {"summary": "Native docker image authentication fails with SASL PLAIN", "description": "I'm trying to use the native docker image for SASL PLAIN authentication.\r\n\r\nThe server starts okay but when I connect a client it emits an exception:\r\n\r\n\r\n\u00a0\r\n{code:java}\r\n[2025-08-06 23:20:47,302] WARN [SocketServer listenerType=BROKER, nodeId=1] Unexpected error from /192.168.178.96 (channelId=192.168.178.96:9092-192.168.178.96:42552-1-1); closing connection (org.apache.kafka.common.network.Selector) java.lang.UnsupportedOperationException: Unable to find suitable Subject#doAs or Subject#callAs implementation at org.apache.kafka.common.internals.UnsupportedStrategy.createException(UnsupportedStrategy.java:40) ~[?:?] at org.apache.kafka.common.internals.UnsupportedStrategy.callAs(UnsupportedStrategy.java:58) ~[?:?] at org.apache.kafka.common.internals.CompositeStrategy.lambda$callAs$1(CompositeStrategy.java:104) ~[?:?] at org.apache.kafka.common.internals.CompositeStrategy.performAction(CompositeStrategy.java:78) ~[?:?] at org.apache.kafka.common.internals.CompositeStrategy.callAs(CompositeStrategy.java:104) ~[?:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.createSaslServer(SaslServerAuthenticator.java:208) ~[?:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.handleKafkaRequest(SaslServerAuthenticator.java:533) ~[?:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.authenticate(SaslServerAuthenticator.java:281) ~[?:?] at org.apache.kafka.common.network.KafkaChannel.prepare(KafkaChannel.java:181) ~[?:?] at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:548) [kafka.Kafka:?] at org.apache.kafka.common.network.Selector.poll(Selector.java:486) [kafka.Kafka:?] at kafka.network.Processor.poll(SocketServer.scala:1017) [kafka.Kafka:?] at kafka.network.Processor.run(SocketServer.scala:921) [kafka.Kafka:?] at java.base/java.lang.Thread.runWith(Thread.java:1596) [kafka.Kafka:?] at java.base/java.lang.Thread.run(Thread.java:1583) [kafka.Kafka:?] at org.graalvm.nativeimage.builder/com.oracle.svm.core.thread.PlatformThreads.threadStartRoutine(PlatformThreads.java:833) [kafka.Kafka:?] at org.graalvm.nativeimage.builder/com.oracle.svm.core.posix.thread.PosixPlatformThreads.pthreadStartRoutine(PosixPlatformThreads.java:211) [kafka.Kafka:?] Suppressed: java.lang.ClassNotFoundException: java.security.AccessController at org.graalvm.nativeimage.builder/com.oracle.svm.core.hub.ClassForNameSupport.forName(ClassForNameSupport.java:122) ~[?:?] at org.graalvm.nativeimage.builder/com.oracle.svm.core.hub.ClassForNameSupport.forName(ClassForNameSupport.java:86) ~[?:?] at java.base/java.lang.Class.forName(DynamicHub.java:1356) ~[kafka.Kafka:?] at java.base/java.lang.Class.forName(DynamicHub.java:1345) ~[kafka.Kafka:?] at org.apache.kafka.common.internals.ReflectiveStrategy$Loader.lambda$forName$0(ReflectiveStrategy.java:66) ~[kafka.Kafka:?] at org.apache.kafka.common.internals.LegacyStrategy.<init>(LegacyStrategy.java:45) ~[?:?] at org.apache.kafka.common.internals.CompositeStrategy.<init>(CompositeStrategy.java:49) ~[?:?] at org.apache.kafka.common.internals.CompositeStrategy.<clinit>(CompositeStrategy.java:39) ~[?:?] at org.apache.kafka.common.internals.SecurityManagerCompatibility.get(SecurityManagerCompatibility.java:38) ~[kafka.Kafka:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.createSaslServer(SaslServerAuthenticator.java:208) ~[?:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.handleKafkaRequest(SaslServerAuthenticator.java:533) ~[?:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.authenticate(SaslServerAuthenticator.java:281) ~[?:?] at org.apache.kafka.common.network.KafkaChannel.prepare(KafkaChannel.java:181) ~[?:?] at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:548) [kafka.Kafka:?] at org.apache.kafka.common.network.Selector.poll(Selector.java:486) [kafka.Kafka:?] at kafka.network.Processor.poll(SocketServer.scala:1017) [kafka.Kafka:?] at kafka.network.Processor.run(SocketServer.scala:921) [kafka.Kafka:?] at java.base/java.lang.Thread.runWith(Thread.java:1596) [kafka.Kafka:?] at java.base/java.lang.Thread.run(Thread.java:1583) [kafka.Kafka:?] at org.graalvm.nativeimage.builder/com.oracle.svm.core.thread.PlatformThreads.threadStartRoutine(PlatformThreads.java:833) [kafka.Kafka:?] at org.graalvm.nativeimage.builder/com.oracle.svm.core.posix.thread.PosixPlatformThreads.pthreadStartRoutine(PosixPlatformThreads.java:211) [kafka.Kafka:?] Suppressed: java.lang.NoSuchMethodException: javax.security.auth.Subject.current() at java.base/java.lang.Class.checkMethod(DynamicHub.java:1075) ~[kafka.Kafka:?] at java.base/java.lang.Class.getDeclaredMethod(DynamicHub.java:1165) ~[kafka.Kafka:?] at org.apache.kafka.common.internals.ModernStrategy.<init>(ModernStrategy.java:43) ~[?:?] at org.apache.kafka.common.internals.CompositeStrategy.<init>(CompositeStrategy.java:60) ~[?:?] at org.apache.kafka.common.internals.CompositeStrategy.<clinit>(CompositeStrategy.java:39) ~[?:?] at org.apache.kafka.common.internals.SecurityManagerCompatibility.get(SecurityManagerCompatibility.java:38) ~[kafka.Kafka:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.createSaslServer(SaslServerAuthenticator.java:208) ~[?:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.handleKafkaRequest(SaslServerAuthenticator.java:533) ~[?:?] at org.apache.kafka.common.security.authenticator.SaslServerAuthenticator.authenticate(SaslServerAuthenticator.java:281) ~[?:?] at org.apache.kafka.common.network.KafkaChannel.prepare(KafkaChannel.java:181) ~[?:?] at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:548) [kafka.Kafka:?] at org.apache.kafka.common.network.Selector.poll(Selector.java:486) [kafka.Kafka:?] at kafka.network.Processor.poll(SocketServer.scala:1017) [kafka.Kafka:?] at kafka.network.Processor.run(SocketServer.scala:921) [kafka.Kafka:?] at java.base/java.lang.Thread.runWith(Thread.java:1596) [kafka.Kafka:?] at java.base/java.lang.Thread.run(Thread.java:1583) [kafka.Kafka:?] at org.graalvm.nativeimage.builder/com.oracle.svm.core.thread.PlatformThreads.threadStartRoutine(PlatformThreads.java:833) [kafka.Kafka:?] at org.graalvm.nativeimage.builder/com.oracle.svm.core.posix.thread.PosixPlatformThreads.pthreadStartRoutine(PosixPlatformThreads.java:211) [kafka.Kafka:?]{code}\r\n\u00a0\r\n\u00a0\r\nReproducer bash script:\r\n\r\n\r\n{code:java}\r\ntemp_dir=$(mktemp -d)\r\ncd ${temp_dir}\r\ncat << EOF > kafka_server_jaas.conf\r\nKafkaServer {\r\n\u00a0 \u00a0 org.apache.kafka.common.security.plain.PlainLoginModule required\r\n\u00a0 \u00a0 user_admin=\"admin-secret\";\r\n};\r\nEOF\r\npodman run -it --rm \\\r\n--name kafka-sasl-broker \\\r\n\u00a0 -p 9092:9092 \\\r\n\u00a0 -p 9093:9093 \\\r\n\u00a0 -v ./kafka_server_jaas.conf:/opt/kafka/config/kafka_server_jaas.conf:Z \\\r\n\u00a0 -e KAFKA_CLUSTER_ID=$KAFKA_CLUSTER_ID \\\r\n\u00a0 -e KAFKA_PROCESS_ROLES=broker,controller \\\r\n\u00a0 -e KAFKA_NODE_ID=1 \\\r\n\u00a0 -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=SASL_PLAINTEXT:SASL_PLAINTEXT,INTER_BROKER:PLAINTEXT,CONTROLLER:PLAINTEXT \\\r\n\u00a0 -e KAFKA_LISTENERS=SASL_PLAINTEXT://0.0.0.0:9092,INTER_BROKER://0.0.0.0:9093,CONTROLLER://0.0.0.0:9094 \\\r\n\u00a0 -e KAFKA_ADVERTISED_LISTENERS=SASL_PLAINTEXT://localhost:9092,INTER_BROKER://localhost:9093 \\\r\n\u00a0 -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \\\r\n\u00a0 -e KAFKA_CONTROLLER_QUORUM_VOTERS=1@localhost:9094 \\\r\n\u00a0 -e KAFKA_INTER_BROKER_LISTENER_NAME=INTER_BROKER \\\r\n\u00a0 -e KAFKA_SASL_ENABLED_MECHANISMS=PLAIN \\\r\n\u00a0 -e KAFKA_OPTS=\"-Djava.security.auth.login.config=/opt/kafka/config/kafka_server_jaas.conf\" \\\r\n\u00a0 apache/${1}{code}\r\nthen to connect I use the producer script to try and send messages:\r\n\r\n\r\n{code:java}\r\nkafka-console-producer.sh \\\r\n\u00a0 --bootstrap-server localhost:9092 \\\r\n\u00a0 --topic your-topic-name \\\r\n\u00a0 --producer-property security.protocol=SASL_PLAINTEXT \\\r\n\u00a0 --producer-property sasl.mechanism=PLAIN \\\r\n\u00a0 --producer-property 'sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=\"admin\" password=\"admin-secret\";'{code}\r\n\r\nFor `./run-plain.sh kafka-native:4.0.0` and `./run-plain.sh kafka-native:4.1.0-rc2` the producer spins, trying repeatedly to reconnect\r\n\r\nFor the main image `./run-plain.sh kafka:4.0.0` and `./run-plain.sh kafka:4.1.0-rc2` I can produce messages successfully.\r\n\r\nFor context I want to use the native image for integration testing and can workaround by switching to the non-native image", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=robyoung", "name": "robyoung", "key": "JIRAUSER298079", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Rob Young", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}