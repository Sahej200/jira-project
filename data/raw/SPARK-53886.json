{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13631412", "self": "https://issues.apache.org/jira/rest/api/2/issue/13631412", "key": "SPARK-53886", "fields": {"summary": "Percentile estimation functions", "description": "Similar to https://issues.apache.org/jira/browse/SPARK-53885, it would be useful to have the following percentile estimation functions based on data sketch. These functions provide a lightweight, mergeable representation of percentile distributions, enabling efficient approximate percentile computation over large or streaming datasets without maintaining full data samples.\r\n * *APPROX_PERCENTILE_ACCUMULATE(expr[, maxItemsTracked]):* Creates an intermediate state object that incrementally accumulates values for percentile estimation using a sketch-based algorithm.\r\n\r\n * *APPROX_PERCENTILE_ESTIMATE(state [, k]\u00a0])* : Returns the approximate percentile value(s) from a previously accumulated sketch state.\r\n\r\n * *APPROX_PERCENTILE_COMBINE(expr[, maxItemsTracked])* : Merges two intermediate sketch states to enable distributed or parallel percentile estimation.", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=Gengliang.Wang", "name": "Gengliang.Wang", "key": "gengliang.wang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=gengliang.wang&avatarId=36477", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gengliang.wang&avatarId=36477", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gengliang.wang&avatarId=36477", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gengliang.wang&avatarId=36477"}, "displayName": "Gengliang Wang", "active": true, "timeZone": "Asia/Hong_Kong"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13631412/comment/18029573", "id": "18029573", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=Gengliang.Wang", "name": "Gengliang.Wang", "key": "gengliang.wang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=gengliang.wang&avatarId=36477", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gengliang.wang&avatarId=36477", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gengliang.wang&avatarId=36477", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gengliang.wang&avatarId=36477"}, "displayName": "Gengliang Wang", "active": true, "timeZone": "Asia/Hong_Kong"}, "body": "cc [~cboumalh] [~yhuang95] \u2014 would you be interested in taking on these new functions?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=Gengliang.Wang", "name": "Gengliang.Wang", "key": "gengliang.wang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=gengliang.wang&avatarId=36477", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gengliang.wang&avatarId=36477", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gengliang.wang&avatarId=36477", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gengliang.wang&avatarId=36477"}, "displayName": "Gengliang Wang", "active": true, "timeZone": "Asia/Hong_Kong"}, "created": "2025-10-13T17:45:27.811+0000", "updated": "2025-10-13T17:45:27.811+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631412/comment/18029885", "id": "18029885", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=cboumalh", "name": "cboumalh", "key": "JIRAUSER309943", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"}, "displayName": "Christopher Boumalhab", "active": true, "timeZone": "Etc/UTC"}, "body": "[~Gengliang.Wang] I can take these on.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=cboumalh", "name": "cboumalh", "key": "JIRAUSER309943", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"}, "displayName": "Christopher Boumalhab", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-14T20:09:04.660+0000", "updated": "2025-10-14T20:09:04.660+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631412/comment/18029887", "id": "18029887", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=cboumalh", "name": "cboumalh", "key": "JIRAUSER309943", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"}, "displayName": "Christopher Boumalhab", "active": true, "timeZone": "Etc/UTC"}, "body": "[~Gengliang.Wang] Are we interested in creating something like this [https://github.com/apache/datasketches-hive], but for spark? Basically introducing sketch dependencies through connector repo instead of adding them directly to the spark codebase.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=cboumalh", "name": "cboumalh", "key": "JIRAUSER309943", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"}, "displayName": "Christopher Boumalhab", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-14T20:16:17.422+0000", "updated": "2025-10-14T20:16:17.422+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631412/comment/18029905", "id": "18029905", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=Gengliang.Wang", "name": "Gengliang.Wang", "key": "gengliang.wang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=gengliang.wang&avatarId=36477", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gengliang.wang&avatarId=36477", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gengliang.wang&avatarId=36477", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gengliang.wang&avatarId=36477"}, "displayName": "Gengliang Wang", "active": true, "timeZone": "Asia/Hong_Kong"}, "body": "[~cboumalh] Thank for taking this!\u00a0\r\n\r\n\u00a0\r\n\r\n> Are we interested in creating something like this\u00a0[https://github.com/apache/datasketches-hive], but for spark?\r\n\r\n\u00a0\r\n\r\nNot for now. I think we have already introduced related dependency. This project is to add 3 new functions.\u00a0", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=Gengliang.Wang", "name": "Gengliang.Wang", "key": "gengliang.wang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=gengliang.wang&avatarId=36477", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gengliang.wang&avatarId=36477", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gengliang.wang&avatarId=36477", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gengliang.wang&avatarId=36477"}, "displayName": "Gengliang Wang", "active": true, "timeZone": "Asia/Hong_Kong"}, "created": "2025-10-14T22:49:14.969+0000", "updated": "2025-10-14T22:49:14.969+0000"}], "maxResults": 4, "total": 4, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}