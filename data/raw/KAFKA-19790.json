{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13631603", "self": "https://issues.apache.org/jira/rest/api/2/issue/13631603", "key": "KAFKA-19790", "fields": {"summary": "Parsing of the scope claim does not comply with RFC-8693", "description": "I notice that the code in Kafka for handling of the scopes claim does not comply with the RFC.\r\n\r\n[https://datatracker.ietf.org/doc/html/rfc8693#name-scope-scopes-claim |https://datatracker.ietf.org/doc/html/rfc8693#name-scope-scopes-claim]says:\r\n{quote}The value of the\u00a0{{scope}}\u00a0claim is a JSON string containing a space-separated list of scopes associated with the token, in the format described in\u00a0[Section 3.3|https://www.rfc-editor.org/rfc/rfc6749#section-3.3]\u00a0of [[RFC6749|https://datatracker.ietf.org/doc/html/rfc6749]]\r\n{quote}\r\n\u00a0\r\n\r\nHowever the code in Kafka that parses the JWT payload does not permit a space separated list.\u00a0 It would treat a value like \"email phone address\" as a single scope \"email phone address\" rather than a three separate scopes of \"email\", \"phone\", \"address\".\r\n\r\nThe affected code is here:\r\n\r\n[https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/security/oauthbearer/BrokerJwtValidator.java#L166]\r\n\r\n[https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/security/oauthbearer/internals/unsecured/OAuthBearerUnsecuredJws.java#L343]\r\n\r\nImpact:\r\n\r\nLooking at the production code in Apache Kafka itself, I think the defect currently harmless.\u00a0 As far as I can tell, there's no production code that makes use of\u00a0 org.apache.kafka.common.security.oauthbearer.internals.secured.BasicOAuthBearerToken#scope.\r\n\r\nI think there would be a potential for impact for a user writing their own OAuthBearerValidatorCallbackHandler that uses Kafka's BrokerJwtValidator and made use of the scope value.\r\n\r\nFailing unit test:\r\n\r\n[https://github.com/apache/kafka/compare/trunk...k-wall:kafka:KAFKA-19790]\r\n\r\n\u00a0", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kwall", "name": "kwall", "key": "k-wall", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Keith Wall", "active": true, "timeZone": "Europe/London"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13631603/comment/18030049", "id": "18030049", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kwall", "name": "kwall", "key": "k-wall", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Keith Wall", "active": true, "timeZone": "Europe/London"}, "body": "This issue is not blocking me (I noticed it in passing), but I'm happy to put up a PR if there is interest in fixing it.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kwall", "name": "kwall", "key": "k-wall", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Keith Wall", "active": true, "timeZone": "Europe/London"}, "created": "2025-10-15T10:51:40.092+0000", "updated": "2025-10-15T10:51:40.092+0000"}], "maxResults": 1, "total": 1, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}