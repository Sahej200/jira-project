{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13622762", "self": "https://issues.apache.org/jira/rest/api/2/issue/13622762", "key": "HADOOP-19609", "fields": {"summary": "ABFS: Apache Client Connection Pool Relook", "description": null, "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=bhattmanish98", "name": "bhattmanish98", "key": "JIRAUSER306911", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Manish Bhatt", "active": true, "timeZone": "Asia/Kolkata"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18008596", "id": "18008596", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 opened a new pull request, #7817:\nURL: https://github.com/apache/hadoop/pull/7817\n\n   JIRA: https://issues.apache.org/jira/browse/HADOOP-19609\r\n   \r\n   **Description**\r\n   The ABFS (Azure Blob File System) driver currently utilizes the default JDK HTTP client to communicate with the Azure Storage backend service, known as XFE. While the JDK client is lightweight, simple, and built into the JDK, it falls short when it comes to providing advanced connection management capabilities. \r\n   By switching to Apache HTTP Client, the ABFS driver aims to gain better control over HTTP connections while enabling enterprise-level features such as configurable keep-alive strategies, idle connection eviction, retries on failure, and better resource usage tracking. \r\n   This is the initial PR where we have optimized the structure of keep alive cache for Apache client. Migration from JDK and Apache client will be done in subsequent PR.\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-21T06:05:26.684+0000", "updated": "2025-07-21T06:05:26.684+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18008618", "id": "18008618", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3095586717\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 21s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 2 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  40m 53s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 27s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 22s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 27s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 29s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 23s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 47s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 42s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 21s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 21s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 16s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 16s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 13s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/1/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 4 new + 3 unchanged - 0 fixed = 7 total (was 3)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 16s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 45s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 23s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 20s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  93m 52s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/1/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux b6b106bf7326 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / b9e21c77c34a6e66ccf1d38b82b777973ecc38f2 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/1/testReport/ |\r\n   | Max. process+thread count | 556 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/1/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-21T07:40:22.561+0000", "updated": "2025-07-21T07:40:22.561+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18009826", "id": "18009826", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3116394363\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 23s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 2 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  27m 25s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 25s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 22s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 29s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 29s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 20s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 46s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 57s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 20s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 12s |  |  the patch passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 22s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 45s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m  7s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 17s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  81m 28s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/2/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 8f951cfe3624 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / b8310f78cee7139a2ece37578800a0c6037aec5e |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/2/testReport/ |\r\n   | Max. process+thread count | 546 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/2/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-25T04:58:57.528+0000", "updated": "2025-07-25T04:58:57.528+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18010249", "id": "18010249", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3125517139\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 20s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 3 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  26m 34s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 25s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 21s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 28s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 27s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 24s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 48s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 17s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 20s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 13s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/3/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 1 new + 3 unchanged - 0 fixed = 4 total (was 3)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 21s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 17s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 43s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 28s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 18s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  79m 19s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/3/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 0e64d6accc11 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 0993465f913bb7a23ae39dd08425428b45615646 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/3/testReport/ |\r\n   | Max. process+thread count | 546 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/3/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-07-28T05:12:35.364+0000", "updated": "2025-07-28T05:12:35.364+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18011779", "id": "18011779", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3149209343\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 21s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  1s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  1s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 4 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  27m  0s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 28s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 23s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 25s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 29s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 23s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 46s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 34s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 11s |  |  the patch passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 16s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 17s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 42s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m  0s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 14s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  80m 11s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/4/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 1cffcfd19e2d 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 6bf8915c81f5170f265f02cd721035ecc49129b1 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/4/testReport/ |\r\n   | Max. process+thread count | 553 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/4/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-04T05:49:01.571+0000", "updated": "2025-08-04T05:49:01.571+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18011785", "id": "18011785", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3149315502\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 20s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 4 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  27m 49s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 26s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 25s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 30s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 29s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 21s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 49s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m  3s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 16s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 16s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 13s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/5/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 2 new + 3 unchanged - 0 fixed = 5 total (was 3)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 17s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 43s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  20m 58s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 18s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 25s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  80m 58s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/5/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux ea3899ece872 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / e5727c0d5f52712a11b71afb8589b940abd4d1ef |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/5/testReport/ |\r\n   | Max. process+thread count | 545 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/5/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-04T06:38:41.083+0000", "updated": "2025-08-04T06:38:41.083+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18011801", "id": "18011801", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3149581214\n\n   :broken_heart: **-1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 22s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  29m  9s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 24s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 22s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 19s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 28s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 20s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 48s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  25m 44s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 22s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 20s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 16s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 16s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 13s |  |  the patch passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 16s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 37s |  |  the patch passed  |\r\n   | -1 :x: |  shadedclient  |  23m 27s |  |  patch has errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | -1 :x: |  unit  |   0m 23s | [/patch-unit-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/7/artifact/out/patch-unit-hadoop-tools_hadoop-azure.txt) |  hadoop-azure in the patch failed.  |\r\n   | +0 :ok: |  asflicense  |   0m 11s |  |  ASF License check generated no output?  |\r\n   |  |   |  86m  3s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/7/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 279e8ecf28f5 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 058950316aad9df78ab7d4b1864cf6487dc1029f |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/7/testReport/ |\r\n   | Max. process+thread count | 547 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/7/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-04T08:13:28.756+0000", "updated": "2025-08-04T08:13:28.756+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18011954", "id": "18011954", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3152249751\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 19s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  28m  6s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 22s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 20s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 18s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 25s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 19s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 42s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m 31s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 16s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 16s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 10s |  |  the patch passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 16s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 16s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 39s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 58s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m  6s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 22s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  81m 35s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/8/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 15b29919f9d6 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 654f36a62822841d66febac98a00f749f815b041 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/8/testReport/ |\r\n   | Max. process+thread count | 702 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/8/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-04T20:23:40.612+0000", "updated": "2025-08-04T20:23:40.612+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012023", "id": "18012023", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3153278197\n\n   \r\n   ============================================================\r\n   HNS-OAuth-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 879, Failures: 0, Errors: 0, Skipped: 226\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 34\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 23\r\n   \r\n   ============================================================\r\n   HNS-SharedKey-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 4\r\n   [WARNING] Tests run: 879, Failures: 0, Errors: 0, Skipped: 175\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 34\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 10\r\n   \r\n   ============================================================\r\n   NonHNS-SharedKey-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 863, Failures: 0, Errors: 0, Skipped: 398\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 35\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 11\r\n   \r\n   ============================================================\r\n   AppendBlob-HNS-OAuth-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 879, Failures: 0, Errors: 0, Skipped: 237\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 58\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 23\r\n   \r\n   ============================================================\r\n   NonHNS-SharedKey-Blob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 863, Failures: 0, Errors: 0, Skipped: 291\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 27\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 11\r\n   \r\n   ============================================================\r\n   NonHNS-OAuth-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 863, Failures: 0, Errors: 0, Skipped: 403\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 35\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \r\n   ============================================================\r\n   NonHNS-OAuth-Blob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 863, Failures: 0, Errors: 0, Skipped: 306\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 27\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \r\n   ============================================================\r\n   AppendBlob-NonHNS-OAuth-Blob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 863, Failures: 0, Errors: 0, Skipped: 351\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 51\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \r\n   ============================================================\r\n   HNS-Oauth-DFS-IngressBlob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 879, Failures: 0, Errors: 0, Skipped: 359\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 34\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 23\r\n   \r\n   ============================================================\r\n   NonHNS-OAuth-DFS-IngressBlob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 863, Failures: 0, Errors: 0, Skipped: 400\r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 35\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-05T04:47:46.581+0000", "updated": "2025-08-05T04:47:46.581+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012024", "id": "18012024", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2253097719\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/FileSystemConfigurations.java:\n##########\n@@ -212,13 +212,19 @@ public final class FileSystemConfigurations {\n   public static final long THOUSAND = 1000L;\n \n   public static final HttpOperationType DEFAULT_NETWORKING_LIBRARY\n-      = HttpOperationType.JDK_HTTP_URL_CONNECTION;\n+      = HttpOperationType.APACHE_HTTP_CLIENT;\n\nReview Comment:\n   TODO: This change will revert back for now.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-05T04:49:38.965+0000", "updated": "2025-08-05T04:49:38.965+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012097", "id": "18012097", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3154756932\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 20s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  28m 14s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 25s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 21s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 24s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 29s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 29s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 25s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 46s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 27s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  21m 39s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 20s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 15s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 15s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 13s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/10/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 1 new + 4 unchanged - 1 fixed = 5 total (was 5)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 44s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 24s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 17s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 27s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  81m 28s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/10/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 4af37dc5f5fa 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 54a7bca34ea8ab0ec1e8c81137b123b23ff84355 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/10/testReport/ |\r\n   | Max. process+thread count | 729 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/10/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-05T11:10:16.150+0000", "updated": "2025-08-05T11:10:16.150+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012547", "id": "18012547", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2259927834\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AbfsConfiguration.java:\n##########\n@@ -474,15 +474,20 @@ public class AbfsConfiguration{\n       FS_AZURE_APACHE_HTTP_CLIENT_MAX_IO_EXCEPTION_RETRIES, DefaultValue = DEFAULT_APACHE_HTTP_CLIENT_MAX_IO_EXCEPTION_RETRIES)\n   private int maxApacheHttpClientIoExceptionsRetries;\n \n-  /**\n-   * Max idle TTL configuration for connection given in\n-   * {@value org.apache.hadoop.fs.azurebfs.constants.ConfigurationKeys#FS_AZURE_APACHE_HTTP_CLIENT_IDLE_CONNECTION_TTL}\n-   * with default of\n-   * {@value org.apache.hadoop.fs.azurebfs.constants.FileSystemConfigurations#DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME}\n-   */\n-  @LongConfigurationValidatorAnnotation(ConfigurationKey = FS_AZURE_APACHE_HTTP_CLIENT_IDLE_CONNECTION_TTL,\n-      DefaultValue = DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME)\n-  private long maxApacheHttpClientConnectionIdleTime;\n+  @IntegerConfigurationValidatorAnnotation(ConfigurationKey =\n+      FS_AZURE_APACHE_HTTP_CLIENT_MAX_CACHE_CONNECTION_SIZE, DefaultValue = DEFAULT_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS,\n+      MinValue = MIN_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS, MaxValue = MAX_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS)\n+  private int maxApacheHttpClientCacheConnections;\n+\n+  @IntegerConfigurationValidatorAnnotation(ConfigurationKey =\n+      FS_AZURE_CACHE_WARMUP_CONNECTION_COUNT, DefaultValue = DEFAULT_APACHE_CACHE_WARMUP_CONNECTION_COUNT,\n+      MinValue = 0, MaxValue = MIN_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS)\n\nReview Comment:\n   should we keep a separate variable for this as the max value configured by min of something is a bit misleading or are the two always interdependent ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:00:56.889+0000", "updated": "2025-08-07T11:00:56.889+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012548", "id": "18012548", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2259933719\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -280,17 +282,18 @@ HttpResponse executeRequest() throws IOException {\n   /**{@inheritDoc}*/\n   @Override\n   public void setRequestProperty(final String key, final String value) {\n-    List<AbfsHttpHeader> headers = getRequestHeaders();\n-    if (headers != null) {\n-      headers.add(new AbfsHttpHeader(key, value));\n+    if (httpRequestBase instanceof HttpEntityEnclosingRequestBase\n\nReview Comment:\n   kindly explain the need for this change\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:02:42.059+0000", "updated": "2025-08-07T11:02:42.059+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012549", "id": "18012549", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2259933719\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -280,17 +282,18 @@ HttpResponse executeRequest() throws IOException {\n   /**{@inheritDoc}*/\n   @Override\n   public void setRequestProperty(final String key, final String value) {\n-    List<AbfsHttpHeader> headers = getRequestHeaders();\n-    if (headers != null) {\n-      headers.add(new AbfsHttpHeader(key, value));\n+    if (httpRequestBase instanceof HttpEntityEnclosingRequestBase\n\nReview Comment:\n   kindly explain the need for this change, why is CONTENT_LENGTH header skipped ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:08:02.561+0000", "updated": "2025-08-07T11:08:02.561+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012550", "id": "18012550", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2259955603\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n+\n+  /**\n+   * Connection timeout for establishing a new connection.\n+   */\n+  private final int connectionTimeout;\n+\n+  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n\nReview Comment:\n   javadocs for remaining variables as well\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:13:30.283+0000", "updated": "2025-08-07T11:13:30.283+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012551", "id": "18012551", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2259971740\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n\nReview Comment:\n   should come from a config \n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:19:43.549+0000", "updated": "2025-08-07T11:19:43.549+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012552", "id": "18012552", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2259974127\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n+            final long deadline = System.currentTimeMillis() + timeoutMs;\n+\n+            while ((conn = kac.get()) == null\n+                && System.currentTimeMillis() < deadline) {\n+              long waitTime = deadline - System.currentTimeMillis();\n+              if (waitTime <= 0) {\n+                break;\n+              }\n+\n+              try {\n+                connectionLock.wait(waitTime);\n+              } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n\nReview Comment:\n   instead of returning null here why not propagate the exception?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:20:53.030+0000", "updated": "2025-08-07T11:20:53.030+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012554", "id": "18012554", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2259991781\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n+            final long deadline = System.currentTimeMillis() + timeoutMs;\n+\n+            while ((conn = kac.get()) == null\n+                && System.currentTimeMillis() < deadline) {\n+              long waitTime = deadline - System.currentTimeMillis();\n+              if (waitTime <= 0) {\n+                break;\n+              }\n+\n+              try {\n+                connectionLock.wait(waitTime);\n+              } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n+                return null;\n+              }\n+            }\n+\n+            if (conn != null) {\n+              logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n+                  conn, requestId);\n+              return conn;\n+            }\n+\n+            // Timed out \u2014 create a new connection\n+            logDebug(\"Creating new connection for requestId: {}\", requestId);\n+            return createNewConnection();\n\nReview Comment:\n   what if many threads timeout and all call this create new connection, is there a cap on this ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:28:34.065+0000", "updated": "2025-08-07T11:28:34.065+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012555", "id": "18012555", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260002256\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n\nReview Comment:\n   should we use synchronized here as at a time only one thread should be able to get the connection ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:33:06.216+0000", "updated": "2025-08-07T11:33:06.216+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012556", "id": "18012556", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260004929\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n\nReview Comment:\n   2 should come from a config\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T11:34:09.131+0000", "updated": "2025-08-07T11:34:09.131+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012561", "id": "18012561", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260130542\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n\nReview Comment:\n   here add a check that if conn != null then disconnect as exception can occur at any stage\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:12:01.336+0000", "updated": "2025-08-07T12:12:01.336+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012562", "id": "18012562", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260132324\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n+          }\n+        });\n+      }\n+\n+      executorService.shutdown();\n+      try {\n+        if (!executorService.awaitTermination(1, TimeUnit.SECONDS)) {\n\nReview Comment:\n   Isn't 1 second too less of a time to await termination of all tasks ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:12:52.766+0000", "updated": "2025-08-07T12:12:52.766+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012567", "id": "18012567", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260149265\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n+          }\n+        });\n+      }\n+\n+      executorService.shutdown();\n+      try {\n+        if (!executorService.awaitTermination(1, TimeUnit.SECONDS)) {\n+          executorService.shutdownNow();\n+        }\n+      } catch (InterruptedException e) {\n+        executorService.shutdownNow();\n+        Thread.currentThread().interrupt();\n+      } finally {\n+        isCaching.set(false);\n+        logDebug(\"Connection warmup completed in {} ms\", System.currentTimeMillis() - start);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Adds a connection to the cache if it is open and not stale.\n+   * If the connection is added to the cache, it notifies one waiting thread.\n+   *\n+   * @param conn the connection to add to the cache\n+   */\n+  private void addConnectionToCache(HttpClientConnection conn) {\n+    if (conn instanceof AbfsManagedApacheHttpConnection) {\n+      if (((AbfsManagedApacheHttpConnection) conn).getTargetHost().equals(baseHost)) {\n+        boolean connAddedInKac = kac.add(conn);\n+        synchronized (connectionLock) {\n+          connectionLock.notify(); // wake up one thread only\n+        }\n+        if (connAddedInKac) {\n\nReview Comment:\n   what happens to conn if not added to cache as it was already connected ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:20:08.385+0000", "updated": "2025-08-07T12:20:08.385+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012570", "id": "18012570", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260172409\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsManagedApacheHttpConnection.java:\n##########\n@@ -91,7 +97,27 @@ public boolean isOpen() {\n   /**{@inheritDoc}*/\n   @Override\n   public boolean isStale() {\n-    return httpClientConnection.isStale();\n+    try {\n\nReview Comment:\n   any specific reason for not using the isStale existing method and implementing a custom approach ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:29:34.124+0000", "updated": "2025-08-07T12:29:34.124+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012572", "id": "18012572", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260188357\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -259,48 +151,39 @@ public synchronized HttpClientConnection get()\n    * will make space for the new connection. If the cache is closed or of zero size,\n    * the connection is closed and not added to the cache.\n    *\n-   * @param httpClientConnection HttpClientConnection to be cached\n+   * @param conn HttpClientConnection to be cached\n    * @return true if the HttpClientConnection is added in active cache, false otherwise.\n    */\n-  public synchronized boolean put(HttpClientConnection httpClientConnection) {\n-    if (isClosed.get() || maxConn == 0) {\n-      closeHttpClientConnection(httpClientConnection);\n+  public boolean add(HttpClientConnection conn) {\n+    if (conn == null) {\n+      LOG.warn(\"Attempt to add null HttpClientConnection to the cache for account: {}\",\n+          accountNamePath);\n       return false;\n     }\n-    if (size() == maxConn) {\n-      closeHttpClientConnection(get(0).httpClientConnection);\n-      subList(0, 1).clear();\n+    if (isClosed.get() || maxCacheConnections <= 0\n+        || !conn.isOpen() || conn.isStale()) {\n+      closeHttpClientConnection(conn);\n+      return false;\n+    }\n+    while (size() >= maxCacheConnections) {\n\nReview Comment:\n   Since this method is not synchronized two threads can enter this loop simultaneously, both see size = maxCacheConnections, both remove one, and both add a new one \u2014 leading to the cache momentarily holding more than maxCacheConnections. So, the eviction logic should be synchronized\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:36:14.656+0000", "updated": "2025-08-07T12:36:14.656+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012573", "id": "18012573", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260193538\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -212,45 +115,34 @@ public synchronized void close() {\n \n   @VisibleForTesting\n   void closeInternal() {\n-    timerTask.cancel();\n-    timer.purge();\n-    while (!empty()) {\n-      KeepAliveEntry e = pop();\n-      closeHttpClientConnection(e.httpClientConnection);\n+    while (size() != 0) {\n+      closeHttpClientConnection(removeFirst());\n\nReview Comment:\n   Another thread may remove the last element right after your size() check, causing removeFirst() to throw NoSuchElementException. So better to use pollFirst() here\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:38:24.889+0000", "updated": "2025-08-07T12:38:24.889+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012574", "id": "18012574", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260197782\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -212,45 +115,34 @@ public synchronized void close() {\n \n   @VisibleForTesting\n   void closeInternal() {\n-    timerTask.cancel();\n-    timer.purge();\n-    while (!empty()) {\n-      KeepAliveEntry e = pop();\n-      closeHttpClientConnection(e.httpClientConnection);\n+    while (size() != 0) {\n+      closeHttpClientConnection(removeFirst());\n\nReview Comment:\n   Should use the same code used in add method\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:40:14.524+0000", "updated": "2025-08-07T12:40:14.524+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012575", "id": "18012575", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260197782\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -212,45 +115,34 @@ public synchronized void close() {\n \n   @VisibleForTesting\n   void closeInternal() {\n-    timerTask.cancel();\n-    timer.purge();\n-    while (!empty()) {\n-      KeepAliveEntry e = pop();\n-      closeHttpClientConnection(e.httpClientConnection);\n+    while (size() != 0) {\n+      closeHttpClientConnection(removeFirst());\n\nReview Comment:\n   Should use the same code used in add method\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:40:32.842+0000", "updated": "2025-08-07T12:40:32.842+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012576", "id": "18012576", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260193538\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -212,45 +115,34 @@ public synchronized void close() {\n \n   @VisibleForTesting\n   void closeInternal() {\n-    timerTask.cancel();\n-    timer.purge();\n-    while (!empty()) {\n-      KeepAliveEntry e = pop();\n-      closeHttpClientConnection(e.httpClientConnection);\n+    while (size() != 0) {\n+      closeHttpClientConnection(removeFirst());\n\nReview Comment:\n   Another thread may remove the last element right after your size() check, causing removeFirst() to throw NoSuchElementException. So better to use pollFirst() here with null check\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:40:50.115+0000", "updated": "2025-08-07T12:40:50.115+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012577", "id": "18012577", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260205856\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -259,48 +151,39 @@ public synchronized HttpClientConnection get()\n    * will make space for the new connection. If the cache is closed or of zero size,\n    * the connection is closed and not added to the cache.\n    *\n-   * @param httpClientConnection HttpClientConnection to be cached\n+   * @param conn HttpClientConnection to be cached\n    * @return true if the HttpClientConnection is added in active cache, false otherwise.\n    */\n-  public synchronized boolean put(HttpClientConnection httpClientConnection) {\n-    if (isClosed.get() || maxConn == 0) {\n-      closeHttpClientConnection(httpClientConnection);\n+  public boolean add(HttpClientConnection conn) {\n+    if (conn == null) {\n+      LOG.warn(\"Attempt to add null HttpClientConnection to the cache for account: {}\",\n+          accountNamePath);\n       return false;\n     }\n-    if (size() == maxConn) {\n-      closeHttpClientConnection(get(0).httpClientConnection);\n-      subList(0, 1).clear();\n+    if (isClosed.get() || maxCacheConnections <= 0\n+        || !conn.isOpen() || conn.isStale()) {\n+      closeHttpClientConnection(conn);\n+      return false;\n+    }\n+    while (size() >= maxCacheConnections) {\n+      HttpClientConnection httpClientConnection = pollFirst();\n+      if (httpClientConnection != null) {\n+        closeHttpClientConnection(httpClientConnection);\n+      } else {\n+        break;\n+      }\n     }\n-    KeepAliveEntry entry = new KeepAliveEntry(httpClientConnection,\n-        System.currentTimeMillis());\n-    push(entry);\n-    return true;\n+    return offerLast(conn);\n   }\n \n-  @Override\n-  public synchronized boolean equals(final Object o) {\n-    return super.equals(o);\n+  @VisibleForTesting\n+  public int getMaxCacheConnections() {\n+    return maxCacheConnections;\n   }\n \n   @Override\n-  public synchronized int hashCode() {\n-    return super.hashCode();\n-  }\n-\n-  /**\n-   * Entry data-structure in the cache.\n-   */\n-  static class KeepAliveEntry {\n-\n-    /**HttpClientConnection in the cache entry.*/\n-    private final HttpClientConnection httpClientConnection;\n-\n-    /**Time at which the HttpClientConnection was added to the cache.*/\n-    private final long idleStartTime;\n-\n-    KeepAliveEntry(HttpClientConnection hc, long idleStartTime) {\n-      this.httpClientConnection = hc;\n-      this.idleStartTime = idleStartTime;\n-    }\n+  public String toString() {\n+    return String.format(\"KeepAliveCache[closed=%s, size=%d, max=%d]\",\n+        isClosed.get(), size(), maxCacheConnections);\n   }\n-}\n+}\n\nReview Comment:\n   nit: EOL\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:43:33.237+0000", "updated": "2025-08-07T12:43:33.237+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012578", "id": "18012578", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260207006\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemListStatus.java:\n##########\n@@ -108,32 +108,32 @@ public void testListPath() throws Exception {\n     config.set(AZURE_LIST_MAX_RESULTS, \"5000\");\n     final AzureBlobFileSystem fs = (AzureBlobFileSystem) FileSystem\n         .newInstance(getFileSystem().getUri(), config);\n-      final List<Future<Void>> tasks = new ArrayList<>();\n-\n-      ExecutorService es = Executors.newFixedThreadPool(10);\n-      for (int i = 0; i < TEST_FILES_NUMBER; i++) {\n-        final Path fileName = new Path(\"/test\" + i);\n-        Callable<Void> callable = new Callable<Void>() {\n-          @Override\n-          public Void call() throws Exception {\n-            touch(fileName);\n-            return null;\n-          }\n-        };\n-\n-        tasks.add(es.submit(callable));\n-      }\n+    final List<Future<Void>> tasks = new ArrayList<>();\n\nReview Comment:\n   revert change\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T12:44:00.466+0000", "updated": "2025-08-07T12:44:00.466+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18012586", "id": "18012586", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "Copilot commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2260270735\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n\nReview Comment:\n   This creates infinite recursion. The method calls itself instead of LOG.debug(). This should be 'LOG.debug(message, args);'.\n   ```suggestion\n         LOG.debug(message, args);\n   ```\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n+          new Thread(() -> cacheExtraConnection(route, cacheRefreshConnections)).start();\n\nReview Comment:\n   Creating raw threads is generally discouraged. Consider using a thread pool or executor service for better resource management and control.\n   ```suggestion\n             connectionWarmupExecutor.submit(() -> cacheExtraConnection(route, cacheRefreshConnections));\n   ```\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-07T13:06:21.988+0000", "updated": "2025-08-07T13:06:21.988+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013877", "id": "18013877", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276092300\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n+\n+  /**\n+   * Connection timeout for establishing a new connection.\n+   */\n+  private final int connectionTimeout;\n+\n+  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+\n+  private final Object connectionLock = new Object();\n+\n+  private HttpHost baseHost;\n+\n   AbfsConnectionManager(Registry<ConnectionSocketFactory> socketFactoryRegistry,\n-      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac) {\n+      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac,\n+      final AbfsConfiguration abfsConfiguration, final URL baseUrl) {\n     this.httpConnectionFactory = connectionFactory;\n+    this.connectionTimeout = abfsConfiguration.getHttpConnectionTimeout();\n     this.kac = kac;\n     this.connectionOperator = new DefaultHttpClientConnectionOperator(\n         socketFactoryRegistry, null, null);\n+    if (abfsConfiguration.getCacheWarmupConnections() > 0) {\n\nReview Comment:\n   since connection manager is being called by client, we expect cache warmup for each client instance?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T09:32:31.043+0000", "updated": "2025-08-14T09:32:31.043+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013881", "id": "18013881", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276178751\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n\nReview Comment:\n   The 5 here is from the cache warmup size right? We could get it from the config\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T10:04:27.605+0000", "updated": "2025-08-14T10:04:27.605+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013882", "id": "18013882", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276182947\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n\nReview Comment:\n   Also, should we have the threads as daemon threads instead? They could help avoid hanging if connect() stalls somewhere\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T10:06:19.012+0000", "updated": "2025-08-14T10:06:19.012+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013883", "id": "18013883", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276186992\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n\nReview Comment:\n   Or maybe we can cancel all futures while we are awaiting termination after 1sec (after line 313) to avoid hanging threads\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T10:08:07.939+0000", "updated": "2025-08-14T10:08:07.939+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013885", "id": "18013885", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276186992\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n\nReview Comment:\n   Or maybe we can cancel all futures while we are awaiting termination after 1sec (after line 313) to avoid hanging threads\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T10:15:56.976+0000", "updated": "2025-08-14T10:15:56.976+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013890", "id": "18013890", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276182947\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n\nReview Comment:\n   Also, should we have the threads as daemon threads instead? They could help avoid hanging if connect() stalls somewhere\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T10:27:13.383+0000", "updated": "2025-08-14T10:27:13.383+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013892", "id": "18013892", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276258496\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n\nReview Comment:\n   this is a TODO?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T10:41:21.048+0000", "updated": "2025-08-14T10:41:21.048+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013913", "id": "18013913", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276571499\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n+          new Thread(() -> cacheExtraConnection(route, cacheRefreshConnections)).start();\n\nReview Comment:\n   Nit: maybe we could name the threads if it helps in debug logs?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T13:02:33.449+0000", "updated": "2025-08-14T13:02:33.449+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013914", "id": "18013914", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276579327\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n\nReview Comment:\n   This is multiple threads in parallel right?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T13:05:38.736+0000", "updated": "2025-08-14T13:05:38.736+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013918", "id": "18013918", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276674621\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n+            final long deadline = System.currentTimeMillis() + timeoutMs;\n\nReview Comment:\n   We could use System.nanoTime() here instead as it avoids system clock changes. Or could do System.nanoTime()/1000/1000 if reqd in millisec only\r\n   CC: @anujmodi2021's prev PR\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T13:41:06.163+0000", "updated": "2025-08-14T13:41:06.163+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013920", "id": "18013920", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2276674621\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n+            final long deadline = System.currentTimeMillis() + timeoutMs;\n\nReview Comment:\n   We could use System.nanoTime() here instead as it avoids system clock changes. Or could do System.nanoTime()/1000/1000 if reqd in millisec only\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T13:44:27.170+0000", "updated": "2025-08-14T13:44:27.170+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18013959", "id": "18013959", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2277195098\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n+          }\n+        });\n+      }\n+\n+      executorService.shutdown();\n+      try {\n+        if (!executorService.awaitTermination(1, TimeUnit.SECONDS)) {\n+          executorService.shutdownNow();\n+        }\n+      } catch (InterruptedException e) {\n+        executorService.shutdownNow();\n+        Thread.currentThread().interrupt();\n+      } finally {\n+        isCaching.set(false);\n+        logDebug(\"Connection warmup completed in {} ms\", System.currentTimeMillis() - start);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Adds a connection to the cache if it is open and not stale.\n+   * If the connection is added to the cache, it notifies one waiting thread.\n+   *\n+   * @param conn the connection to add to the cache\n+   */\n+  private void addConnectionToCache(HttpClientConnection conn) {\n+    if (conn instanceof AbfsManagedApacheHttpConnection) {\n+      if (((AbfsManagedApacheHttpConnection) conn).getTargetHost().equals(baseHost)) {\n+        boolean connAddedInKac = kac.add(conn);\n+        synchronized (connectionLock) {\n+          connectionLock.notify(); // wake up one thread only\n+        }\n+        if (connAddedInKac) {\n+          logDebug(\"Connection cached: {}\", conn);\n+        } else {\n+          logDebug(\"Connection not cached, and is released: {}\", conn);\n\nReview Comment:\n   Where are we releasing the connection?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-14T16:56:36.693+0000", "updated": "2025-08-14T16:56:36.693+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014374", "id": "18014374", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280731208\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -199,10 +102,10 @@ private void closeHttpClientConnection(final HttpClientConnection hc) {\n   }\n \n   /**\n-   * Close all connections in cache and cancel the eviction timer.\n+   * Close all connections in cache.\n    */\n   @Override\n-  public synchronized void close() {\n+  public void close() {\n\nReview Comment:\n   It wont require synchronized in close()?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T05:42:30.611+0000", "updated": "2025-08-17T05:42:30.611+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014376", "id": "18014376", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280733087\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -212,45 +115,34 @@ public synchronized void close() {\n \n   @VisibleForTesting\n   void closeInternal() {\n-    timerTask.cancel();\n-    timer.purge();\n-    while (!empty()) {\n-      KeepAliveEntry e = pop();\n-      closeHttpClientConnection(e.httpClientConnection);\n+    while (size() != 0) {\n+      closeHttpClientConnection(removeFirst());\n     }\n   }\n \n   /**\n-   * <p>\n-   * Gets the latest added HttpClientConnection from the cache. The returned connection\n-   * is non-stale and has been in the cache for less than connectionIdleTTL milliseconds.\n-   * <p>\n-   * The cache is checked from the top of the stack. If the connection is stale or has been\n-   * in the cache for more than connectionIdleTTL milliseconds, it is closed and the next\n-   * connection is checked. Once a valid connection is found, it is returned.\n+   * Gets the oldest added HttpClientConnection from the cache. The returned connection\n+   * is open.\n+   *\n+   * The cache follows the FIFO strategy. If the connection is not open, it will\n+   * be closed and the next connection is checked. Once a valid connection is found,\n+   * it is returned.\n    * @return HttpClientConnection: if a valid connection is found, else null.\n    * @throws IOException if the cache is closed.\n    */\n-  public synchronized HttpClientConnection get()\n-      throws IOException {\n+  public HttpClientConnection get() throws IOException {\n\nReview Comment:\n   Same- do we not need synchronized?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T05:50:41.271+0000", "updated": "2025-08-17T05:50:41.271+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014377", "id": "18014377", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280733258\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -199,10 +102,10 @@ private void closeHttpClientConnection(final HttpClientConnection hc) {\n   }\n \n   /**\n-   * Close all connections in cache and cancel the eviction timer.\n+   * Close all connections in cache.\n    */\n   @Override\n-  public synchronized void close() {\n+  public void close() {\n\nReview Comment:\n   *closeInterval\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T05:51:11.346+0000", "updated": "2025-08-17T05:51:11.346+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014380", "id": "18014380", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280739706\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/ITestAbfsClient.java:\n##########\n@@ -869,4 +874,217 @@ private void testIsNonEmptyDirectoryInternal(String firstCT,\n         .listPath(eq(\"/testPath\"), eq(false), eq(1),\n             any(), any(TracingContext.class), any());\n   }\n+\n+  /**\n+   * Test to verify that the KeepAliveCache is initialized with the correct number of connections.\n+   * This test is applicable only for ApacheHttpClient.\n+   */\n+  @Test\n+  public void testKeepAliveCacheInitializationWithApacheHttpClient() throws Exception {\n+    Assume.assumeTrue(APACHE_HTTP_CLIENT == httpOperationType);\n+    final AzureBlobFileSystem fs = this.getFileSystem();\n+    AbfsClientHandler abfsClientHandler = fs.getAbfsStore().getClientHandler();\n+\n+    AbfsClient dfsClient = abfsClientHandler.getDfsClient();\n+    AbfsClient blobClient = abfsClientHandler.getBlobClient();\n+\n+    checkKacOnBothClientsAfterFSInit(dfsClient);\n+    checkKacOnBothClientsAfterFSInit(blobClient);\n+  }\n+\n+  /**\n+   * Test to verify the behavior of stale connections in the KeepAliveCache.\n+   * This test is applicable only for ApacheHttpClient.\n+   */\n+  @Test\n+  public void testStaleConnectionBehavior() throws Exception {\n+    Assume.assumeTrue(APACHE_HTTP_CLIENT == httpOperationType);\n+    Configuration conf = this.getFileSystem().getConf();\n+\n+    // This is to avoid actual metric calls during the test\n+    conf.unset(FS_AZURE_METRIC_ACCOUNT_NAME);\n+\n+    // Initialize the file system\n+    AzureBlobFileSystemStore store = this.getFileSystem(conf).getAbfsStore();\n+    AbfsClientHandler abfsClientHandler = store.getClientHandler();\n+\n+    AbfsClient dfsClient = abfsClientHandler.getDfsClient();\n+    AbfsClient blobClient = abfsClientHandler.getBlobClient();\n+\n+    checkKacOnBothClientsAfterFSInit(dfsClient);\n+    checkKacOnBothClientsAfterFSInit(blobClient);\n+\n+    // Wait for 5 minutes to make the cached connections stale\n\nReview Comment:\n   How did we find the time when a connection becomes stale? Is it set at 5mins exact?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T06:22:04.640+0000", "updated": "2025-08-17T06:22:04.640+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014382", "id": "18014382", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280751178\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n+\n+  /**\n+   * Connection timeout for establishing a new connection.\n+   */\n+  private final int connectionTimeout;\n+\n+  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+\n+  private final Object connectionLock = new Object();\n+\n+  private HttpHost baseHost;\n+\n   AbfsConnectionManager(Registry<ConnectionSocketFactory> socketFactoryRegistry,\n-      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac) {\n+      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac,\n+      final AbfsConfiguration abfsConfiguration, final URL baseUrl) {\n     this.httpConnectionFactory = connectionFactory;\n+    this.connectionTimeout = abfsConfiguration.getHttpConnectionTimeout();\n     this.kac = kac;\n     this.connectionOperator = new DefaultHttpClientConnectionOperator(\n         socketFactoryRegistry, null, null);\n+    if (abfsConfiguration.getCacheWarmupConnections() > 0) {\n\nReview Comment:\n   Yes, it is expected that each keep alive cache instance will get warmed up for both AbfsDfsClient and AbfsBlobClient seperately.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:08:02.938+0000", "updated": "2025-08-17T07:08:02.938+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014383", "id": "18014383", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280751607\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n\nReview Comment:\n   KeepAliveCache is extending LinkedBlockingDeque which is thread safe, so get method will take case of each thread will get unique connection from cache.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:09:55.438+0000", "updated": "2025-08-17T07:09:55.438+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014384", "id": "18014384", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280752233\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n\nReview Comment:\n   Make sense, will read it from config.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:10:48.278+0000", "updated": "2025-08-17T07:10:48.278+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014385", "id": "18014385", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280755083\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n+            final long deadline = System.currentTimeMillis() + timeoutMs;\n\nReview Comment:\n   Nice suggestion, will do this change.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:12:43.110+0000", "updated": "2025-08-17T07:12:43.110+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014386", "id": "18014386", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280760232\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n+            final long deadline = System.currentTimeMillis() + timeoutMs;\n+\n+            while ((conn = kac.get()) == null\n+                && System.currentTimeMillis() < deadline) {\n+              long waitTime = deadline - System.currentTimeMillis();\n+              if (waitTime <= 0) {\n+                break;\n+              }\n+\n+              try {\n+                connectionLock.wait(waitTime);\n+              } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n\nReview Comment:\n   With the current flow, it is expected that even if warmup failed there is no need to raise an expection. Thats why not throwing the exception.\n   But with the next PR changes where we are making changes for Apache to JDK fallback, will throw an exception and that we will help us know fallback to JDK in init flow.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:16:38.693+0000", "updated": "2025-08-17T07:16:38.693+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014387", "id": "18014387", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280762343\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n+            return conn;\n+          }\n+\n+          // No connection available \u2014 wait up to timeout for one to appear\n+          synchronized (connectionLock) {\n+            triggerConnectionWarmupIfNeeded();\n+\n+            final long timeoutMs = 500L;\n+            final long deadline = System.currentTimeMillis() + timeoutMs;\n+\n+            while ((conn = kac.get()) == null\n+                && System.currentTimeMillis() < deadline) {\n+              long waitTime = deadline - System.currentTimeMillis();\n+              if (waitTime <= 0) {\n+                break;\n+              }\n+\n+              try {\n+                connectionLock.wait(waitTime);\n+              } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n+                return null;\n+              }\n+            }\n+\n+            if (conn != null) {\n+              logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n+                  conn, requestId);\n+              return conn;\n+            }\n+\n+            // Timed out \u2014 create a new connection\n+            logDebug(\"Creating new connection for requestId: {}\", requestId);\n+            return createNewConnection();\n\nReview Comment:\n   No, we don't want that cap because if cache doesn't contain connection process should create connection in run time and use it instead of failing the entire call.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:19:23.883+0000", "updated": "2025-08-17T07:19:23.883+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014388", "id": "18014388", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280762636\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n\nReview Comment:\n   Yes, will make thread pool here containing single thread instead of creating new thread again and again.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:20:18.188+0000", "updated": "2025-08-17T07:20:18.188+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014389", "id": "18014389", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280762874\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n\nReview Comment:\n   Not needed\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:20:59.040+0000", "updated": "2025-08-17T07:20:59.040+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014390", "id": "18014390", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280763333\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n\nReview Comment:\n   numberOfConnections is from config only. To restrict to create thread pool of large size we are doing Math.min(numberOfConnections, 5)\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:22:24.214+0000", "updated": "2025-08-17T07:22:24.214+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014391", "id": "18014391", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280763428\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n\nReview Comment:\n   Yes, during cache warmup and cache refresh\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:22:44.256+0000", "updated": "2025-08-17T07:22:44.256+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014392", "id": "18014392", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280763664\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n\nReview Comment:\n   Make sense, will add this.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:23:24.357+0000", "updated": "2025-08-17T07:23:24.357+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014393", "id": "18014393", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280763944\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n+          }\n+        });\n+      }\n+\n+      executorService.shutdown();\n+      try {\n+        if (!executorService.awaitTermination(1, TimeUnit.SECONDS)) {\n\nReview Comment:\n   This number is based on our POC and if we wait for more than 1 sec then it will impact overall performance.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:24:29.450+0000", "updated": "2025-08-17T07:24:29.450+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014394", "id": "18014394", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280764244\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n+          }\n+        });\n+      }\n+\n+      executorService.shutdown();\n+      try {\n+        if (!executorService.awaitTermination(1, TimeUnit.SECONDS)) {\n+          executorService.shutdownNow();\n+        }\n+      } catch (InterruptedException e) {\n+        executorService.shutdownNow();\n+        Thread.currentThread().interrupt();\n+      } finally {\n+        isCaching.set(false);\n+        logDebug(\"Connection warmup completed in {} ms\", System.currentTimeMillis() - start);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Adds a connection to the cache if it is open and not stale.\n+   * If the connection is added to the cache, it notifies one waiting thread.\n+   *\n+   * @param conn the connection to add to the cache\n+   */\n+  private void addConnectionToCache(HttpClientConnection conn) {\n+    if (conn instanceof AbfsManagedApacheHttpConnection) {\n+      if (((AbfsManagedApacheHttpConnection) conn).getTargetHost().equals(baseHost)) {\n+        boolean connAddedInKac = kac.add(conn);\n+        synchronized (connectionLock) {\n+          connectionLock.notify(); // wake up one thread only\n+        }\n+        if (connAddedInKac) {\n\nReview Comment:\n   Incase connection is not added to cache, we are closing the connection.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:25:34.438+0000", "updated": "2025-08-17T07:25:34.438+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014395", "id": "18014395", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280766445\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -201,7 +279,69 @@ public void shutdown() {\n \n   private void logDebug(String message, Object... args) {\n     if (LOG.isDebugEnabled()) {\n-      LOG.debug(message, args);\n+      logDebug(message, args);\n+    }\n+  }\n+\n+  /**\n+   * Caches extra connections in the {@link KeepAliveCache} to warm it up.\n+   * This method is called during initialization and when the cache is empty.\n+   *\n+   * @param route the HTTP route for which connections are created\n+   * @param numberOfConnections the number of connections to create\n+   */\n+  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n+    if (!isCaching.getAndSet(true)) {\n+      long start = System.currentTimeMillis();\n+      // Only one thread allowed at a time\n+      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+\n+      for (int i = 0; i < numberOfConnections; i++) {\n+        executorService.submit(() -> {\n+          try {\n+            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            addConnectionToCache(conn);\n+          } catch (Exception e) {\n+           logDebug(\"Error creating connection: {}\", e.getMessage());\n+          }\n+        });\n+      }\n+\n+      executorService.shutdown();\n+      try {\n+        if (!executorService.awaitTermination(1, TimeUnit.SECONDS)) {\n+          executorService.shutdownNow();\n+        }\n+      } catch (InterruptedException e) {\n+        executorService.shutdownNow();\n+        Thread.currentThread().interrupt();\n+      } finally {\n+        isCaching.set(false);\n+        logDebug(\"Connection warmup completed in {} ms\", System.currentTimeMillis() - start);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Adds a connection to the cache if it is open and not stale.\n+   * If the connection is added to the cache, it notifies one waiting thread.\n+   *\n+   * @param conn the connection to add to the cache\n+   */\n+  private void addConnectionToCache(HttpClientConnection conn) {\n+    if (conn instanceof AbfsManagedApacheHttpConnection) {\n+      if (((AbfsManagedApacheHttpConnection) conn).getTargetHost().equals(baseHost)) {\n+        boolean connAddedInKac = kac.add(conn);\n+        synchronized (connectionLock) {\n+          connectionLock.notify(); // wake up one thread only\n+        }\n+        if (connAddedInKac) {\n+          logDebug(\"Connection cached: {}\", conn);\n+        } else {\n+          logDebug(\"Connection not cached, and is released: {}\", conn);\n\nReview Comment:\n   releaseConnection() method\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:32:35.278+0000", "updated": "2025-08-17T07:32:35.278+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014396", "id": "18014396", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280766996\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsManagedApacheHttpConnection.java:\n##########\n@@ -91,7 +97,27 @@ public boolean isOpen() {\n   /**{@inheritDoc}*/\n   @Override\n   public boolean isStale() {\n-    return httpClientConnection.isStale();\n+    try {\n\nReview Comment:\n   The default isStale implementation doesn't gurantee socket disconnection from server's end. With this  implementation we are making sure server is yet not disconnected the connection.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:34:35.487+0000", "updated": "2025-08-17T07:34:35.487+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014397", "id": "18014397", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280767506\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -199,10 +102,10 @@ private void closeHttpClientConnection(final HttpClientConnection hc) {\n   }\n \n   /**\n-   * Close all connections in cache and cancel the eviction timer.\n+   * Close all connections in cache.\n    */\n   @Override\n-  public synchronized void close() {\n+  public void close() {\n\nReview Comment:\n   Not required, the below implementation will guarantee that only one thread will call closeInternal method\n   boolean closed = isClosed.getAndSet(true);\n       if (closed) {\n         return;\n   }\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:36:30.701+0000", "updated": "2025-08-17T07:36:30.701+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014398", "id": "18014398", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280767677\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -212,45 +115,34 @@ public synchronized void close() {\n \n   @VisibleForTesting\n   void closeInternal() {\n-    timerTask.cancel();\n-    timer.purge();\n-    while (!empty()) {\n-      KeepAliveEntry e = pop();\n-      closeHttpClientConnection(e.httpClientConnection);\n+    while (size() != 0) {\n+      closeHttpClientConnection(removeFirst());\n\nReview Comment:\n   Make sense, will take this change.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:37:10.794+0000", "updated": "2025-08-17T07:37:10.794+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014399", "id": "18014399", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280768057\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -212,45 +115,34 @@ public synchronized void close() {\n \n   @VisibleForTesting\n   void closeInternal() {\n-    timerTask.cancel();\n-    timer.purge();\n-    while (!empty()) {\n-      KeepAliveEntry e = pop();\n-      closeHttpClientConnection(e.httpClientConnection);\n+    while (size() != 0) {\n+      closeHttpClientConnection(removeFirst());\n     }\n   }\n \n   /**\n-   * <p>\n-   * Gets the latest added HttpClientConnection from the cache. The returned connection\n-   * is non-stale and has been in the cache for less than connectionIdleTTL milliseconds.\n-   * <p>\n-   * The cache is checked from the top of the stack. If the connection is stale or has been\n-   * in the cache for more than connectionIdleTTL milliseconds, it is closed and the next\n-   * connection is checked. Once a valid connection is found, it is returned.\n+   * Gets the oldest added HttpClientConnection from the cache. The returned connection\n+   * is open.\n+   *\n+   * The cache follows the FIFO strategy. If the connection is not open, it will\n+   * be closed and the next connection is checked. Once a valid connection is found,\n+   * it is returned.\n    * @return HttpClientConnection: if a valid connection is found, else null.\n    * @throws IOException if the cache is closed.\n    */\n-  public synchronized HttpClientConnection get()\n-      throws IOException {\n+  public HttpClientConnection get() throws IOException {\n\nReview Comment:\n   It is not needed, the reason for explicit synchronization with earlier implementation was use of Stack which is not thread safe. Not we are using LinkedBlockingDeque which provides thread safe operations\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:38:50.978+0000", "updated": "2025-08-17T07:38:50.978+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014400", "id": "18014400", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280768741\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/KeepAliveCache.java:\n##########\n@@ -259,48 +151,39 @@ public synchronized HttpClientConnection get()\n    * will make space for the new connection. If the cache is closed or of zero size,\n    * the connection is closed and not added to the cache.\n    *\n-   * @param httpClientConnection HttpClientConnection to be cached\n+   * @param conn HttpClientConnection to be cached\n    * @return true if the HttpClientConnection is added in active cache, false otherwise.\n    */\n-  public synchronized boolean put(HttpClientConnection httpClientConnection) {\n-    if (isClosed.get() || maxConn == 0) {\n-      closeHttpClientConnection(httpClientConnection);\n+  public boolean add(HttpClientConnection conn) {\n+    if (conn == null) {\n+      LOG.warn(\"Attempt to add null HttpClientConnection to the cache for account: {}\",\n+          accountNamePath);\n       return false;\n     }\n-    if (size() == maxConn) {\n-      closeHttpClientConnection(get(0).httpClientConnection);\n-      subList(0, 1).clear();\n+    if (isClosed.get() || maxCacheConnections <= 0\n+        || !conn.isOpen() || conn.isStale()) {\n+      closeHttpClientConnection(conn);\n+      return false;\n+    }\n+    while (size() >= maxCacheConnections) {\n\nReview Comment:\n   I have kept this like this intentionally because making it synchronized will come with performance impact. Since while condition is checking for >= condition so it will clear all extra connections at the end and maintain the required number of connections in the cache.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:40:56.236+0000", "updated": "2025-08-17T07:40:56.236+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014401", "id": "18014401", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280768941\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AbfsConfiguration.java:\n##########\n@@ -474,15 +474,20 @@ public class AbfsConfiguration{\n       FS_AZURE_APACHE_HTTP_CLIENT_MAX_IO_EXCEPTION_RETRIES, DefaultValue = DEFAULT_APACHE_HTTP_CLIENT_MAX_IO_EXCEPTION_RETRIES)\n   private int maxApacheHttpClientIoExceptionsRetries;\n \n-  /**\n-   * Max idle TTL configuration for connection given in\n-   * {@value org.apache.hadoop.fs.azurebfs.constants.ConfigurationKeys#FS_AZURE_APACHE_HTTP_CLIENT_IDLE_CONNECTION_TTL}\n-   * with default of\n-   * {@value org.apache.hadoop.fs.azurebfs.constants.FileSystemConfigurations#DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME}\n-   */\n-  @LongConfigurationValidatorAnnotation(ConfigurationKey = FS_AZURE_APACHE_HTTP_CLIENT_IDLE_CONNECTION_TTL,\n-      DefaultValue = DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME)\n-  private long maxApacheHttpClientConnectionIdleTime;\n+  @IntegerConfigurationValidatorAnnotation(ConfigurationKey =\n+      FS_AZURE_APACHE_HTTP_CLIENT_MAX_CACHE_CONNECTION_SIZE, DefaultValue = DEFAULT_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS,\n+      MinValue = MIN_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS, MaxValue = MAX_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS)\n+  private int maxApacheHttpClientCacheConnections;\n+\n+  @IntegerConfigurationValidatorAnnotation(ConfigurationKey =\n+      FS_AZURE_CACHE_WARMUP_CONNECTION_COUNT, DefaultValue = DEFAULT_APACHE_CACHE_WARMUP_CONNECTION_COUNT,\n+      MinValue = 0, MaxValue = MIN_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS)\n\nReview Comment:\n   Will discuss this offline in this.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:41:36.298+0000", "updated": "2025-08-17T07:41:36.298+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014402", "id": "18014402", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280769103\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/ITestAbfsClient.java:\n##########\n@@ -869,4 +874,217 @@ private void testIsNonEmptyDirectoryInternal(String firstCT,\n         .listPath(eq(\"/testPath\"), eq(false), eq(1),\n             any(), any(TracingContext.class), any());\n   }\n+\n+  /**\n+   * Test to verify that the KeepAliveCache is initialized with the correct number of connections.\n+   * This test is applicable only for ApacheHttpClient.\n+   */\n+  @Test\n+  public void testKeepAliveCacheInitializationWithApacheHttpClient() throws Exception {\n+    Assume.assumeTrue(APACHE_HTTP_CLIENT == httpOperationType);\n+    final AzureBlobFileSystem fs = this.getFileSystem();\n+    AbfsClientHandler abfsClientHandler = fs.getAbfsStore().getClientHandler();\n+\n+    AbfsClient dfsClient = abfsClientHandler.getDfsClient();\n+    AbfsClient blobClient = abfsClientHandler.getBlobClient();\n+\n+    checkKacOnBothClientsAfterFSInit(dfsClient);\n+    checkKacOnBothClientsAfterFSInit(blobClient);\n+  }\n+\n+  /**\n+   * Test to verify the behavior of stale connections in the KeepAliveCache.\n+   * This test is applicable only for ApacheHttpClient.\n+   */\n+  @Test\n+  public void testStaleConnectionBehavior() throws Exception {\n+    Assume.assumeTrue(APACHE_HTTP_CLIENT == httpOperationType);\n+    Configuration conf = this.getFileSystem().getConf();\n+\n+    // This is to avoid actual metric calls during the test\n+    conf.unset(FS_AZURE_METRIC_ACCOUNT_NAME);\n+\n+    // Initialize the file system\n+    AzureBlobFileSystemStore store = this.getFileSystem(conf).getAbfsStore();\n+    AbfsClientHandler abfsClientHandler = store.getClientHandler();\n+\n+    AbfsClient dfsClient = abfsClientHandler.getDfsClient();\n+    AbfsClient blobClient = abfsClientHandler.getBlobClient();\n+\n+    checkKacOnBothClientsAfterFSInit(dfsClient);\n+    checkKacOnBothClientsAfterFSInit(blobClient);\n+\n+    // Wait for 5 minutes to make the cached connections stale\n\nReview Comment:\n   During POC we found out this timeout time.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:42:06.353+0000", "updated": "2025-08-17T07:42:06.353+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014403", "id": "18014403", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2280768941\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AbfsConfiguration.java:\n##########\n@@ -474,15 +474,20 @@ public class AbfsConfiguration{\n       FS_AZURE_APACHE_HTTP_CLIENT_MAX_IO_EXCEPTION_RETRIES, DefaultValue = DEFAULT_APACHE_HTTP_CLIENT_MAX_IO_EXCEPTION_RETRIES)\n   private int maxApacheHttpClientIoExceptionsRetries;\n \n-  /**\n-   * Max idle TTL configuration for connection given in\n-   * {@value org.apache.hadoop.fs.azurebfs.constants.ConfigurationKeys#FS_AZURE_APACHE_HTTP_CLIENT_IDLE_CONNECTION_TTL}\n-   * with default of\n-   * {@value org.apache.hadoop.fs.azurebfs.constants.FileSystemConfigurations#DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME}\n-   */\n-  @LongConfigurationValidatorAnnotation(ConfigurationKey = FS_AZURE_APACHE_HTTP_CLIENT_IDLE_CONNECTION_TTL,\n-      DefaultValue = DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME)\n-  private long maxApacheHttpClientConnectionIdleTime;\n+  @IntegerConfigurationValidatorAnnotation(ConfigurationKey =\n+      FS_AZURE_APACHE_HTTP_CLIENT_MAX_CACHE_CONNECTION_SIZE, DefaultValue = DEFAULT_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS,\n+      MinValue = MIN_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS, MaxValue = MAX_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS)\n+  private int maxApacheHttpClientCacheConnections;\n+\n+  @IntegerConfigurationValidatorAnnotation(ConfigurationKey =\n+      FS_AZURE_CACHE_WARMUP_CONNECTION_COUNT, DefaultValue = DEFAULT_APACHE_CACHE_WARMUP_CONNECTION_COUNT,\n+      MinValue = 0, MaxValue = MIN_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS)\n\nReview Comment:\n   Will discuss this offline.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-17T07:44:06.557+0000", "updated": "2025-08-17T07:44:06.557+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014481", "id": "18014481", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2281204554\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/TestApacheClientConnectionPool.java:\n##########\n@@ -49,46 +45,50 @@ public TestApacheClientConnectionPool() throws Exception {\n     super();\n   }\n \n-  @Override\n-  protected int getTestTimeoutMillis() {\n-    return (int) DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME * 4;\n-  }\n-\n   @Test\n-  public void testBasicPool() throws Exception {\n-    System.clearProperty(HTTP_MAX_CONN_SYS_PROP);\n-    validatePoolSize(DEFAULT_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS);\n-  }\n-\n-  @Test\n-  public void testSysPropAppliedPool() throws Exception {\n-    final String customPoolSize = \"10\";\n-    System.setProperty(HTTP_MAX_CONN_SYS_PROP, customPoolSize);\n-    validatePoolSize(Integer.parseInt(customPoolSize));\n-  }\n+  public void testPoolSizeWithNotConfigured() throws Exception {\n+    Configuration configuration = new Configuration();\n+    configuration.unset(FS_AZURE_APACHE_HTTP_CLIENT_MAX_CACHE_CONNECTION_SIZE);\n+    AbfsConfiguration abfsConfiguration = new AbfsConfiguration(configuration,\n+        EMPTY_STRING);\n+    try (KeepAliveCache keepAliveCache = new KeepAliveCache(\n+        abfsConfiguration)) {\n+      Assertions.assertThat(keepAliveCache.getMaxCacheConnections())\n+          .describedAs(\"In case configured cache size is 0, \"\n+              + \"the pool size should be minimum possible value\")\n+          .isEqualTo(DEFAULT_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS);\n\nReview Comment:\n   Shouldn't this be MIN_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-18T03:10:39.275+0000", "updated": "2025-08-18T03:10:39.275+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18014483", "id": "18014483", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "manika137 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2281204554\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/TestApacheClientConnectionPool.java:\n##########\n@@ -49,46 +45,50 @@ public TestApacheClientConnectionPool() throws Exception {\n     super();\n   }\n \n-  @Override\n-  protected int getTestTimeoutMillis() {\n-    return (int) DEFAULT_HTTP_CLIENT_CONN_MAX_IDLE_TIME * 4;\n-  }\n-\n   @Test\n-  public void testBasicPool() throws Exception {\n-    System.clearProperty(HTTP_MAX_CONN_SYS_PROP);\n-    validatePoolSize(DEFAULT_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS);\n-  }\n-\n-  @Test\n-  public void testSysPropAppliedPool() throws Exception {\n-    final String customPoolSize = \"10\";\n-    System.setProperty(HTTP_MAX_CONN_SYS_PROP, customPoolSize);\n-    validatePoolSize(Integer.parseInt(customPoolSize));\n-  }\n+  public void testPoolSizeWithNotConfigured() throws Exception {\n+    Configuration configuration = new Configuration();\n+    configuration.unset(FS_AZURE_APACHE_HTTP_CLIENT_MAX_CACHE_CONNECTION_SIZE);\n+    AbfsConfiguration abfsConfiguration = new AbfsConfiguration(configuration,\n+        EMPTY_STRING);\n+    try (KeepAliveCache keepAliveCache = new KeepAliveCache(\n+        abfsConfiguration)) {\n+      Assertions.assertThat(keepAliveCache.getMaxCacheConnections())\n+          .describedAs(\"In case configured cache size is 0, \"\n+              + \"the pool size should be minimum possible value\")\n+          .isEqualTo(DEFAULT_HTTP_CLIENT_CONN_MAX_CACHED_CONNECTIONS);\n\nReview Comment:\n   Need to change the assert statement to picking up the default value if connection config is not set\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-18T03:13:09.055+0000", "updated": "2025-08-18T03:13:09.055+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18015433", "id": "18015433", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anujmodi2021 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2284234190\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java:\n##########\n@@ -330,7 +330,8 @@ public void close() throws IOException {\n     } catch (ExecutionException e) {\n       LOG.error(\"Error freeing leases\", e);\n     } finally {\n-      IOUtils.cleanupWithLogger(LOG, getClient());\n+      IOUtils.cleanupWithLogger(LOG, getClientHandler().getDfsClient(),\n\nReview Comment:\n   Can we simply have a close of clientHandler called here and inside client handler we call close for both the clients?\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -139,6 +139,10 @@ public AbfsAHCHttpOperation(final URL url,\n       throw new PathIOException(getUrl().toString(),\n           \"Unsupported HTTP method: \" + getMethod());\n     }\n+\n+    for (AbfsHttpHeader header : requestHeaders) {\n\nReview Comment:\n   Why this change?\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/FileSystemConfigurations.java:\n##########\n@@ -213,13 +213,19 @@ public final class FileSystemConfigurations {\n   public static final long THOUSAND = 1000L;\n \n   public static final HttpOperationType DEFAULT_NETWORKING_LIBRARY\n-      = HttpOperationType.JDK_HTTP_URL_CONNECTION;\n+      = HttpOperationType.APACHE_HTTP_CLIENT;\n\nReview Comment:\n   Let's revert this.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -196,7 +199,6 @@ public void processResponse(final byte[] buffer,\n       final int length) throws IOException {\n     try {\n       if (!isPayloadRequest) {\n-        prepareRequest();\n\nReview Comment:\n   Why removed?\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -280,17 +282,18 @@ HttpResponse executeRequest() throws IOException {\n   /**{@inheritDoc}*/\n   @Override\n   public void setRequestProperty(final String key, final String value) {\n-    List<AbfsHttpHeader> headers = getRequestHeaders();\n-    if (headers != null) {\n-      headers.add(new AbfsHttpHeader(key, value));\n+    if (httpRequestBase instanceof HttpEntityEnclosingRequestBase\n\nReview Comment:\n   +1\r\n   Add javadoc for whythese 2 conditions cannot be together.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n\nReview Comment:\n   variable name should say its a number or count.\r\n   \n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n\nReview Comment:\n   Also please give a relevant name to thread. This helps in identifying threads when debugging any issue.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n+\n+  /**\n+   * Connection timeout for establishing a new connection.\n+   */\n+  private final int connectionTimeout;\n+\n+  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+\n+  private final Object connectionLock = new Object();\n+\n+  private HttpHost baseHost;\n+\n   AbfsConnectionManager(Registry<ConnectionSocketFactory> socketFactoryRegistry,\n-      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac) {\n+      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac,\n+      final AbfsConfiguration abfsConfiguration, final URL baseUrl) {\n     this.httpConnectionFactory = connectionFactory;\n+    this.connectionTimeout = abfsConfiguration.getHttpConnectionTimeout();\n     this.kac = kac;\n     this.connectionOperator = new DefaultHttpClientConnectionOperator(\n         socketFactoryRegistry, null, null);\n+    if (abfsConfiguration.getCacheWarmupConnections() > 0) {\n\nReview Comment:\n   Same for this and all the variables. If they indicate a number better to name then as `numOfCacheWarmupConnections` or `cacheWarmupConnectionsCount`\r\n   \r\n   Please check this throughout the patch in all the classes for all the variables.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -398,24 +400,10 @@ public void sendPayload(final byte[] buffer,\n     }\n   }\n \n-  /**\n-   * Sets the header on the request.\n-   */\n-  private void prepareRequest() {\n-    final boolean isEntityBasedRequest\n-        = httpRequestBase instanceof HttpEntityEnclosingRequestBase;\n-    for (AbfsHttpHeader header : getRequestHeaders()) {\n-      if (CONTENT_LENGTH.equals(header.getName()) && isEntityBasedRequest) {\n-        continue;\n-      }\n-      httpRequestBase.setHeader(header.getName(), header.getValue());\n-    }\n-  }\n-\n   /**{@inheritDoc}*/\n   @Override\n   public String getRequestProperty(String name) {\n-    for (AbfsHttpHeader header : getRequestHeaders()) {\n+    for (Header header : httpRequestBase.getAllHeaders()) {\n\nReview Comment:\n   Why needed?\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -280,17 +282,18 @@ HttpResponse executeRequest() throws IOException {\n   /**{@inheritDoc}*/\n   @Override\n   public void setRequestProperty(final String key, final String value) {\n-    List<AbfsHttpHeader> headers = getRequestHeaders();\n-    if (headers != null) {\n-      headers.add(new AbfsHttpHeader(key, value));\n+    if (httpRequestBase instanceof HttpEntityEnclosingRequestBase\n+        && CONTENT_LENGTH.equals(key)) {\n+      return;\n     }\n+    httpRequestBase.setHeader(key, value);\n   }\n \n   /**{@inheritDoc}*/\n   @Override\n   Map<String, List<String>> getRequestProperties() {\n     Map<String, List<String>> map = new HashMap<>();\n-    for (AbfsHttpHeader header : getRequestHeaders()) {\n+    for (Header header : httpRequestBase.getAllHeaders()) {\n\nReview Comment:\n   Why this change?\r\n   Why are we changing more specific implementation to a parent class?\r\n   ABFSHttpHeaders is supposed to be more specific and sufficient for all ABFS needs.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n\nReview Comment:\n   +1\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n\nReview Comment:\n   Why this is not needed in synchronized block?\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n+\n+  /**\n+   * Connection timeout for establishing a new connection.\n+   */\n+  private final int connectionTimeout;\n+\n+  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+\n+  private final Object connectionLock = new Object();\n+\n+  private HttpHost baseHost;\n+\n   AbfsConnectionManager(Registry<ConnectionSocketFactory> socketFactoryRegistry,\n-      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac) {\n+      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac,\n+      final AbfsConfiguration abfsConfiguration, final URL baseUrl) {\n     this.httpConnectionFactory = connectionFactory;\n+    this.connectionTimeout = abfsConfiguration.getHttpConnectionTimeout();\n     this.kac = kac;\n     this.connectionOperator = new DefaultHttpClientConnectionOperator(\n         socketFactoryRegistry, null, null);\n+    if (abfsConfiguration.getCacheWarmupConnections() > 0) {\n\nReview Comment:\n   Should we discuss that?\r\n   Should not the Cach be shared among both the clients. We expect ony one client at a time to be working. So they should share the cache IMO\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-21T13:16:22.568+0000", "updated": "2025-08-21T13:16:22.568+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18015774", "id": "18015774", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3216710553\n\n   :broken_heart: **-1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 20s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  28m 56s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 27s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 26s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 24s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 28s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 28s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 21s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 46s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 28s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  21m 40s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | -1 :x: |  mvninstall  |   0m 20s | [/patch-mvninstall-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-mvninstall-hadoop-tools_hadoop-azure.txt) |  hadoop-azure in the patch failed.  |\r\n   | -1 :x: |  compile  |   0m 20s | [/patch-compile-hadoop-tools_hadoop-azure-jdkUbuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-compile-hadoop-tools_hadoop-azure-jdkUbuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04.txt) |  hadoop-azure in the patch failed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04.  |\r\n   | -1 :x: |  javac  |   0m 20s | [/patch-compile-hadoop-tools_hadoop-azure-jdkUbuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-compile-hadoop-tools_hadoop-azure-jdkUbuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04.txt) |  hadoop-azure in the patch failed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04.  |\r\n   | -1 :x: |  compile  |   0m 18s | [/patch-compile-hadoop-tools_hadoop-azure-jdkPrivateBuild-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-compile-hadoop-tools_hadoop-azure-jdkPrivateBuild-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09.txt) |  hadoop-azure in the patch failed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09.  |\r\n   | -1 :x: |  javac  |   0m 18s | [/patch-compile-hadoop-tools_hadoop-azure-jdkPrivateBuild-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-compile-hadoop-tools_hadoop-azure-jdkPrivateBuild-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09.txt) |  hadoop-azure in the patch failed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09.  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 14s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 1 new + 3 unchanged - 1 fixed = 4 total (was 4)  |\r\n   | -1 :x: |  mvnsite  |   0m 20s | [/patch-mvnsite-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-mvnsite-hadoop-tools_hadoop-azure.txt) |  hadoop-azure in the patch failed.  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | -1 :x: |  spotbugs  |   0m 19s | [/patch-spotbugs-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-spotbugs-hadoop-tools_hadoop-azure.txt) |  hadoop-azure in the patch failed.  |\r\n   | +1 :green_heart: |  shadedclient  |  23m 11s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | -1 :x: |  unit  |   0m 22s | [/patch-unit-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/patch-unit-hadoop-tools_hadoop-azure.txt) |  hadoop-azure in the patch failed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 25s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  79m 38s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 7c23cf71703b 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 4125a4f01c4cb11191416cb32d6e8cb792498e86 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/testReport/ |\r\n   | Max. process+thread count | 547 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/11/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-23T11:02:16.620+0000", "updated": "2025-08-23T11:02:16.620+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18016433", "id": "18016433", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2302908266\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n+\n+  /**\n+   * Connection timeout for establishing a new connection.\n+   */\n+  private final int connectionTimeout;\n+\n+  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+\n+  private final Object connectionLock = new Object();\n+\n+  private HttpHost baseHost;\n+\n   AbfsConnectionManager(Registry<ConnectionSocketFactory> socketFactoryRegistry,\n-      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac) {\n+      AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac,\n+      final AbfsConfiguration abfsConfiguration, final URL baseUrl) {\n     this.httpConnectionFactory = connectionFactory;\n+    this.connectionTimeout = abfsConfiguration.getHttpConnectionTimeout();\n     this.kac = kac;\n     this.connectionOperator = new DefaultHttpClientConnectionOperator(\n         socketFactoryRegistry, null, null);\n+    if (abfsConfiguration.getCacheWarmupConnections() > 0) {\n\nReview Comment:\n   Sure, we can discuss this.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -280,17 +282,18 @@ HttpResponse executeRequest() throws IOException {\n   /**{@inheritDoc}*/\n   @Override\n   public void setRequestProperty(final String key, final String value) {\n-    List<AbfsHttpHeader> headers = getRequestHeaders();\n-    if (headers != null) {\n-      headers.add(new AbfsHttpHeader(key, value));\n+    if (httpRequestBase instanceof HttpEntityEnclosingRequestBase\n\nReview Comment:\n   Sure, will add the java doc for this\n   \n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/FileSystemConfigurations.java:\n##########\n@@ -213,13 +213,19 @@ public final class FileSystemConfigurations {\n   public static final long THOUSAND = 1000L;\n \n   public static final HttpOperationType DEFAULT_NETWORKING_LIBRARY\n-      = HttpOperationType.JDK_HTTP_URL_CONNECTION;\n+      = HttpOperationType.APACHE_HTTP_CLIENT;\n\nReview Comment:\n   Reverted\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -196,7 +199,6 @@ public void processResponse(final byte[] buffer,\n       final int length) throws IOException {\n     try {\n       if (!isPayloadRequest) {\n-        prepareRequest();\n\nReview Comment:\n   As noted in the previous comment, we are organizing the data in a clear and structured way in the constructor itself so that we won't have to prepare it separately before sending the request.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -280,17 +282,18 @@ HttpResponse executeRequest() throws IOException {\n   /**{@inheritDoc}*/\n   @Override\n   public void setRequestProperty(final String key, final String value) {\n-    List<AbfsHttpHeader> headers = getRequestHeaders();\n-    if (headers != null) {\n-      headers.add(new AbfsHttpHeader(key, value));\n+    if (httpRequestBase instanceof HttpEntityEnclosingRequestBase\n+        && CONTENT_LENGTH.equals(key)) {\n+      return;\n     }\n+    httpRequestBase.setHeader(key, value);\n   }\n \n   /**{@inheritDoc}*/\n   @Override\n   Map<String, List<String>> getRequestProperties() {\n     Map<String, List<String>> map = new HashMap<>();\n-    for (AbfsHttpHeader header : getRequestHeaders()) {\n+    for (Header header : httpRequestBase.getAllHeaders()) {\n\nReview Comment:\n   This method returns all headers that were passed to the server in a specific request. If there are duplicate headers (including those with different cases), the method returns all headers, even those not originally sent, due to case-insensitive duplicates. This change was made to align with the JDK implementation. https://github.com/apache/hadoop/blob/0244dbddb38495d44f3dd8544e9b2bc17276dc19/hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsJdkHttpOperation.java#L103\n   Since httpRequestBase.getAllHeaders() returns Header, header is used instead of AbfsHttpHeader.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -65,12 +69,40 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n    */\n   private final HttpClientConnectionOperator connectionOperator;\n \n+  /**\n+   * Number of connections to be created during cache refresh.\n+   */\n+  private final int cacheRefreshConnections;\n\nReview Comment:\n   Will do the change\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -398,24 +400,10 @@ public void sendPayload(final byte[] buffer,\n     }\n   }\n \n-  /**\n-   * Sets the header on the request.\n-   */\n-  private void prepareRequest() {\n-    final boolean isEntityBasedRequest\n-        = httpRequestBase instanceof HttpEntityEnclosingRequestBase;\n-    for (AbfsHttpHeader header : getRequestHeaders()) {\n-      if (CONTENT_LENGTH.equals(header.getName()) && isEntityBasedRequest) {\n-        continue;\n-      }\n-      httpRequestBase.setHeader(header.getName(), header.getValue());\n-    }\n-  }\n-\n   /**{@inheritDoc}*/\n   @Override\n   public String getRequestProperty(String name) {\n-    for (AbfsHttpHeader header : getRequestHeaders()) {\n+    for (Header header : httpRequestBase.getAllHeaders()) {\n\nReview Comment:\n   Same as above\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -89,23 +121,56 @@ public ConnectionRequest requestConnection(final HttpRoute route,\n        */\n       @Override\n       public HttpClientConnection get(final long timeout,\n-          final TimeUnit timeUnit)\n-          throws InterruptedException, ExecutionException,\n-          ConnectionPoolTimeoutException {\n+          final TimeUnit timeUnit) throws ExecutionException {\n         String requestId = UUID.randomUUID().toString();\n         logDebug(\"Connection requested for request {}\", requestId);\n+        if (!route.getTargetHost().equals(baseHost)) {\n+          // If the route target host does not match the base host, create a new connection\n+          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+              route.getTargetHost(), baseHost);\n+          return createNewConnection();\n+        }\n         try {\n-          HttpClientConnection clientConn = kac.get();\n-          if (clientConn != null) {\n-            logDebug(\"Connection retrieved from KAC: {} for requestId: {}\",\n-                clientConn, requestId);\n-            return clientConn;\n+          HttpClientConnection conn = kac.get();\n+\n+          // If a valid connection is available, return it and trigger background warm-up if needed\n+          if (conn != null) {\n+            triggerConnectionWarmupIfNeeded();\n\nReview Comment:\n   The implementation of triggerConnectionWarmupIfNeeded ensures that only one thread executes it, while others exit the method. Therefore, I don't believe synchronization block is necessary in this case.\n\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsAHCHttpOperation.java:\n##########\n@@ -139,6 +139,10 @@ public AbfsAHCHttpOperation(final URL url,\n       throw new PathIOException(getUrl().toString(),\n           \"Unsupported HTTP method: \" + getMethod());\n     }\n+\n+    for (AbfsHttpHeader header : requestHeaders) {\n\nReview Comment:\n   In the current implementation of the Apache client, we perform header case checking right before sending the request (in the prepareRequest method). However, if a user provides two headers with similar keys but different cases, we might end up signing the request with a different header than intended. As a result, when the server validates the request, it could receive a different set of headers. To ensure consistency, similar to our approach with JDK, this change has been implemented. https://github.com/apache/hadoop/blob/0244dbddb38495d44f3dd8544e9b2bc17276dc19/hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsJdkHttpOperation.java#L91\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-27T06:03:36.800+0000", "updated": "2025-08-27T06:03:36.800+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017164", "id": "18017164", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3239169387\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   8m 18s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  25m 54s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 23s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 20s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 20s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 28s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 29s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 19s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 46s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m  9s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  22m 22s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 17s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 17s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 17s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 11s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/12/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 1 new + 3 unchanged - 1 fixed = 4 total (was 4)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 17s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 16s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 50s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m 29s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 22s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  88m 23s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/12/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 69bf04045e12 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / c21476c89537259ff0a805cdced557e7732ffe8c |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/12/testReport/ |\r\n   | Max. process+thread count | 686 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/12/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-30T10:16:15.647+0000", "updated": "2025-08-30T10:16:15.647+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017165", "id": "18017165", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3239169838\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   3m 27s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  26m 10s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 21s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 24s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 29s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 25s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 22s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 47s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m 15s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  22m 29s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 17s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 17s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 13s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/13/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 1 new + 3 unchanged - 1 fixed = 4 total (was 4)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 17s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 21s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 46s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  22m 44s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 27s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 25s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  84m 31s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/13/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux f775cc9264a9 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / c21476c89537259ff0a805cdced557e7732ffe8c |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/13/testReport/ |\r\n   | Max. process+thread count | 546 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/13/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-30T10:17:08.720+0000", "updated": "2025-08-30T10:17:08.720+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017211", "id": "18017211", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3239482506\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 20s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  27m 32s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 27s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 24s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 22s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 29s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 30s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 23s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 47s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 21s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  21m 33s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 14s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/14/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 5 new + 3 unchanged - 1 fixed = 8 total (was 4)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 42s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 22s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 24s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  80m 48s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/14/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 669bba0bbeb8 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 76504a29c9a5d7443c2827b77d7fdc6a140bf50d |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/14/testReport/ |\r\n   | Max. process+thread count | 561 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/14/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-30T19:12:35.820+0000", "updated": "2025-08-30T19:12:35.820+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017309", "id": "18017309", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3240328257\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 20s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  25m 49s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 26s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 25s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 23s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 28s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 27s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 22s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 43s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 20s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  21m 32s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 21s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 21s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 14s |  |  hadoop-tools/hadoop-azure: The patch generated 0 new + 4 unchanged - 1 fixed = 4 total (was 5)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 22s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 16s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 45s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 16s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 23s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 24s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  78m 42s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/15/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 75a87a1006cb 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / d6fcfe3df916fdc2975e23ea7cfa1cb8f9a13611 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/15/testReport/ |\r\n   | Max. process+thread count | 547 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/15/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-31T18:35:26.481+0000", "updated": "2025-08-31T18:35:26.481+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017423", "id": "18017423", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313758348\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/FileSystemConfigurations.java:\n##########\n@@ -213,19 +213,29 @@ public final class FileSystemConfigurations {\n   public static final long THOUSAND = 1000L;\n \n   public static final HttpOperationType DEFAULT_NETWORKING_LIBRARY\n-      = HttpOperationType.APACHE_HTTP_CLIENT;\n+      = HttpOperationType.JDK_HTTP_URL_CONNECTION;\n\nReview Comment:\n   aren't we planning on making apache the default ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T11:58:54.710+0000", "updated": "2025-09-01T11:58:54.710+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017424", "id": "18017424", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313762413\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/FileSystemConfigurations.java:\n##########\n@@ -213,19 +213,29 @@ public final class FileSystemConfigurations {\n   public static final long THOUSAND = 1000L;\n \n   public static final HttpOperationType DEFAULT_NETWORKING_LIBRARY\n-      = HttpOperationType.APACHE_HTTP_CLIENT;\n+      = HttpOperationType.JDK_HTTP_URL_CONNECTION;\n\nReview Comment:\n   Not in this PR. It will be done in upcoming PR.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T12:00:58.197+0000", "updated": "2025-09-01T12:00:58.197+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017425", "id": "18017425", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313767105\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -70,39 +69,44 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n   private final HttpClientConnectionOperator connectionOperator;\n \n   /**\n-   * Number of connections to be created during cache refresh.\n+   * AbfsConfiguration instance to get configuration values.\n    */\n-  private final int cacheRefreshConnections;\n+  private final AbfsConfiguration abfsConfiguration;\n \n   /**\n-   * Connection timeout for establishing a new connection.\n+   * Atomic boolean to ensure only one thread can trigger cache refresh at a time.\n    */\n-  private final int connectionTimeout;\n-\n-  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+  private final AtomicBoolean isCacheRefreshInProgress = new AtomicBoolean(\n\nReview Comment:\n   should be in a single line\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T12:03:19.870+0000", "updated": "2025-09-01T12:03:19.870+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017426", "id": "18017426", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313772047\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -70,39 +69,44 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n   private final HttpClientConnectionOperator connectionOperator;\n \n   /**\n-   * Number of connections to be created during cache refresh.\n+   * AbfsConfiguration instance to get configuration values.\n    */\n-  private final int cacheRefreshConnections;\n+  private final AbfsConfiguration abfsConfiguration;\n \n   /**\n-   * Connection timeout for establishing a new connection.\n+   * Atomic boolean to ensure only one thread can trigger cache refresh at a time.\n    */\n-  private final int connectionTimeout;\n-\n-  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+  private final AtomicBoolean isCacheRefreshInProgress = new AtomicBoolean(\n+      false);\n \n+  /**\n+   * Lock object for synchronizing connection retrieval and caching.\n+   */\n   private final Object connectionLock = new Object();\n \n+  /**\n+   * The base host for which connections are managed.\n+   */\n   private HttpHost baseHost;\n \n   AbfsConnectionManager(Registry<ConnectionSocketFactory> socketFactoryRegistry,\n       AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac,\n       final AbfsConfiguration abfsConfiguration, final URL baseUrl) {\n     this.httpConnectionFactory = connectionFactory;\n-    this.connectionTimeout = abfsConfiguration.getHttpConnectionTimeout();\n     this.kac = kac;\n     this.connectionOperator = new DefaultHttpClientConnectionOperator(\n         socketFactoryRegistry, null, null);\n-    if (abfsConfiguration.getCacheWarmupConnections() > 0) {\n+    this.abfsConfiguration = abfsConfiguration;\n+    if (abfsConfiguration.getApacheCacheWarmupCount() > 0) {\n       // Warm up the cache with connections.\n       logDebug(\"Warming up the KeepAliveCache with {} connections\",\n\nReview Comment:\n   Directly using LOG.Debug should be better instead of a recursive method just for debug logging\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T12:05:48.978+0000", "updated": "2025-09-01T12:05:48.978+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017427", "id": "18017427", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313772614\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -126,35 +130,36 @@ public HttpClientConnection get(final long timeout,\n         logDebug(\"Connection requested for request {}\", requestId);\n         if (!route.getTargetHost().equals(baseHost)) {\n           // If the route target host does not match the base host, create a new connection\n-          logDebug(\"Route target host {} does not match base host {}, creating new connection\",\n+          logDebug(\n\nReview Comment:\n   same for all places\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T12:06:09.992+0000", "updated": "2025-09-01T12:06:09.992+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017430", "id": "18017430", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313784171\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -290,35 +298,45 @@ private void logDebug(String message, Object... args) {\n    * @param route the HTTP route for which connections are created\n    * @param numberOfConnections the number of connections to create\n    */\n-  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n-    if (!isCaching.getAndSet(true)) {\n-      long start = System.currentTimeMillis();\n-      // Only one thread allowed at a time\n-      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+  private void cacheExtraConnection(final HttpRoute route,\n+      final int numberOfConnections) {\n+    if (!isCacheRefreshInProgress.getAndSet(true)) {\n+      long start = System.nanoTime();\n+      CountDownLatch latch = new CountDownLatch(numberOfConnections);\n \n       for (int i = 0; i < numberOfConnections; i++) {\n-        executorService.submit(() -> {\n+        kac.getFixedThreadPool().submit(() -> {\n+          HttpClientConnection conn = null;\n           try {\n-            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n-            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, abfsConfiguration.getHttpConnectionTimeout(),\n+                new AbfsManagedHttpClientContext());\n             addConnectionToCache(conn);\n           } catch (Exception e) {\n-           logDebug(\"Error creating connection: {}\", e.getMessage());\n+            logDebug(\"Error creating connection: {}\", e.getMessage());\n+            if (conn != null) {\n\nReview Comment:\n   should be in finally block\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T12:11:54.642+0000", "updated": "2025-09-01T12:11:54.642+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017431", "id": "18017431", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313786906\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -290,35 +298,45 @@ private void logDebug(String message, Object... args) {\n    * @param route the HTTP route for which connections are created\n    * @param numberOfConnections the number of connections to create\n    */\n-  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n-    if (!isCaching.getAndSet(true)) {\n-      long start = System.currentTimeMillis();\n-      // Only one thread allowed at a time\n-      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+  private void cacheExtraConnection(final HttpRoute route,\n+      final int numberOfConnections) {\n+    if (!isCacheRefreshInProgress.getAndSet(true)) {\n+      long start = System.nanoTime();\n+      CountDownLatch latch = new CountDownLatch(numberOfConnections);\n \n       for (int i = 0; i < numberOfConnections; i++) {\n-        executorService.submit(() -> {\n+        kac.getFixedThreadPool().submit(() -> {\n+          HttpClientConnection conn = null;\n           try {\n-            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n-            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, abfsConfiguration.getHttpConnectionTimeout(),\n+                new AbfsManagedHttpClientContext());\n             addConnectionToCache(conn);\n           } catch (Exception e) {\n-           logDebug(\"Error creating connection: {}\", e.getMessage());\n+            logDebug(\"Error creating connection: {}\", e.getMessage());\n+            if (conn != null) {\n+              try {\n+                conn.close();\n+              } catch (IOException ioException) {\n+                logDebug(\"Error closing connection: {}\",\n+                    ioException.getMessage());\n+              }\n+            }\n+          } finally {\n+            latch.countDown();\n           }\n         });\n       }\n \n-      executorService.shutdown();\n       try {\n-        if (!executorService.awaitTermination(1, TimeUnit.SECONDS)) {\n-          executorService.shutdownNow();\n-        }\n+        // Wait for all connections to be created before releasing the lock\n+        latch.await();\n\nReview Comment:\n   Add latch timeout else it might keep waiting forever\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T12:13:15.342+0000", "updated": "2025-09-01T12:13:15.342+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017451", "id": "18017451", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313994658\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -70,39 +69,44 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n   private final HttpClientConnectionOperator connectionOperator;\n \n   /**\n-   * Number of connections to be created during cache refresh.\n+   * AbfsConfiguration instance to get configuration values.\n    */\n-  private final int cacheRefreshConnections;\n+  private final AbfsConfiguration abfsConfiguration;\n \n   /**\n-   * Connection timeout for establishing a new connection.\n+   * Atomic boolean to ensure only one thread can trigger cache refresh at a time.\n    */\n-  private final int connectionTimeout;\n-\n-  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+  private final AtomicBoolean isCacheRefreshInProgress = new AtomicBoolean(\n\nReview Comment:\n   IDE formatted it according to the template; I didn't make this change myself.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T13:39:51.451+0000", "updated": "2025-09-01T13:39:51.451+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017453", "id": "18017453", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2313995545\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -70,39 +69,44 @@ class AbfsConnectionManager implements HttpClientConnectionManager {\n   private final HttpClientConnectionOperator connectionOperator;\n \n   /**\n-   * Number of connections to be created during cache refresh.\n+   * AbfsConfiguration instance to get configuration values.\n    */\n-  private final int cacheRefreshConnections;\n+  private final AbfsConfiguration abfsConfiguration;\n \n   /**\n-   * Connection timeout for establishing a new connection.\n+   * Atomic boolean to ensure only one thread can trigger cache refresh at a time.\n    */\n-  private final int connectionTimeout;\n-\n-  private final AtomicBoolean isCaching = new AtomicBoolean(false);\n+  private final AtomicBoolean isCacheRefreshInProgress = new AtomicBoolean(\n+      false);\n \n+  /**\n+   * Lock object for synchronizing connection retrieval and caching.\n+   */\n   private final Object connectionLock = new Object();\n \n+  /**\n+   * The base host for which connections are managed.\n+   */\n   private HttpHost baseHost;\n \n   AbfsConnectionManager(Registry<ConnectionSocketFactory> socketFactoryRegistry,\n       AbfsHttpClientConnectionFactory connectionFactory, KeepAliveCache kac,\n       final AbfsConfiguration abfsConfiguration, final URL baseUrl) {\n     this.httpConnectionFactory = connectionFactory;\n-    this.connectionTimeout = abfsConfiguration.getHttpConnectionTimeout();\n     this.kac = kac;\n     this.connectionOperator = new DefaultHttpClientConnectionOperator(\n         socketFactoryRegistry, null, null);\n-    if (abfsConfiguration.getCacheWarmupConnections() > 0) {\n+    this.abfsConfiguration = abfsConfiguration;\n+    if (abfsConfiguration.getApacheCacheWarmupCount() > 0) {\n       // Warm up the cache with connections.\n       logDebug(\"Warming up the KeepAliveCache with {} connections\",\n\nReview Comment:\n   okay, will make the change.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T13:40:14.414+0000", "updated": "2025-09-01T13:40:14.414+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017456", "id": "18017456", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2314009761\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -290,35 +298,45 @@ private void logDebug(String message, Object... args) {\n    * @param route the HTTP route for which connections are created\n    * @param numberOfConnections the number of connections to create\n    */\n-  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n-    if (!isCaching.getAndSet(true)) {\n-      long start = System.currentTimeMillis();\n-      // Only one thread allowed at a time\n-      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+  private void cacheExtraConnection(final HttpRoute route,\n+      final int numberOfConnections) {\n+    if (!isCacheRefreshInProgress.getAndSet(true)) {\n+      long start = System.nanoTime();\n+      CountDownLatch latch = new CountDownLatch(numberOfConnections);\n \n       for (int i = 0; i < numberOfConnections; i++) {\n-        executorService.submit(() -> {\n+        kac.getFixedThreadPool().submit(() -> {\n+          HttpClientConnection conn = null;\n           try {\n-            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n-            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, abfsConfiguration.getHttpConnectionTimeout(),\n+                new AbfsManagedHttpClientContext());\n             addConnectionToCache(conn);\n           } catch (Exception e) {\n-           logDebug(\"Error creating connection: {}\", e.getMessage());\n+            logDebug(\"Error creating connection: {}\", e.getMessage());\n+            if (conn != null) {\n\nReview Comment:\n   It should be in catch block only. In case of no exception, we are catching the connection to reuse it. So, we should not close the connection in case there is no exception.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T13:45:21.858+0000", "updated": "2025-09-01T13:45:21.858+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017470", "id": "18017470", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2314009761\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -290,35 +298,45 @@ private void logDebug(String message, Object... args) {\n    * @param route the HTTP route for which connections are created\n    * @param numberOfConnections the number of connections to create\n    */\n-  private void cacheExtraConnection(final HttpRoute route, final int numberOfConnections) {\n-    if (!isCaching.getAndSet(true)) {\n-      long start = System.currentTimeMillis();\n-      // Only one thread allowed at a time\n-      ExecutorService executorService = Executors.newFixedThreadPool(Math.min(numberOfConnections, 5));\n+  private void cacheExtraConnection(final HttpRoute route,\n+      final int numberOfConnections) {\n+    if (!isCacheRefreshInProgress.getAndSet(true)) {\n+      long start = System.nanoTime();\n+      CountDownLatch latch = new CountDownLatch(numberOfConnections);\n \n       for (int i = 0; i < numberOfConnections; i++) {\n-        executorService.submit(() -> {\n+        kac.getFixedThreadPool().submit(() -> {\n+          HttpClientConnection conn = null;\n           try {\n-            HttpClientConnection conn = httpConnectionFactory.create(route, null);\n-            connect(conn, route, connectionTimeout, new AbfsManagedHttpClientContext());\n+            conn = httpConnectionFactory.create(route, null);\n+            connect(conn, route, abfsConfiguration.getHttpConnectionTimeout(),\n+                new AbfsManagedHttpClientContext());\n             addConnectionToCache(conn);\n           } catch (Exception e) {\n-           logDebug(\"Error creating connection: {}\", e.getMessage());\n+            logDebug(\"Error creating connection: {}\", e.getMessage());\n+            if (conn != null) {\n\nReview Comment:\n   It should be in catch block only. In case of no exception, the connection will be put to cache for reuse. So, we should not close the connection in case there is no exception.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T14:14:49.247+0000", "updated": "2025-09-01T14:14:49.247+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017474", "id": "18017474", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2314111794\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/ITestAbfsClient.java:\n##########\n@@ -881,8 +880,10 @@ private void testIsNonEmptyDirectoryInternal(String firstCT,\n    */\n   @Test\n   public void testKeepAliveCacheInitializationWithApacheHttpClient() throws Exception {\n-    Assume.assumeTrue(APACHE_HTTP_CLIENT == httpOperationType);\n+    assumeThat(APACHE_HTTP_CLIENT).isEqualTo(httpOperationType);\n     final AzureBlobFileSystem fs = this.getFileSystem();\n+    assumeThat(APACHE_HTTP_CLIENT).isEqualTo(\n\nReview Comment:\n   Move assume statement above\r\n   \n\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/ITestAbfsClient.java:\n##########\n@@ -898,8 +899,11 @@ public void testKeepAliveCacheInitializationWithApacheHttpClient() throws Except\n    */\n   @Test\n   public void testStaleConnectionBehavior() throws Exception {\n-    Assume.assumeTrue(APACHE_HTTP_CLIENT == httpOperationType);\n-    Configuration conf = this.getFileSystem().getConf();\n+    assumeThat(APACHE_HTTP_CLIENT).isEqualTo(httpOperationType);\n+    final AzureBlobFileSystem fs = this.getFileSystem();\n\nReview Comment:\n   same as above\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T14:27:20.279+0000", "updated": "2025-09-01T14:27:20.279+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017476", "id": "18017476", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2314113712\n\n\n##########\nhadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/ITestAbfsClient.java:\n##########\n@@ -933,8 +937,10 @@ public void testStaleConnectionBehavior() throws Exception {\n    */\n   @Test\n   public void testApacheConnectionReuse() throws Exception {\n-    Assume.assumeTrue(APACHE_HTTP_CLIENT == httpOperationType);\n+    assumeThat(APACHE_HTTP_CLIENT).isEqualTo(httpOperationType);\n\nReview Comment:\n   Move assume statements as first statements in the tests\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T14:28:15.320+0000", "updated": "2025-09-01T14:28:15.320+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017525", "id": "18017525", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3242999575\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   8m 47s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  27m  4s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 26s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 25s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 20s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 28s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 28s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 25s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 48s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 30s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  21m 42s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 21s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 21s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 18s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | -0 :warning: |  checkstyle  |   0m 12s | [/results-checkstyle-hadoop-tools_hadoop-azure.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/16/artifact/out/results-checkstyle-hadoop-tools_hadoop-azure.txt) |  hadoop-tools/hadoop-azure: The patch generated 1 new + 4 unchanged - 1 fixed = 5 total (was 5)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 17s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 44s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 22s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 23s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  88m 41s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/16/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux f725879b7267 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 3cf588a242a0b477c6d8d952cf0b4f8fc21bc64d |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/16/testReport/ |\r\n   | Max. process+thread count | 560 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/16/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-01T17:40:24.686+0000", "updated": "2025-09-01T17:40:24.686+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017878", "id": "18017878", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3248740995\n\n   :broken_heart: **-1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 30s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  1s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 6 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  25m 40s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 22s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 18s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 16s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 21s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 21s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 19s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 45s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 44s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  21m 58s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 21s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 17s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 17s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 14s |  |  hadoop-tools/hadoop-azure: The patch generated 0 new + 4 unchanged - 1 fixed = 4 total (was 5)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 19s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 19s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 43s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 11s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 23s |  |  hadoop-azure in the patch passed.  |\r\n   | -1 :x: |  asflicense  |   0m 26s | [/results-asflicense.txt](https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/17/artifact/out/results-asflicense.txt) |  The patch generated 1 ASF License warnings.  |\r\n   |  |   |  78m 17s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/17/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 21ae7abae82b 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / cbeedc775c0de97d247c3b779bf0052681810678 |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/17/testReport/ |\r\n   | Max. process+thread count | 560 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/17/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-03T10:54:07.493+0000", "updated": "2025-09-03T10:54:07.493+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017891", "id": "18017891", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3249009379\n\n   :confetti_ball: **+1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |   0m 22s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  1s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  0s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  0s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | +1 :green_heart: |  test4tests  |   0m  0s |  |  The patch appears to include 5 new or modified test files.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  26m 14s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |   0m 26s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  compile  |   0m 25s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 22s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 27s |  |  trunk passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 30s |  |  trunk passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 23s |  |  trunk passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 44s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 11s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   | -0 :warning: |  patch  |  21m 24s |  |  Used diff version of patch file. Binary files and potentially other changes not applied. Please rebase and squash commits if necessary.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 20s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javac  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |   0m 19s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  javac  |   0m 19s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  checkstyle  |   0m 13s |  |  hadoop-tools/hadoop-azure: The patch generated 0 new + 4 unchanged - 1 fixed = 4 total (was 5)  |\r\n   | +1 :green_heart: |  mvnsite  |   0m 20s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04  |\r\n   | +1 :green_heart: |  javadoc  |   0m 18s |  |  the patch passed with JDK Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09  |\r\n   | +1 :green_heart: |  spotbugs  |   0m 45s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  21m 20s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |   2m 23s |  |  hadoop-azure in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   0m 26s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   |  78m 55s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/18/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/7817 |\r\n   | Optional Tests | dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets |\r\n   | uname | Linux 776eeab2c896 5.15.0-143-generic #153-Ubuntu SMP Fri Jun 13 19:10:45 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 4f1bcd49aed06a094f43b4e554e37a4b253fe02d |\r\n   | Default Java | Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   | Multi-JDK versions | /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.27+6-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_452-8u452-ga~us1-0ubuntu1~20.04-b09 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/18/testReport/ |\r\n   | Max. process+thread count | 551 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-tools/hadoop-azure U: hadoop-tools/hadoop-azure |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-7817/18/console |\r\n   | versions | git=2.25.1 maven=3.6.3 spotbugs=4.2.2 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-03T12:18:04.841+0000", "updated": "2025-09-03T12:18:04.841+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18017951", "id": "18017951", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#issuecomment-3250119305\n\n   \r\n   ============================================================\r\n   HNS-OAuth-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 867, Failures: 0, Errors: 0, Skipped: 214\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 23\r\n   \r\n   ============================================================\r\n   HNS-SharedKey-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 4\r\n   [WARNING] Tests run: 870, Failures: 0, Errors: 0, Skipped: 166\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 10\r\n   \r\n   ============================================================\r\n   NonHNS-SharedKey-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 709, Failures: 0, Errors: 0, Skipped: 245\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 11\r\n   \r\n   ============================================================\r\n   AppendBlob-HNS-OAuth-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 867, Failures: 0, Errors: 0, Skipped: 225\r\n   [WARNING] Tests run: 135, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 23\r\n   \r\n   ============================================================\r\n   NonHNS-SharedKey-Blob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 714, Failures: 0, Errors: 0, Skipped: 143\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 11\r\n   \r\n   ============================================================\r\n   NonHNS-OAuth-DFS\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 706, Failures: 0, Errors: 0, Skipped: 247\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \r\n   ============================================================\r\n   NonHNS-OAuth-Blob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 711, Failures: 0, Errors: 0, Skipped: 155\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \r\n   ============================================================\r\n   AppendBlob-NonHNS-OAuth-Blob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 708, Failures: 0, Errors: 0, Skipped: 197\r\n   [WARNING] Tests run: 135, Failures: 0, Errors: 0, Skipped: 4\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \r\n   ============================================================\r\n   HNS-Oauth-DFS-IngressBlob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 3\r\n   [WARNING] Tests run: 741, Failures: 0, Errors: 0, Skipped: 221\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 23\r\n   \r\n   ============================================================\r\n   NonHNS-OAuth-DFS-IngressBlob\r\n   ============================================================\r\n   \r\n   [WARNING] Tests run: 182, Failures: 0, Errors: 0, Skipped: 10\r\n   [WARNING] Tests run: 706, Failures: 0, Errors: 0, Skipped: 244\r\n   [WARNING] Tests run: 158, Failures: 0, Errors: 0, Skipped: 11\r\n   [WARNING] Tests run: 271, Failures: 0, Errors: 0, Skipped: 24\r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-03T17:21:09.221+0000", "updated": "2025-09-03T17:21:09.221+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018118", "id": "18018118", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anujmodi2021 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2322024205\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n\nReview Comment:\n   This still seems pending.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-04T13:06:01.345+0000", "updated": "2025-09-04T13:06:01.345+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018289", "id": "18018289", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2324140757\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n\nReview Comment:\n   This is done; we are now using single thread pool executor for this. Also, I have added name to thread of single pool executor as well.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-05T05:32:03.821+0000", "updated": "2025-09-05T05:32:03.821+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018290", "id": "18018290", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2324140757\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -115,6 +180,26 @@ public HttpClientConnection get(final long timeout,\n       public boolean cancel() {\n         return false;\n       }\n+\n+      /**\n+       * Trigger a background warm-up of the connection cache if needed.\n+       * This method checks if the cache size is small and if caching is not already in progress.\n+       * If so, it starts a new thread to cache extra connections.\n+       */\n+      private void triggerConnectionWarmupIfNeeded() {\n+        if (kac.size() <= 2 && !isCaching.get()) {\n+          // Use a single-threaded executor or thread pool instead of raw thread\n\nReview Comment:\n   This is taken care; we are now using single thread pool executor for this. Also, I have added name to thread of single pool executor as well.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-05T05:32:43.854+0000", "updated": "2025-09-05T05:32:43.854+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018766", "id": "18018766", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2329529037\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -192,12 +204,20 @@ public boolean cancel() {\n        * If so, it starts a new thread to cache extra connections.\n        */\n       private void triggerConnectionRefreshIfNeeded() {\n-        if (kac.size() <= abfsConfiguration.getApacheMinTriggerRefreshCount()\n-            && !isCacheRefreshInProgress.get() && !kac.getIsClosed()) {\n+        if (!isCacheRefreshInProgress.get() && !kac.getIsClosed()\n+            && kac.getFixedThreadPool() != null\n+            && kac.getSingleThreadPool() != null\n+            && kac.size()\n+            <= abfsConfiguration.getApacheMinTriggerRefreshCount()) {\n           // Use a single-threaded executor or thread pool instead of raw thread\n-          kac.getSingleThreadExecutor().submit(() ->\n-              cacheExtraConnection(route,\n-                  abfsConfiguration.getApacheCacheRefreshCount()));\n+          try {\n+            kac.getSingleThreadPool().submit(() ->\n+                cacheExtraConnection(route,\n+                    abfsConfiguration.getApacheCacheRefreshCount()));\n+          } catch (RejectedExecutionException e) {\n\nReview Comment:\n   we should throw back the exception right ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-08T08:36:57.087+0000", "updated": "2025-09-08T08:36:57.087+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018775", "id": "18018775", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2329631985\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -192,12 +204,20 @@ public boolean cancel() {\n        * If so, it starts a new thread to cache extra connections.\n        */\n       private void triggerConnectionRefreshIfNeeded() {\n-        if (kac.size() <= abfsConfiguration.getApacheMinTriggerRefreshCount()\n-            && !isCacheRefreshInProgress.get() && !kac.getIsClosed()) {\n+        if (!isCacheRefreshInProgress.get() && !kac.getIsClosed()\n+            && kac.getFixedThreadPool() != null\n+            && kac.getSingleThreadPool() != null\n+            && kac.size()\n+            <= abfsConfiguration.getApacheMinTriggerRefreshCount()) {\n           // Use a single-threaded executor or thread pool instead of raw thread\n-          kac.getSingleThreadExecutor().submit(() ->\n-              cacheExtraConnection(route,\n-                  abfsConfiguration.getApacheCacheRefreshCount()));\n+          try {\n+            kac.getSingleThreadPool().submit(() ->\n+                cacheExtraConnection(route,\n+                    abfsConfiguration.getApacheCacheRefreshCount()));\n+          } catch (RejectedExecutionException e) {\n\nReview Comment:\n   This is intended to prevent the creation of a new connection if the cache has already been closed. If a thread tries to access the cache after the cache has been closed, a CacheClosed exception will be thrown, so according to the design, we should not throw an exception from this point.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-08T09:11:22.950+0000", "updated": "2025-09-08T09:11:22.950+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018781", "id": "18018781", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anmolanmol1234 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2329725819\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -192,12 +204,20 @@ public boolean cancel() {\n        * If so, it starts a new thread to cache extra connections.\n        */\n       private void triggerConnectionRefreshIfNeeded() {\n-        if (kac.size() <= abfsConfiguration.getApacheMinTriggerRefreshCount()\n-            && !isCacheRefreshInProgress.get() && !kac.getIsClosed()) {\n+        if (!isCacheRefreshInProgress.get() && !kac.getIsClosed()\n+            && kac.getFixedThreadPool() != null\n+            && kac.getSingleThreadPool() != null\n+            && kac.size()\n+            <= abfsConfiguration.getApacheMinTriggerRefreshCount()) {\n           // Use a single-threaded executor or thread pool instead of raw thread\n-          kac.getSingleThreadExecutor().submit(() ->\n-              cacheExtraConnection(route,\n-                  abfsConfiguration.getApacheCacheRefreshCount()));\n+          try {\n+            kac.getSingleThreadPool().submit(() ->\n+                cacheExtraConnection(route,\n+                    abfsConfiguration.getApacheCacheRefreshCount()));\n+          } catch (RejectedExecutionException e) {\n\nReview Comment:\n   So we should just return back ?\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-08T09:48:14.103+0000", "updated": "2025-09-08T09:48:14.103+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018784", "id": "18018784", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "bhattmanish98 commented on code in PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817#discussion_r2329733766\n\n\n##########\nhadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsConnectionManager.java:\n##########\n@@ -192,12 +204,20 @@ public boolean cancel() {\n        * If so, it starts a new thread to cache extra connections.\n        */\n       private void triggerConnectionRefreshIfNeeded() {\n-        if (kac.size() <= abfsConfiguration.getApacheMinTriggerRefreshCount()\n-            && !isCacheRefreshInProgress.get() && !kac.getIsClosed()) {\n+        if (!isCacheRefreshInProgress.get() && !kac.getIsClosed()\n+            && kac.getFixedThreadPool() != null\n+            && kac.getSingleThreadPool() != null\n+            && kac.size()\n+            <= abfsConfiguration.getApacheMinTriggerRefreshCount()) {\n           // Use a single-threaded executor or thread pool instead of raw thread\n-          kac.getSingleThreadExecutor().submit(() ->\n-              cacheExtraConnection(route,\n-                  abfsConfiguration.getApacheCacheRefreshCount()));\n+          try {\n+            kac.getSingleThreadPool().submit(() ->\n+                cacheExtraConnection(route,\n+                    abfsConfiguration.getApacheCacheRefreshCount()));\n+          } catch (RejectedExecutionException e) {\n\nReview Comment:\n   Yes, no extra connection will be created in this case and flow will return as it is.\n\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-08T09:50:34.208+0000", "updated": "2025-09-08T09:50:34.208+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13622762/comment/18018816", "id": "18018816", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "anujmodi2021 merged PR #7817:\nURL: https://github.com/apache/hadoop/pull/7817\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-08T12:13:47.682+0000", "updated": "2025-09-08T12:13:47.682+0000"}], "maxResults": 104, "total": 104, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}