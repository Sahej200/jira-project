{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13624477", "self": "https://issues.apache.org/jira/rest/api/2/issue/13624477", "key": "HADOOP-19640", "fields": {"summary": "Resource leak in AssumedRoleCredentialProvider", "description": "When `org.apache.hadoop.fs.s3a.auth.AssumedRoleCredentialProvider` is used in a Hadoop Configuration object, it will attempt to `resolveCredentials()` inside the constructor.\r\n\r\n(lines 165-167)\r\n{code:java}\r\n// and force in a fail-fast check just to keep the stack traces less\r\n// convoluted\r\nresolveCredentials();{code}\r\n\r\nIf this method fails, because the current identity is not able to assume role, the constructor will throw an exception, and fail to close the `stsClient`, `stsProvider` and any other resources that are created in the constructor, leaking threads and other resources.\r\n\u00a0\r\nIn a long running application, that handles Hadoop S3 file systems, where the user can dynamically change to configured role to assume, and external id, this will lead to eventually the system running out of resources due to the leaked threads created by the AWS SDK clients that are not closed when a wrong role or external id is used.\r\n\u00a0\r\n\r\nThere are two potential fixes for this problem:\r\n\r\n\u00a0- Don't attempt to `resolveCredentials()` inside the constructor\r\n\r\n\u00a0- Wrap the `resolveCredentials()` in the constructor in a try/catch block, that cleans the resources and rethrows the exception in the catch block.", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=antonireus", "name": "antonireus", "key": "JIRAUSER310271", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER310271&avatarId=54434", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER310271&avatarId=54434", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER310271&avatarId=54434", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER310271&avatarId=54434"}, "displayName": "Antoni Reus", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}