{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13628320", "self": "https://issues.apache.org/jira/rest/api/2/issue/13628320", "key": "KAFKA-19685", "fields": {"summary": "Revoked partitions are included in currentOffsets passed to preCommit on task stop", "description": "When a task stops, [{{WorkerSinkTask#closeAllPartitions()}}|https://github.com/apache/kafka/blob/84caaa6e9da06435411510a81fa321d4f99c351f/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java#L664] runs and the [task\u2019s {{preCommit}}\u00a0is invoked|https://github.com/apache/kafka/blob/3c7f99ad31397a6a7a4975d058891f236f37d02d/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java#L444]. At that time, the {{currentOffsets}} argument may include {*}revoked partitions{*}.\r\n\r\nThis appears to be caused by:\r\n * {{WorkerSinkTask}} does not remove revoked partitions from {{currentOffsets}}\r\n * {{WorkerSinkTask#closeAllPartitions()}} passes its {{currentOffsets}} to {{SinkTask#preCommit(...)}} _as-is_ (i.e., without filtering).\r\n\r\nDuring normal iterations, {{SinkTask#preCommit(...)}} receives {{{}KafkaConsumer#assignment(){}}}, so revoked partitions are *not* included.\r\n\r\nHaving revoked partitions included *only* at stop is confusing behavior. If this behavior is specified, Could we add a brief note to the {{SinkTask#preCommit(...)}} Javadoc to clarify this behavior?", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=sonjox", "name": "sonjox", "key": "JIRAUSER310889", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Toshiki Murakami", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13628320/comment/18032342", "id": "18032342", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zheguang", "name": "zheguang", "key": "JIRAUSER308070", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"}, "displayName": "Guang Zhao", "active": true, "timeZone": "Australia/Melbourne"}, "body": "Added clarification in https://github.com/apache/kafka/pull/20756.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zheguang", "name": "zheguang", "key": "JIRAUSER308070", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"}, "displayName": "Guang Zhao", "active": true, "timeZone": "Australia/Melbourne"}, "created": "2025-10-23T04:29:52.142+0000", "updated": "2025-10-23T04:29:52.142+0000"}], "maxResults": 1, "total": 1, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}