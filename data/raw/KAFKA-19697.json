{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13628646", "self": "https://issues.apache.org/jira/rest/api/2/issue/13628646", "key": "KAFKA-19697", "fields": {"summary": "NPE Cannot invoke org.apache.kafka.connect.runtime.ConnectMetrics$MetricGroup.close()", "description": "Several tasks in multiple sink connectors in a long-running connect cluster broke spontaneously (within a couple of hours) with the following stacktrace:\r\n{code:java}\r\njava.lang.NullPointerException: Cannot invoke \"org.apache.kafka.connect.runtime.ConnectMetrics$MetricGroup.close()\" because the return value of \"java.util.concurrent.ConcurrentMap.get(Object)\" is null\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.Worker$ConnectorStatusMetricsGroup.recordTaskRemoved(Worker.java:2333)\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.Worker.startTask(Worker.java:707)\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.Worker.startSinkTask(Worker.java:568)\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.distributed.DistributedHerder.startTask(DistributedHerder.java:2009)\r\n\u00a0 \u00a0 at org.apache.kafka.connect.runtime.distributed.DistributedHerder.lambda$getTaskStartingCallable$39(DistributedHerder.java:2059)\r\n\u00a0 \u00a0 at java.base/java.util.concurrent.FutureTask.run(Unknown Source)\r\n\u00a0 \u00a0 at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n\u00a0 \u00a0 at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n\u00a0 \u00a0 at java.base/java.lang.Thread.run(Unknown Source) {code}\r\nRestarting the failed tasks with the REST API lead to another task failure with the following stacktrace:\r\n{code:java}\r\njava.lang.NullPointerException: Cannot invoke \"java.util.Map.size()\" because \"inputMap\" is null\r\n    at org.apache.kafka.common.utils.Utils.castToStringObjectMap(Utils.java:1476)\r\n    at org.apache.kafka.common.config.AbstractConfig.<init>(AbstractConfig.java:112)\r\n    at org.apache.kafka.common.config.AbstractConfig.<init>(AbstractConfig.java:146)\r\n    at org.apache.kafka.connect.runtime.TaskConfig.<init>(TaskConfig.java:51)\r\n    at org.apache.kafka.connect.runtime.Worker.startTask(Worker.java:661)\r\n    at org.apache.kafka.connect.runtime.Worker.startSinkTask(Worker.java:568)\r\n    at org.apache.kafka.connect.runtime.distributed.DistributedHerder.startTask(DistributedHerder.java:2009)\r\n    at org.apache.kafka.connect.runtime.distributed.DistributedHerder.lambda$getTaskStartingCallable$39(DistributedHerder.java:2059)\r\n    at java.base/java.util.concurrent.FutureTask.run(Unknown Source)\r\n    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n    at java.base/java.lang.Thread.run(Unknown Source)\r\n {code}\r\nLikely related to KAFKA-17719 ?\r\n\r\nThe failed tasks did not show up on the _connector-failed-task-count_ metric (or in the _restarting/paused/failed_ task metrics), but the failing tasks disappeared from the connector-running-task-count metric.\r\n\r\nRestarting the whole connect cluster resolved the issue.\r\n\r\n\u00a0", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=beregon87", "name": "beregon87", "key": "beregon87", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Martin Andersson", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13628646/comment/18019532", "id": "18019532", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=beregon87", "name": "beregon87", "key": "beregon87", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Martin Andersson", "active": true, "timeZone": "Etc/UTC"}, "body": "Clarification: The tasks broke after two connect worker pods were killed and re-created. Only 2 out of 48 tasks broke, so this is not a configuration issue.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=beregon87", "name": "beregon87", "key": "beregon87", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Martin Andersson", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-11T08:16:40.719+0000", "updated": "2025-09-11T08:16:40.719+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13628646/comment/18021558", "id": "18021558", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=fanyan", "name": "fanyan", "key": "JIRAUSER305427", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER305427&avatarId=53530", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER305427&avatarId=53530", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER305427&avatarId=53530", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER305427&avatarId=53530"}, "displayName": "Fan Yang", "active": true, "timeZone": "Etc/UTC"}, "body": "I also encountered this issue. The NPE is due to multiple uninitialized tasks unregistering ConnectorStatus Metrics Group. Created a PR to fix it.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=fanyan", "name": "fanyan", "key": "JIRAUSER305427", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER305427&avatarId=53530", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER305427&avatarId=53530", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER305427&avatarId=53530", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER305427&avatarId=53530"}, "displayName": "Fan Yang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-20T10:33:47.996+0000", "updated": "2025-09-20T10:33:47.996+0000"}], "maxResults": 2, "total": 2, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}