{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13630231", "self": "https://issues.apache.org/jira/rest/api/2/issue/13630231", "key": "KAFKA-19743", "fields": {"summary": "[DISCUSS] Exploring Compile-time AST Generation as an Alternative Approach for Kafka Protocol Classes", "description": "h2. 1. Background & Motivation\r\n\r\nCurrently, Kafka uses a JSON template-based pre-generation approach to create protocol classes under\u00a0{{{}org.apache.kafka.common.message{}}}. This solution is mature, stable, and provides excellent multi-language support.\r\n\r\nHowever, I've been considering whether we could provide an alternative\u00a0*compile-time code generation*\u00a0approach for the Java ecosystem, similar to the AST modification technology used by Lombok. This approach might offer better development experience in certain scenarios.\r\nh2. 2. Proposal Overview\r\n\r\n{*}Core Idea{*}: Use annotation processors to directly modify the AST during compilation, dynamically generating complete implementations of protocol classes instead of pre-generating Java source files.\r\n\r\n{*}Example Implementation Concept{*}:\r\n{code:java}\r\n@KafkaMessage(apiKey = 1, version = \"0.1.0\")\r\npublic class FetchRequestSpec {\r\n    @ProtocolField(type = \"string\", order = 1)\r\n    private String groupId;\r\n    \r\n    @ProtocolField(type = \"int16\", order = 2) \r\n    private short acks;\r\n    \r\n    // More fields...\r\n}{code}\r\n\u00a0\r\nh2. 3. Comparative Analysis\r\n||Aspect||Current Template Approach||Compile-time AST Approach||Hybrid Possibility||\r\n|*Development Experience*|Requires viewing generated source files|Cleaner source code, Lombok-like|AST during development, pre-gen for release|\r\n|*Build Process*|Explicit pre-generation step|Integrated into standard compilation|Configurable generation strategy|\r\n|*Debugging Support*|\u2705 Full source-level debugging|\u26a0\ufe0f Requires IDE plugin support|Source output on demand|\r\n|*Multi-language Support*|\u2705 Single definition, multiple outputs|\u274c Java-only|Preserve existing multi-language capabilities|\r\n|*Performance Impact*|One-time generation at build time|Regeneration on each compilation|Smart caching mechanism|\r\nh2. 4. Potential Value\r\n * {*}Faster Development Iteration{*}: Immediate compilation after protocol definition changes, no pre-generation step required\r\n\r\n * {*}Source Code Cleanliness{*}: Avoid polluting codebase with\u5927\u91cf generated boilerplate code\r\n\r\n * {*}Type Safety{*}: Stricter protocol constraint checking at compile time\r\n\r\n * {*}Alignment with Modern Java Patterns{*}: Similar to Quarkus, Micronaut's compile-time processing philosophy\r\n\r\nh2. 5. Feasibility Considerations\r\n\r\nI understand the potential challenges this approach might face:\r\n * Compatibility with existing multi-language ecosystem\r\n\r\n * Ensuring debugging experience\r\n\r\n * Increased build system complexity\r\n\r\n * Community learning curve\r\n\r\nTherefore, I suggest we could:\r\n # {*}Offer as Optional Approach{*}: Doesn't disrupt existing workflow, serves as alternative during development\r\n\r\n # {*}Incremental Implementation{*}: Start with small scope or new modules for experimentation\r\n\r\n # {*}Toolchain Support{*}: Provide source output mode to ensure debugging capability\r\n\r\nh2. 6. Next Steps & Recommendations\r\n\r\nIf the community finds this direction interesting, I'm willing to:\r\n * Create a Proof of Concept (POC) implementation to demonstrate concrete results\r\n\r\n * Participate in relevant discussions and design work\r\n\r\n * Assist with performance benchmarking and compatibility validation\r\n\r\n\u00a0\r\n\r\nThank you for taking the time to review this proposal. I look forward to further discussing this idea with the community, and whether it is ultimately adopted or not, I appreciate the opportunity to share my thoughts with the community.", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=yingquanhe", "name": "yingquanhe", "key": "JIRAUSER311081", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34048", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34048", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34048", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34048"}, "displayName": "Yingquan He", "active": true, "timeZone": "Asia/Shanghai"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/5", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/trivial.svg", "name": "Trivial", "id": "5"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}