{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13631913", "self": "https://issues.apache.org/jira/rest/api/2/issue/13631913", "key": "KAFKA-19810", "fields": {"summary": "Kafka streams with chained emitStrategy(onWindowClose) example does not work", "description": "Hi, I got this example by using the following prompt in Google:\r\n # kafka streams unit testing with chained \"emitStrategy\"\r\n # Provide an example of testing chained suppress with different grace periods\r\n\r\n[https://gist.github.com/gregfichtenholtz-illumio/81fb537e24f7187e9de37686bb8eca7d]\r\n\r\nCompiled and ran the example using latest kafka jars only to get\r\n\r\n[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 1.103 s <<< FAILURE! -- in com.k8sflowprocessor.ChainedEmitStrategyTopologyTest\r\n[ERROR] com.foo.bar.ChainedEmitStrategyTopologyTest.testChainedWindowedAggregationsWithDifferentGracePeriods -- Time elapsed: 1.096 s <<< FAILURE!\r\norg.opentest4j.AssertionFailedError: Final output should contain one result ==> expected: <1> but was: <0>\r\nat org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureBuilder.java:158)\r\nat org.junit.jupiter.api.AssertionFailureBuilder.buildAndThrow(AssertionFailureBuilder.java:139)\r\nat org.junit.jupiter.api.AssertEquals.failNotEqual(AssertEquals.java:201)\r\nat org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:168)\r\nat org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:694)\r\nat com.foo.bar.ChainedEmitStrategyTopologyTest.testChainedWindowedAggregationsWithDifferentGracePeriods(ChainedEmitStrategyTopologyTest.java:123)\r\n\r\nIt appears that the test is not able to drive the kafka stream to emit the 2nd event.\r\nCould be a bug in test code/test driver/kafka streams?\r\nThanks in advance\r\nGreg\r\n\u00a0", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=bayareagreg", "name": "bayareagreg", "key": "JIRAUSER311223", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg F", "active": true, "timeZone": "America/Los_Angeles"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13631913/comment/18031272", "id": "18031272", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mjsax", "name": "mjsax", "key": "mjsax", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=mjsax&avatarId=29314", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mjsax&avatarId=29314", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mjsax&avatarId=29314", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mjsax&avatarId=29314"}, "displayName": "Matthias J. Sax", "active": true, "timeZone": "America/Los_Angeles"}, "body": "The record you use to close the \"second window\" (ie, `inputTopic.pipeInput(\"D\", \"value6\", secondWindowCloseTime);`) will be processed by the first window, and will get \"stuck there\". It does open a new 1-minute window [10:07; 10:08) which is still open, and thus no result is emitted. Hence, the time for the second windowed-aggregation does not advance to `10:07` and it's own window [10:00; 10:05) does not close yet.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mjsax", "name": "mjsax", "key": "mjsax", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=mjsax&avatarId=29314", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mjsax&avatarId=29314", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mjsax&avatarId=29314", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mjsax&avatarId=29314"}, "displayName": "Matthias J. Sax", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-10-20T23:25:27.708+0000", "updated": "2025-10-20T23:26:15.023+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631913/comment/18031304", "id": "18031304", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=bayareagreg", "name": "bayareagreg", "key": "JIRAUSER311223", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg F", "active": true, "timeZone": "America/Los_Angeles"}, "body": "Thanks. is this a bug or a feature?\r\nI don't want several 1-minute windows for this test\r\nHow do I fix the test so the end result (finalOutputTopic) contains a single aggregated value?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=bayareagreg", "name": "bayareagreg", "key": "JIRAUSER311223", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg F", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-10-21T01:13:43.603+0000", "updated": "2025-10-21T01:13:43.603+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631913/comment/18031305", "id": "18031305", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mjsax", "name": "mjsax", "key": "mjsax", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=mjsax&avatarId=29314", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mjsax&avatarId=29314", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mjsax&avatarId=29314", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mjsax&avatarId=29314"}, "displayName": "Matthias J. Sax", "active": true, "timeZone": "America/Los_Angeles"}, "body": "It's not a bug, but behavior by design.\r\n\r\nFor this particular test, you would need to send one more even, with ts => 10:08:30, to close the [10:07; 10:08) window; when this window gets closed the result goes into the second window operator, advancing the time there accordingly emitting the result of window [10:00; 10:05)", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mjsax", "name": "mjsax", "key": "mjsax", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=mjsax&avatarId=29314", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mjsax&avatarId=29314", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mjsax&avatarId=29314", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mjsax&avatarId=29314"}, "displayName": "Matthias J. Sax", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-10-21T01:29:02.483+0000", "updated": "2025-10-21T01:29:02.483+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631913/comment/18032319", "id": "18032319", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=bayareagreg", "name": "bayareagreg", "key": "JIRAUSER311223", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg F", "active": true, "timeZone": "America/Los_Angeles"}, "body": "Hi you may close this issue as you wish. I have another one that I am about to open, hope to get your help with it.\r\nhttps://issues.apache.org/jira/browse/KAFKA-19828\r\n\r\nThanks", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=bayareagreg", "name": "bayareagreg", "key": "JIRAUSER311223", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Greg F", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-10-23T00:50:25.923+0000", "updated": "2025-10-23T19:40:42.450+0000"}], "maxResults": 4, "total": 4, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}}}