{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13626985", "self": "https://issues.apache.org/jira/rest/api/2/issue/13626985", "key": "KAFKA-19633", "fields": {"summary": "Kafka Connect connectors sent out zombie records during rebalance", "description": "Hi, we run Debezium connectors on Kafka Connect. We identified several \"zombie\" records that are delivered by the connectors during or after the rebalance. Since the downstream consumers require ordering, this issue breaks several things where previous primitives were build upon.\r\n\r\nHere are an overview of the setup:\r\n * Connector type: Debezium Mongo Connector\r\n * Kafka Connect version: 3.2\r\n * Number of workers: 3-4\r\n * Kafka producer configs: at-least once settings, ack=all, max inflight requests=1\r\n\r\nThe following conclusion are based on our investigation:\r\n{quote}When a Kafka Connect worker (part of a connector cluster) is overloaded or degraded, the connector on it may become temporarily unhealthy. The Kafka Connect cluster will rebalance the connector by \"moving\" it to another worker. When the connector is started on the new worker, the events will resume normally without any data loss and depending on the previously committed offsets, there might be a small amount of duplicate events due to replay but eventually the total ordering is still guaranteed.\u00a0\r\n\r\nHowever, the producer of the old worker may not have been gracefully shut down. When the old worker recovered, some old events that were already placed in the producer's internal queue got sent out to Kafka before the producer was forcefully closed. This caused the \"out-of-band\" duplicate events, which we referred to as \"ghost duplicates\" or \"zombie records.\r\n{quote}\r\nCan you verify our conclusion and do you have any recommendation for the potential fix or prevention?", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=shichao.an", "name": "shichao.an", "key": "shichao.an", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Shichao An", "active": true, "timeZone": "America/Los_Angeles"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/2", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg", "name": "Critical", "id": "2"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}