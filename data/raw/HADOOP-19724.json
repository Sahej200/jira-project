{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13631320", "self": "https://issues.apache.org/jira/rest/api/2/issue/13631320", "key": "HADOOP-19724", "fields": {"summary": "[RISC-V]  Add rv bulk CRC32 (non-CRC32C) optimized path", "description": null, "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=peterptroc", "name": "peterptroc", "key": "JIRAUSER310593", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "Ptroc", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13631320/comment/18029546", "id": "18029546", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "PeterPtroc opened a new pull request, #8031:\nURL: https://github.com/apache/hadoop/pull/8031\n\n   <!--\r\n     Thanks for sending a pull request!\r\n       1. If this is your first time, please read our contributor guidelines: https://cwiki.apache.org/confluence/display/HADOOP/How+To+Contribute\r\n       2. Make sure your PR title starts with JIRA issue id, e.g., 'HADOOP-17799. Your PR title ...'.\r\n   -->\r\n   \r\n   ### Description of PR\r\n   - Introduces a riscv64 native implementation path for CRC32 (CRC32C not optimized).\r\n   - Adds runtime CPU feature detection on linux-riscv64 to enable hardware-accelerated CRC32 when available; falls back to the existing implementation if native is unavailable or disabled.\r\n   \r\n   Below are the performance changes observed using the built-in CRC32 benchmark. Although performance is poor when bpc <= 64, there are substantial improvements when bpc > 64. To keep the codebase simple and maintainable, I did not add bpc-size-specific handling.\r\n   \r\n   | bpc | #T | Native (origin) | Native (new) | \u0394 (MB/s) | \u0394% |\r\n   |---:|---:|---:|---:|---:|---:|\r\n   | 32 | 1 | 661.5 | 463.5 | -198.0 | -29.9% |\r\n   | 32 | 2 | 642.6 | 491.4 | -151.2 | -23.5% |\r\n   | 32 | 4 | 663.7 | 480.5 | -183.2 | -27.6% |\r\n   | 32 | 8 | 653.0 | 472.0 | -181.0 | -27.7% |\r\n   | 32 | 16 | 656.1 | 473.4 | -182.7 | -27.8% |\r\n   | 64 | 1 | 793.9 | 318.0 | -475.9 | -59.9% |\r\n   | 64 | 2 | 771.3 | 322.1 | -449.2 | -58.2% |\r\n   | 64 | 4 | 787.3 | 315.0 | -472.3 | -60.0% |\r\n   | 64 | 8 | 778.0 | 309.3 | -468.7 | -60.2% |\r\n   | 64 | 16 | 773.5 | 308.1 | -465.4 | -60.2% |\r\n   | 128 | 1 | 878.8 | 2398.8 | +1520.0 | +173.0% |\r\n   | 128 | 2 | 846.8 | 1723.9 | +877.1 | +103.6% |\r\n   | 128 | 4 | 861.2 | 1690.0 | +828.8 | +96.2% |\r\n   | 128 | 8 | 857.8 | 1373.3 | +515.5 | +60.1% |\r\n   | 128 | 16 | 853.8 | 1361.3 | +507.5 | +59.4% |\r\n   | 256 | 1 | 783.9 | 2752.5 | +1968.6 | +251.1% |\r\n   | 256 | 2 | 810.0 | 2053.3 | +1243.3 | +153.5% |\r\n   | 256 | 4 | 835.2 | 1966.5 | +1131.3 | +135.5% |\r\n   | 256 | 8 | 812.4 | 1756.3 | +943.9 | +116.2% |\r\n   | 256 | 16 | 811.8 | 1524.7 | +712.9 | +87.8% |\r\n   | 512 | 1 | 923.6 | 3328.9 | +2405.3 | +260.4% |\r\n   | 512 | 2 | 886.5 | 3295.1 | +2408.6 | +271.7% |\r\n   | 512 | 4 | 910.5 | 2359.9 | +1449.4 | +159.2% |\r\n   | 512 | 8 | 888.1 | 1637.4 | +749.3 | +84.4% |\r\n   | 512 | 16 | 897.0 | 1840.1 | +943.1 | +105.1% |\r\n   | 1024 | 1 | 950.4 | 3045.0 | +2094.6 | +220.4% |\r\n   | 1024 | 2 | 918.0 | 2202.9 | +1284.9 | +140.0% |\r\n   | 1024 | 4 | 937.6 | 2040.4 | +1102.8 | +117.6% |\r\n   | 1024 | 8 | 916.5 | 1961.5 | +1045.0 | +114.0% |\r\n   | 1024 | 16 | 927.4 | 2003.9 | +1076.5 | +116.1% |\r\n   | 2048 | 1 | 962.3 | 3189.1 | +2226.8 | +231.4% |\r\n   | 2048 | 2 | 970.1 | 3192.3 | +2222.2 | +229.1% |\r\n   | 2048 | 4 | 943.4 | 2411.2 | +1467.8 | +155.6% |\r\n   | 2048 | 8 | 937.6 | 1837.7 | +900.1 | +96.0% |\r\n   | 2048 | 16 | 933.1 | 1864.0 | +930.9 | +99.8% |\r\n   | 4096 | 1 | 969.9 | 3654.5 | +2684.6 | +276.8% |\r\n   | 4096 | 2 | 972.0 | 2798.0 | +1826.0 | +187.9% |\r\n   | 4096 | 4 | 960.1 | 2307.0 | +1346.9 | +140.3% |\r\n   | 4096 | 8 | 948.2 | 2753.1 | +1804.9 | +190.4% |\r\n   | 4096 | 16 | 938.7 | 2170.5 | +1231.8 | +131.2% |\r\n   | 8192 | 1 | 973.6 | 4008.1 | +3034.5 | +311.7% |\r\n   | 8192 | 2 | 922.5 | 3018.2 | +2095.7 | +227.2% |\r\n   | 8192 | 4 | 955.6 | 2968.7 | +2013.1 | +210.7% |\r\n   | 8192 | 8 | 943.4 | 2077.9 | +1134.5 | +120.3% |\r\n   | 8192 | 16 | 944.9 | 2191.7 | +1246.8 | +132.0% |\r\n   | 16384 | 1 | 974.4 | 4090.3 | +3115.9 | +319.8% |\r\n   | 16384 | 2 | 978.3 | 2999.6 | +2021.3 | +206.6% |\r\n   | 16384 | 4 | 956.6 | 3248.9 | +2292.3 | +239.6% |\r\n   | 16384 | 8 | 950.8 | 3228.0 | +2277.2 | +239.5% |\r\n   | 16384 | 16 | 941.2 | 2832.1 | +1890.9 | +200.9% |\r\n   | 32768 | 1 | 972.2 | 4205.7 | +3233.5 | +332.6% |\r\n   | 32768 | 2 | 938.6 | 4115.2 | +3176.6 | +338.4% |\r\n   | 32768 | 4 | 957.4 | 2508.9 | +1551.5 | +162.1% |\r\n   | 32768 | 8 | 952.8 | 2319.8 | +1367.0 | +143.5% |\r\n   | 32768 | 16 | 944.5 | 1657.7 | +713.2 | +75.5% |\r\n   | 65536 | 1 | 976.3 | 4226.6 | +3250.3 | +332.9% |\r\n   | 65536 | 2 | 940.0 | 3075.8 | +2135.8 | +227.2% |\r\n   | 65536 | 4 | 958.5 | 1345.2 | +386.7 | +40.3% |\r\n   | 65536 | 8 | 950.2 | 1954.7 | +1004.5 | +105.7% |\r\n   | 65536 | 16 | 945.8 | 2414.0 | +1468.2 | +155.2% |\r\n   \r\n   ### How was this patch tested?\r\n   \r\n   Built hadoop-common with native profile on riscv64; verified it's function by TestNativeCrc32.\r\n   Ran Hadoop\u2019s CRC32 benchmark on riscv64 (OpenEuler/EulixOS) with JDK 17.\r\n   Here is the commands and results:\r\n   \r\n   Command\uff1a \r\n   \r\n   ```\r\n   mvn -Pnative \\\r\n     -Dtest=org.apache.hadoop.util.TestNativeCrc32 \\\r\n     -Djava.library.path=\"$HADOOP_COMMON_LIB_NATIVE_DIR\" \\\r\n     test\r\n   ```\r\n   \r\n   Results\r\n   \r\n   ```\r\n   [INFO] -------------------------------------------------------\r\n   [INFO]  T E S T S\r\n   [INFO] -------------------------------------------------------\r\n   [INFO] Running org.apache.hadoop.util.TestNativeCrc32\r\n   [INFO] Tests run: 22, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.017 s ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-13T15:57:36.992+0000", "updated": "2025-10-13T15:57:36.992+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631320/comment/18029601", "id": "18029601", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "hadoop-yetus commented on PR #8031:\nURL: https://github.com/apache/hadoop/pull/8031#issuecomment-3398778305\n\n   :broken_heart: **-1 overall**\r\n   \r\n   \r\n   \r\n   \r\n   \r\n   \r\n   | Vote | Subsystem | Runtime |  Logfile | Comment |\r\n   |:----:|----------:|--------:|:--------:|:-------:|\r\n   | +0 :ok: |  reexec  |  23m 29s |  |  Docker mode activated.  |\r\n   |||| _ Prechecks _ |\r\n   | +1 :green_heart: |  dupname  |   0m  0s |  |  No case conflicting files found.  |\r\n   | +0 :ok: |  codespell  |   0m  1s |  |  codespell was not available.  |\r\n   | +0 :ok: |  detsecrets  |   0m  1s |  |  detect-secrets was not available.  |\r\n   | +1 :green_heart: |  @author  |   0m  0s |  |  The patch does not contain any @author tags.  |\r\n   | -1 :x: |  test4tests  |   0m  0s |  |  The patch doesn't appear to include any new or modified tests. Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch.  |\r\n   |||| _ trunk Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |  47m 25s |  |  trunk passed  |\r\n   | +1 :green_heart: |  compile  |  14m 16s |  |  trunk passed  |\r\n   | +1 :green_heart: |  mvnsite  |   2m 32s |  |  trunk passed  |\r\n   | +1 :green_heart: |  shadedclient  | 101m 41s |  |  branch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Patch Compile Tests _ |\r\n   | +1 :green_heart: |  mvninstall  |   1m 10s |  |  the patch passed  |\r\n   | +1 :green_heart: |  compile  |  13m 15s |  |  the patch passed  |\r\n   | +1 :green_heart: |  cc  |  13m 15s |  |  the patch passed  |\r\n   | +1 :green_heart: |  golang  |  13m 15s |  |  the patch passed  |\r\n   | +1 :green_heart: |  javac  |  13m 15s |  |  the patch passed  |\r\n   | +1 :green_heart: |  blanks  |   0m  0s |  |  The patch has no blanks issues.  |\r\n   | +1 :green_heart: |  mvnsite  |   2m 29s |  |  the patch passed  |\r\n   | +1 :green_heart: |  shadedclient  |  39m 47s |  |  patch has no errors when building and testing our client artifacts.  |\r\n   |||| _ Other Tests _ |\r\n   | +1 :green_heart: |  unit  |  23m 25s |  |  hadoop-common in the patch passed.  |\r\n   | +1 :green_heart: |  asflicense  |   1m 57s |  |  The patch does not generate ASF License warnings.  |\r\n   |  |   | 206m 55s |  |  |\r\n   \r\n   \r\n   | Subsystem | Report/Notes |\r\n   |----------:|:-------------|\r\n   | Docker | ClientAPI=1.51 ServerAPI=1.51 base: https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-8031/1/artifact/out/Dockerfile |\r\n   | GITHUB PR | https://github.com/apache/hadoop/pull/8031 |\r\n   | Optional Tests | dupname asflicense compile cc mvnsite javac unit codespell detsecrets golang |\r\n   | uname | Linux cf2b3cead534 5.15.0-156-generic #166-Ubuntu SMP Sat Aug 9 00:02:46 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux |\r\n   | Build tool | maven |\r\n   | Personality | dev-support/bin/hadoop.sh |\r\n   | git revision | trunk / 0e62b049f710f680823489b1a77892ed49252fc4 |\r\n   | Default Java | Red Hat, Inc.-1.8.0_462-b08 |\r\n   |  Test Results | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-8031/1/testReport/ |\r\n   | Max. process+thread count | 1376 (vs. ulimit of 5500) |\r\n   | modules | C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common |\r\n   | Console output | https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-8031/1/console |\r\n   | versions | git=2.43.7 maven=3.9.11 |\r\n   | Powered by | Apache Yetus 0.14.0 https://yetus.apache.org |\r\n   \r\n   \r\n   This message was automatically generated.\r\n   \r\n   \n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-13T19:25:51.530+0000", "updated": "2025-10-13T19:25:51.530+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631320/comment/18029760", "id": "18029760", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "body": "PeterPtroc commented on PR #8031:\nURL: https://github.com/apache/hadoop/pull/8031#issuecomment-3401469367\n\n   @steveloughran could you please review this PR if you have time? thanks!\n\n\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-14T12:08:33.735+0000", "updated": "2025-10-14T12:08:33.735+0000"}], "maxResults": 3, "total": 3, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}