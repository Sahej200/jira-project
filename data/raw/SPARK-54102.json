{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13632935", "self": "https://issues.apache.org/jira/rest/api/2/issue/13632935", "key": "SPARK-54102", "fields": {"summary": "Spark 4.0.1 still throws \"String length (20054016) exceeds the maximum length (20000000)\" and \"from_json\" fails on a very large JSON with a jackson_core parse error", "description": "Based on JIRA *SPARK-49872* and the implementation in [{{JsonProtocol.scala}}|https://github.com/apache/spark/blob/29434ea766b0fc3c3bf6eaadb43a8f931133649e/core/src/main/scala/org/apache/spark/util/JsonProtocol.scala#L71], the relevant limit was removed in {*}4.0.1{*}. However, in our environment we can still reliably reproduce:\r\n # When generating/processing a very large string:\r\n\r\n{code:java}\r\nCaused by: com.fasterxml.jackson.core.exc.StreamConstraintsException: String value length (20040525) exceeds the maximum allowed (20000000, from `StreamReadConstraints.getMaxStringLength()`){code}\r\n # When using {{from_json}} on a _valid_ very large single-line JSON (no missing comma), Jackson throws at around column {*}20,271,838{*}:\r\n\r\n{code:java}\r\nCaused by: com.fasterxml.jackson.core.JsonParseException: Unexpected character ('1' (code 49)): was expecting comma to separate Object entries\r\n at [Source: UNKNOWN; line: 1, column: 20271838]{code}\r\nI'm sure this is not a formatting issue. If I truncate the JSON to below column {*}20,271,838{*}, it parses successfully.\r\nHere is my parsing code:\r\n\r\n{code:java}\r\nraw_df.withColumn(\"parsed_item\", f.from_json(f.col(\"item\"), my_schema){code}", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=yyuan", "name": "yyuan", "key": "JIRAUSER311355", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER311355&avatarId=54568", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER311355&avatarId=54568", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER311355&avatarId=54568", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER311355&avatarId=54568"}, "displayName": "Yuan Yuan", "active": true, "timeZone": "Etc/UTC"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}