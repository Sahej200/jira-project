{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13626994", "self": "https://issues.apache.org/jira/rest/api/2/issue/13626994", "key": "KAFKA-19634", "fields": {"summary": "document the encoding of nullable struct", "description": "In [https://kafka.apache.org/protocol#protocol_types,] we didn't specify the encoding of a struct. In particular, how a nullable struct is represented. We should document that if a struct is nullable, the first byte indicates whether is null and the rest of the bytes are the serialization of each field.", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=junrao", "name": "junrao", "key": "junrao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Jun Rao", "active": true, "timeZone": "America/Los_Angeles"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13626994/comment/18015548", "id": "18015548", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi [~junrao], if you are not working on this, may i take it over, thanks.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-22T00:27:18.343+0000", "updated": "2025-08-22T00:27:18.343+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13626994/comment/18015697", "id": "18015697", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=junrao", "name": "junrao", "key": "junrao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Jun Rao", "active": true, "timeZone": "America/Los_Angeles"}, "body": "[~isding_l] : Thanks for your interest. Feel free to take it.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=junrao", "name": "junrao", "key": "junrao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Jun Rao", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-08-22T16:42:36.564+0000", "updated": "2025-08-22T16:42:36.564+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13626994/comment/18023204", "id": "18023204", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=junrao", "name": "junrao", "key": "junrao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Jun Rao", "active": true, "timeZone": "America/Los_Angeles"}, "body": "[~isding_l]: Any progress on this? Thanks.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=junrao", "name": "junrao", "key": "junrao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Jun Rao", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-09-26T21:48:07.306+0000", "updated": "2025-09-26T21:48:07.306+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13626994/comment/18023205", "id": "18023205", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi [~junrao],\u00a0\r\n\r\nI apologize, this slipped through the cracks. Thanks for the ping.\r\n\r\nI'll handle this within the next three days. Appreciate your patience.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-26T22:00:07.993+0000", "updated": "2025-09-26T22:00:07.993+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13626994/comment/18023382", "id": "18023382", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi [~junrao],\r\nI have a question regarding the nullability of Struct. Under what circumstances could a Struct potentially be null?\r\nLooking at the current implementation, a Struct holds a reference to a Schema, and the Schema's isNullable() method returns false by default. This suggests that Struct should not be nullable at all from a design perspective.\r\nWhat confuses me is how this aligns with handling nullable structs at the protocol level, especially when compared to other nullable types like NullableString where null handling is embedded within the type definition itself.\r\nCould you help clarify if I'm missing something here? Looking forward to your insights.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-28T08:12:38.885+0000", "updated": "2025-09-28T08:12:38.885+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13626994/comment/18023595", "id": "18023595", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=junrao", "name": "junrao", "key": "junrao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Jun Rao", "active": true, "timeZone": "America/Los_Angeles"}, "body": "[~isding_l]:  Here is an example. ConsumerGroupHeartbeatResponse has a field Assignment, which is a nullable struct.\r\n\r\n{code:java}\r\n    { \"name\": \"Assignment\", \"type\": \"Assignment\", \"versions\": \"0+\", \"nullableVersions\": \"0+\", \"default\": \"null\",\r\n      \"about\": \"null if not provided; the assignment otherwise.\", \"fields\": [\r\n      { \"name\": \"TopicPartitions\", \"type\": \"[]TopicPartitions\", \"versions\": \"0+\",\r\n        \"about\": \"The partitions assigned to the member that can be used immediately.\" }\r\n    ]}\r\n{code}\r\n\r\nThe generated class ConsumerGroupHeartbeatResponseData has the following code for serialization related to a null value.\r\n\r\n{code:java}\r\n        if (assignment == null) {\r\n            _writable.writeByte((byte) -1);\r\n        } else {\r\n            _writable.writeByte((byte) 1);\r\n            assignment.write(_writable, _cache, _version);\r\n        }\r\n{code}\r\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=junrao", "name": "junrao", "key": "junrao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Jun Rao", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-09-29T17:48:17.309+0000", "updated": "2025-09-29T17:48:17.309+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13626994/comment/18023711", "id": "18023711", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "body": "Thanks for the helpful details!\r\n\r\nI've opened a PR with the nullable struct documentation. [KAFKA-19634|https://github.com/apache/kafka/pull/20614]\r\n\r\nPTAL when you get a chance, thanks in advince.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=isding_l", "name": "isding_l", "key": "JIRAUSER301111", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Lan Ding", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-09-30T01:09:11.236+0000", "updated": "2025-09-30T01:09:11.236+0000"}], "maxResults": 7, "total": 7, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}