{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13633078", "self": "https://issues.apache.org/jira/rest/api/2/issue/13633078", "key": "SPARK-54129", "fields": {"summary": "Extract dropping table from catalog from DataFrameWriter in case of overwriting table during creation", "description": "Currently, if we call DataFrameWriter.saveAsTable(tableName) with the SaveMode equal to Overwrite and the DataSource is V1, the table is dropped from catalog directly in the DataFrameWriter and only then the CreateTable command is created.\u00a0\r\n\r\nIn case if we want to somehow change the default behavior using Spark extensions, for instance, postpone the table dropping to decrease the time interval, when the old table is dropped and the new one is not created, such hardcoded behavior in DataFrameWriter makes it almost impossible if we want to use the original saveAsTable method. \r\n\r\nFor instance, if we call df.write.mode(\"overwrite\").insertInto(table_name) then it's possible to control the table removal logic if we provide our own implementation of the spark.sql.sources.commitProtocolClass. In case of saveAsTable it makes no sense, because a table is unconditionally dropped before handling the CreateTable command.\r\n\r\nTherefore, is it possible to extract the table dropping logic from DataFrameWriter to the corresponding LogicalPlan commands (as it was done for V2 Datasources) in order to give more flexibility to Spark extensions?", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=vivacell", "name": "vivacell", "key": "JIRAUSER296530", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER296530&avatarId=51850", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER296530&avatarId=51850", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER296530&avatarId=51850", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER296530&avatarId=51850"}, "displayName": "Tigran Manasyan", "active": true, "timeZone": "Asia/Tbilisi"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}