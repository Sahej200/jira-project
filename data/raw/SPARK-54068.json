{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13632708", "self": "https://issues.apache.org/jira/rest/api/2/issue/13632708", "key": "SPARK-54068", "fields": {"summary": "Fix `pyspark.pandas.tests.connect.io.test_parity_feather.FeatherParityTests.test_to_feather` in Python 3.14", "description": "{code}\r\n======================================================================\r\nERROR [1.960s]: test_to_feather (pyspark.pandas.tests.connect.io.test_parity_feather.FeatherParityTests.test_to_feather)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/__w/spark/spark/python/pyspark/pandas/tests/io/test_feather.py\", line 43, in test_to_feather\r\n    self.psdf.to_feather(path2)\r\n    ~~~~~~~~~~~~~~~~~~~~^^^^^^^\r\n  File \"/__w/spark/spark/python/pyspark/pandas/frame.py\", line 2702, in to_feather\r\n    return validate_arguments_and_invoke_function(\r\n        self._to_internal_pandas(), self.to_feather, pd.DataFrame.to_feather, args\r\n    )\r\n  File \"/__w/spark/spark/python/pyspark/pandas/utils.py\", line 592, in validate_arguments_and_invoke_function\r\n    return pandas_func(**args)\r\n  File \"/usr/local/lib/python3.14/dist-packages/pandas/core/frame.py\", line 2949, in to_feather\r\n    to_feather(self, path, **kwargs)\r\n    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.14/dist-packages/pandas/io/feather_format.py\", line 65, in to_feather\r\n    feather.write_feather(df, handles.handle, **kwargs)\r\n    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.14/dist-packages/pyarrow/feather.py\", line 156, in write_feather\r\n    table = Table.from_pandas(df, preserve_index=preserve_index)\r\n  File \"pyarrow/table.pxi\", line 4795, in pyarrow.lib.Table.from_pandas\r\n  File \"/usr/local/lib/python3.14/dist-packages/pyarrow/pandas_compat.py\", line 663, in dataframe_to_arrays\r\n    pandas_metadata = construct_metadata(\r\n        columns_to_convert, df, column_names, index_columns, index_descriptors,\r\n        preserve_index, types, column_field_names=column_field_names\r\n    )\r\n  File \"/usr/local/lib/python3.14/dist-packages/pyarrow/pandas_compat.py\", line 281, in construct_metadata\r\n    b'pandas': json.dumps({\r\n               ~~~~~~~~~~^^\r\n        'index_columns': index_descriptors,\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    ...<7 lines>...\r\n        'pandas_version': _pandas_api.version\r\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    }).encode('utf8')\r\n    ^^\r\n  File \"/usr/lib/python3.14/json/__init__.py\", line 231, in dumps\r\n    return _default_encoder.encode(obj)\r\n           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^\r\n  File \"/usr/lib/python3.14/json/encoder.py\", line 200, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"/usr/lib/python3.14/json/encoder.py\", line 261, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"/usr/lib/python3.14/json/encoder.py\", line 180, in default\r\n    raise TypeError(f'Object of type {o.__class__.__name__} '\r\n                    f'is not JSON serializable')\r\nTypeError: Object of type PlanMetrics is not JSON serializable\r\nwhen serializing list item 0\r\nwhen serializing dict item 'metrics'\r\nwhen serializing dict item 'attributes'\r\n{code}", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dongjoon", "name": "dongjoon", "key": "dongjoon", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dongjoon&avatarId=42503", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dongjoon&avatarId=42503", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dongjoon&avatarId=42503", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dongjoon&avatarId=42503"}, "displayName": "Dongjoon Hyun", "active": true, "timeZone": "America/Los_Angeles"}, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}