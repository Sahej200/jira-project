{"expand": "renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations", "id": "13628601", "self": "https://issues.apache.org/jira/rest/api/2/issue/13628601", "key": "KAFKA-19696", "fields": {"summary": "Re-enable SmokeTestDriverIntegrationTest for processing threads", "description": "The test fails occasionally with a race condition like this:\r\n{code:java}\r\n 2_0 RUNNING StreamTask(active): org.apache.kafka.streams.errors.StreamsException: java.util.ConcurrentModificationExceptionorg.apache.kafka.streams.errors.StreamsException: java.util.ConcurrentModificationException at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:977) at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:894)Caused by: java.util.ConcurrentModificationException at java.base/java.util.HashMap$HashIterator.nextNode(HashMap.java:1597) at java.base/java.util.HashMap$KeyIterator.next(HashMap.java:1620) at org.apache.kafka.clients.consumer.internals.ClassicKafkaConsumer.resume(ClassicKafkaConsumer.java:979) at org.apache.kafka.clients.consumer.KafkaConsumer.resume(KafkaConsumer.java:1509) at org.apache.kafka.streams.processor.internals.StreamTask.resumePollingForPartitionsWithAvailableSpace(StreamTask.java:623) at org.apache.kafka.streams.processor.internals.TaskManager.resumePollingForPartitionsWithAvailableSpace(TaskManager.java:1866) at org.apache.kafka.streams.processor.internals.StreamThread.runOnceWithProcessingThreads(StreamThread.java:1355) at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:932) {code}\r\nh4. *Since the feature is not actively developed by anybody, we disable this test. This ticket is to re-enable the test when the race condition is fixed.*\r\n\r\n\u00a0", "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lucasbru", "name": "lucasbru", "key": "JIRAUSER302322", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER302322&avatarId=53242", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER302322&avatarId=53242", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER302322&avatarId=53242", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER302322&avatarId=53242"}, "displayName": "Lucas Brutschy", "active": true, "timeZone": "Europe/Berlin"}, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13628601/comment/18020379", "id": "18020379", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "body": "Hi, I would like to work on this issue. Could you please assign it to me?\r\nThanks!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2025-09-15T14:41:53.655+0000", "updated": "2025-09-15T14:41:53.655+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13628601/comment/18020519", "id": "18020519", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mjsax", "name": "mjsax", "key": "mjsax", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=mjsax&avatarId=29314", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mjsax&avatarId=29314", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mjsax&avatarId=29314", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mjsax&avatarId=29314"}, "displayName": "Matthias J. Sax", "active": true, "timeZone": "America/Los_Angeles"}, "body": "\"Processing threads\" are a WIP feature, but nobody is currently working on it. \u2013 This ticket cannot be worked on right now. We would first need to complete \"processing thread\" feature, to ensure it's working correctly to avoid that this test hits this bug of the incomplete \"processing threads\" feature.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=mjsax", "name": "mjsax", "key": "mjsax", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=mjsax&avatarId=29314", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mjsax&avatarId=29314", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mjsax&avatarId=29314", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mjsax&avatarId=29314"}, "displayName": "Matthias J. Sax", "active": true, "timeZone": "America/Los_Angeles"}, "created": "2025-09-16T00:22:34.234+0000", "updated": "2025-09-16T00:22:34.234+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13628601/comment/18020549", "id": "18020549", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "body": "Hi,\u00a0\r\n\r\nI'm currently reviewing the code related to `org.apache.kafka.clients.consumer.KafkaConsumer#resume`. \u00a0\r\nCould you please let me know which Kafka versions are affected by this issue? \u00a0\r\n\r\nThanks!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2025-09-16T05:59:19.475+0000", "updated": "2025-09-16T05:59:19.475+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13628601/comment/18020551", "id": "18020551", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "body": "Also, I have one more question: \u00a0\r\nDo we plan to only fix this bug, or is it acceptable to also improve the logic in `StreamThread` while working on it? \u00a0\r\nJust want to make sure I follow the right scope. \u00a0\r\n\r\nThanks!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2025-09-16T06:14:03.789+0000", "updated": "2025-09-16T06:14:03.789+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13628601/comment/18020571", "id": "18020571", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lucasbru", "name": "lucasbru", "key": "JIRAUSER302322", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER302322&avatarId=53242", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER302322&avatarId=53242", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER302322&avatarId=53242", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER302322&avatarId=53242"}, "displayName": "Lucas Brutschy", "active": true, "timeZone": "Europe/Berlin"}, "body": "Not sure what you mean by improving the logic. The point would be to properly root cause the issue and find the right place to fix it. Probably, one of the concurrent access to the data structures that need to be moved from the processing thread to the polling thread, or the other way around. Likely, we don't want to just add a lock here. This is not trivial, and I am not sure right now somebody will have time to review such a big change. I would suggest picking up a different issue at this point", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=lucasbru", "name": "lucasbru", "key": "JIRAUSER302322", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER302322&avatarId=53242", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER302322&avatarId=53242", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER302322&avatarId=53242", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER302322&avatarId=53242"}, "displayName": "Lucas Brutschy", "active": true, "timeZone": "Europe/Berlin"}, "created": "2025-09-16T07:57:05.535+0000", "updated": "2025-09-16T07:57:05.535+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13628601/comment/18020580", "id": "18020580", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "body": "Hi, thank you for the guidance!\r\n\r\nI understand this issue is non-trivial and involves concurrency changes. \u00a0\r\nRather than immediately claiming the task, I would like to first analyze the problem and propose a potential improvement approach. \u00a0\r\nOnce I have a clear plan, I can discuss it with the maintainers before proceeding with the actual fix or being assigned the task. \u00a0\r\n\r\nLooking forward to your feedback, thanks!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liujing1989", "name": "liujing1989", "key": "JIRAUSER310826", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "LiuJing", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2025-09-16T08:24:24.220+0000", "updated": "2025-09-16T08:24:24.220+0000"}], "maxResults": 6, "total": 6, "startAt": 0}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}}}